(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function h(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();let v=function(){};v.EPSILON=1e-7;v.SQRT_2=Math.sqrt(2);v.PI_SQ=Math.PI*Math.PI;v.HALF_PI=Math.PI/2;v.clamp=function(s,n,r){return Math.max(n,Math.min(r,s))};v.atan2Range=function(s,n){console.assert(s.min<=s.max),console.assert(n.min<=n.max);let r=n.min,h=n.max,o=s.min,l=s.max;if(0<=o)return 0<r?{min:Math.atan2(o,h),max:Math.atan2(l,r)}:h<0?{min:Math.atan2(l,h),max:Math.atan2(o,r)}:{min:Math.atan2(o,h),max:Math.atan2(o,r)};if(l<0)return 0<r?{min:Math.atan2(o,r),max:Math.atan2(l,h)}:h<0?{min:Math.atan2(l,r),max:Math.atan2(o,h)}:{min:Math.atan2(l,r),max:Math.atan2(l,h)};if(0<r)return{min:Math.atan2(o,r),max:Math.atan2(l,r)};if(h<0){let c=Math.atan2(l,h),m=Math.atan2(o,h);return Math.PI<=c?{min:c-2*Math.PI,max:m}:{min:c,max:m+2*Math.PI}}return{min:-Math.PI,max:Math.PI}};v.toLambdaPhi=function(s){let n=Math.sqrt(s[0]*s[0]+s[1]*s[1]),r=Math.atan2(s[1],s[0]),h=Math.atan2(s[2],n);return{lambda:r,phi:h}};v.normalizeLambda=function(s){return-Math.PI<=s&&s<Math.PI?s:s-2*Math.PI*Math.floor((s+Math.PI)/(2*Math.PI))};v.neighborPoint=function(s,n){if(v.EPSILON<=Math.abs(s.phi-n.phi))return!1;let r=v.normalizeLambda(s.lambda),h=v.normalizeLambda(n.lambda);return Math.abs(r-h)<v.EPSILON};v.sphericalDistance=function(s,n){return Math.acos(Math.sin(s.phi)*Math.sin(n.phi)+Math.cos(s.phi)*Math.cos(n.phi)*Math.cos(v.normalizeLambda(n.lambda-s.lambda)))};let Q=function(){};Q.smoothstep=function(s,n,r){let h=v.clamp((r-s)/(n-s),0,1);return h*h*(3-2*h)};Q.smootherstep=function(s,n,r){let h=v.clamp((r-s)/(n-s),0,1);return h*h*h*(h*(6*h-15)+10)};Q.toUnitVector3d=function(s,n){let r=Math.cos(n);return[Math.cos(s)*r,Math.sin(s)*r,Math.sin(n)]};Q.slerp=function(s,n,r){let h=v.clamp(s[0]*n[0]+s[1]*n[1]+s[2]*n[2],-1,1);if(1-v.EPSILON<h)return[(s[0]+n[0])/2,(s[1]+n[1])/2,(s[2]+n[2])/2];h<-(1-v.EPSILON);let o=Math.acos(h),l=Math.sin(o),c=Math.sin((1-r)*o)/l,m=Math.sin(r*o)/l;return[c*s[0]+m*n[0],c*s[1]+m*n[1],c*s[2]+m*n[2]]};let ct=function(s,n,r,h,o){this.v1=Q.toUnitVector3d(s.lambda,s.phi),this.v2=Q.toUnitVector3d(n.lambda,n.phi),this.iniViewPos=r,this.finViewPos=h,this.timeSpan=o,this.startTime=null,this.finished=!1};ct.create=function(s,n,r,h,o){return v.neighborPoint(s,n)?null:(Math.PI-v.EPSILON<Math.abs(n.phi-s.phi)&&(s={lambda:s.lambda,phi:s.phi+1e-4*(0<s.phi?-1:1)}),new ct(s,n,r,h,o))};ct.prototype.getPos=function(s){let n=0;if(this.startTime==null)this.startTime=s;else{let c=s-this.startTime;n=v.clamp(c/this.timeSpan,0,1),this.startTime+this.timeSpan<s&&(this.finished=!0)}let r=Q.smootherstep(0,1,n),h=Q.slerp(this.v1,this.v2,r),o=v.toLambdaPhi(h),l=[this.iniViewPos[0]*(1-r)+this.finViewPos[0]*r,this.iniViewPos[1]*(1-r)+this.finViewPos[1]*r];return{lp:o,viewPos:l}};ct.prototype.isFinished=function(){return this.finished};let k=function(s,n){this.rasterProj=n,this.tileSize=256,this.centerQuadkey=null};k.prototype.resizeCanvas=function(s){};k.prototype.getCenterTileInfo=function(s,n,r){let h=Math.sin(n),o=(s+Math.PI)/(2*Math.PI)*this.tileSize*Math.pow(2,r),l=(.5-Math.log((1+h)/(1-h))/(4*Math.PI))*this.tileSize*Math.pow(2,r),c=Math.floor(o/this.tileSize),m=Math.floor(l/this.tileSize);this.centerQuadkey=this.tileXYToQuadkey(c,m,r)};k.prototype.tileXYToQuadkey=function(s,n,r){let h="";for(let o=r;o>0;o--){let l=0;const c=1<<o-1;(s&c)!==0&&(l|=1),(n&c)!==0&&(l|=2),h+=l.toString()}return h};function Ke(s){let n=0,r=0;const h=s.length;for(let o=h;o>0;o--){const l=1<<o-1,c=parseInt(s.charAt(h-o));c&1&&(n|=l),c&2&&(r|=l)}return{x:n,y:r,z:h}}k.prototype.getRectFromXYZ=function(s){let n=-Math.PI,r=Math.PI/2,h=Math.PI*2,o=Math.PI,l=h/Math.pow(2,s.xyz.z),c=o/Math.pow(2,s.xyz.z),m=n+s.xyz.x*l,T=r-s.xyz.y*c,p=n+(s.xyz.x+1)*l,_=r-(s.xyz.y+1)*c;return[m,_,p,T]};k.prototype.getNSWEtiles=function(s,n=[N,S,W,E,NE,NW,SE,SW]){let r=0,h=1,o=2,l=3,c=4,m=5,T=6,p=7,_=[],{x:d,y,z:x}=s.xyz,z=Math.pow(2,x)-1;return n.length===0||(n.includes(r)&&y>0&&_.push({xyz:{x:d,y:y-1,z:x}}),n.includes(c)&&y<z&&_.push({xyz:{x:d,y:y+1,z:x}}),n.includes(T)&&_.push({xyz:{x:d==0?z:d-1,y,z:x}}),n.includes(o)&&_.push({xyz:{x:d==z?0:d+1,y,z:x}}),n.includes(h)&&y>0&&_.push({xyz:{x:d==z?0:d+1,y:y-1,z:x}}),n.includes(p)&&y>0&&_.push({xyz:{x:d==0?z:d-1,y:y-1,z:x}}),n.includes(l)&&y<z&&_.push({xyz:{x:d==z?0:d+1,y:y+1,z:x}}),n.includes(m)&&y<z&&_.push({xyz:{x:d==0?z:d-1,y:y+1,z:x}})),_};k.prototype.getAdjacentTiles=function(s){let n=[],r=[],h=0,o=1,l=2,c=3,m=4,T=5,p=6,_=7,d=s.quadkey.slice(-1);return d==="0"?r=this.getNSWEtiles(s,[h,p,_]):d==="1"?r=this.getNSWEtiles(s,[h,l,o]):d==="2"?r=this.getNSWEtiles(s,[m,p,T]):d==="3"&&(r=this.getNSWEtiles(s,[m,l,c])),n.push(...r),n};k.prototype.pushLevelOneTiles=function(s){let n=[{xyz:{x:0,y:0,z:1},quadkey:"0"},{xyz:{x:1,y:0,z:1},quadkey:"1"},{xyz:{x:0,y:1,z:1},quadkey:"2"},{xyz:{x:1,y:1,z:1},quadkey:"3"}];s.push(...n)};k.prototype.getTileInfos=function(s,n,r,h){let o=[],l=null;this.getCenterTileInfo(s,n,r);for(let c=r;c>=2;c--){let m;l?m=l.quadkey.slice(0,-1):m=this.centerQuadkey;let p={xyz:Ke(m),quadkey:m};o.push(p);let _=this.getAdjacentTiles(p);o.push(..._),l=p}this.pushLevelOneTiles(o);for(const c of o)c.rect=this.getRectFromXYZ(c),c.url=h(c.xyz.z,c.xyz.x,c.xyz.y);return o.reverse()};class $e{constructor(n){this.cache=new Map,this.capacity=n}get(n){if(!this.cache.has(n))return!1;let r=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,r),r}put(n,r){this.cache.delete(n),this.cache.size===this.capacity?(this.cache.delete(this.cache.keys().next().value),this.cache.set(n,r)):this.cache.set(n,r)}}let ft=function(s){this.num=32,this.crossOrigin=null,this.loading={},this.ongoingImageLoads=[],this.debug=!1,typeof s<"u"&&("num"in s&&(this.num=s.num),"crossOrigin"in s&&(this.crossOrigin=s.crossOrigin),"debug"in s&&(this.debug=s.debug)),this.createTexture=null,this.textures=new $e(this.num)};ft.prototype.loadImage_=function(s,n){const{promise:r,resolve:h,reject:o}=Promise.withResolvers();this.loading[s]=!0;let l=new Image;this.crossOrigin!=null&&(l.crossOrigin=this.crossOrigin);let c=this,m=this.debug,T;l.onload=async function(){if(c.ongoingImageLoads.splice(c.ongoingImageLoads.indexOf(l),1),c.createTexture==null)return;let p=c.createTexture(l);if(p&&c.textures.put(s,[p,n]),delete c.loading.url,m=="red"){let _=new OffscreenCanvas(256,256),d=_.getContext("2d");d.drawImage(l,0,0),d.strokeStyle="red",d.lineWidth=5,d.strokeRect(0,0,l.width,l.height);const y=await _.convertToBlob({type:"image/png"});T=new Image,T.src=URL.createObjectURL(y),h(T)}},m=="red"&&r.then(p=>{l.src=p.src}),this.ongoingImageLoads.push(l),m=="local"?l.src=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAACVBMVEX/AAAAAADAwMALHWY1AAAAqUlEQVR4nO3QwQnDABADQX/Sl5vwIwWkJdfrIiQwEXPcWzB7HK/f54ruLAzc31/wjYGBBggICAgIxYG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARAQEBASEIiEeiBsMRERAQEBAKBLigbjBQEQEBAQEhCIhHogbDEREQEBAQCgS4oG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARASEDcL/3wP26M0z+9z7bgAAAABJRU5ErkJggg==",import.meta.url):l.src=s};ft.prototype.loadImageIfAbsent=function(s,n){return this.textures.get(s)||s in this.loading?!1:(this.loadImage_(s,n),!0)};ft.prototype.getTexture=function(s){return this.textures.get(s)};ft.prototype.clearOngoingImageLoads=function(){for(let s=0;s<this.ongoingImageLoads.length;s++)this.ongoingImageLoads[s].onload=void 0;this.ongoingImageLoads=[]};let C=function(s,n,r,h,o){this.gl=s,this.rasterProj=n,this.canvasSize=r,this.tileManager=new k(h,this.rasterProj),this.prevTileInfos_=null,this.prevWindow_=null,this.imageCache=new ft(o);let l=this;this.imageCache.createTexture=function(c){return l.createTexture(c)},this.tileInfos=null,this.getURL=null,this.calculateLevel=null,this.currTileLevel=0,this.lam0=0,this.phi0=0};C.prototype.clearTileInfoCache_=function(){this.prevWindow_=null,this.prevTileInfos_=null};C.prototype.setProjCenter=function(s,n){this.lam0=s,this.phi0=n,this.clearTileInfoCache_(),this.rasterProj.setProjCenter(s,n)};C.prototype.getProjCenter=function(){return this.rasterProj.projection.getProjCenter()};C.prototype.resizeCanvas=function(s){this.canvasSize.width=s.width,this.canvasSize.height=s.height,this.tileManager.resizeCanvas(this.canvasSize)};C.prototype.setTileLevel=function(s){this.currTileLevel=s};C.prototype.getViewPointFromWindow=function(s,n){let r=Math.PI*2/this.canvasSize.width,h=Math.PI*2/-this.canvasSize.height,o=-Math.PI+s*r,l=-Math.PI+(n-this.canvasSize.height)*h;return[o,l]};C.prototype.getLambdaPhiPointFromWindow=function(s,n){let r=this.getViewPointFromWindow(s,n);return this.rasterProj.projection.inverse(r[0],r[1])};C.prototype.resetImages=function(){this.imageCache.clearOngoingImageLoads()};C.prototype.requestImagesIfNecessary=function(){return this.getURL==null?-1:(this.getTileInfos_(),this.requestImages_(this.tileInfos))};C.prototype.render=function(s){this.getURL!=null&&(s&&(this.getTileInfos_(),this.requestImages_(this.tileInfos)),this.render_(this.tileInfos))};C.prototype.createTexture=function(s){let n=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s),this.gl.bindTexture(this.gl.TEXTURE_2D,null),n};C.prototype.getTileInfos_=function(){let s=this.tileManager.getTileInfos(this.lam0,this.phi0,this.currTileLevel,this.getURL);this.tileInfos=s};C.prototype.requestImages_=function(){let s=0;for(let n=0;n<this.tileInfos.length;++n)this.imageCache.loadImageIfAbsent(this.tileInfos[n].url,this.tileInfos[n].rect)&&++s;return s};C.prototype.render_=function(){this.rasterProj.clear(this.canvasSize);let s=[];for(let r=0;r<this.tileInfos.length;++r){let h=this.tileInfos[r],o=this.imageCache.getTexture(h.url);o&&s.push(o)}let n=new Float32Array([0,0,0,1,1,0,1,1]);this.rasterProj.prepareRender(n,[-Math.PI,-Math.PI,Math.PI,Math.PI]),0<s.length&&this.rasterProj.renderTextures(s)};let I=function(s){this.gl_=s,this.vbo_=null,this.program_=null,this.locTexture_=null,this.locAlpha_=null,this.locProjCenter_=null,this.locViewXY1_=null,this.locViewXY2_=null,this.locDataCoord1_=null,this.locDataCoord2_=null,this.locFixedTextureSize_=null,this.locRenderColor_=null,this.locRenderType_=null,this.locUnifScale_=null,this.locRingRadius_=null,this.locFlatRatio_=null,this.locTranslateY_=null};I.DIMENSION=2;I.UNIT_RECT_TRIANGLE_STRIP=new Float32Array([-1,-1,-1,1,1,-1,1,1]);I.RENDER_TYPE_TEXTURE=0;I.RENDER_TYPE_POINT_TEXTURE=1;I.RENDER_TYPE_POLYLINE=2;I.prototype.init=function(s,n){let r=this.loadShader_(this.gl_.VERTEX_SHADER,s),h=this.loadShader_(this.gl_.FRAGMENT_SHADER,n),o=this.gl_.createProgram();if(this.gl_.attachShader(o,r),this.gl_.attachShader(o,h),this.gl_.bindAttribLocation(o,0,"aPosition"),this.gl_.bindAttribLocation(o,1,"aTexCoord"),this.gl_.linkProgram(o),!this.gl_.getProgramParameter(o,this.gl_.LINK_STATUS)&&!this.gl_.isContextLost()){let c=this.gl_.getProgramInfoLog(o);return alert(`Error linking program:
`+c),this.gl_.deleteProgram(o),!1}return this.program_=o,this.locTexture_=this.gl_.getUniformLocation(this.program_,"uTexture"),this.locAlpha_=this.gl_.getUniformLocation(this.program_,"uAlpha"),this.locProjCenter_=this.gl_.getUniformLocation(this.program_,"uProjCenter"),this.locViewXY1_=this.gl_.getUniformLocation(this.program_,"uViewXY1"),this.locViewXY2_=this.gl_.getUniformLocation(this.program_,"uViewXY2"),this.locDataCoord1_=this.gl_.getUniformLocation(this.program_,"uDataCoord1"),this.locDataCoord2_=this.gl_.getUniformLocation(this.program_,"uDataCoord2"),this.locFixedTextureSize_=this.gl_.getUniformLocation(this.program_,"uFixedTextureSize"),this.locRenderColor_=this.gl_.getUniformLocation(this.program_,"uRenderColor"),this.locRenderType_=this.gl_.getUniformLocation(this.program_,"uRenderType"),this.locUnifScale_=this.gl_.getUniformLocation(this.program_,"uScale"),this.locRingRadius_=this.gl_.getUniformLocation(this.program_,"uRingRadius"),this.locFlatRatio_=this.gl_.getUniformLocation(this.program_,"uFlatRatio"),this.gl_.blendFunc(this.gl_.SRC_ALPHA,this.gl_.ONE_MINUS_SRC_ALPHA),!0};I.prototype.initAdditionalParams=function(){this.locTranslateY_=this.gl_.getUniformLocation(this.program_,"uTranslateY")};I.prototype.loadShader_=function(s,n){let r=this.gl_.createShader(s);if(this.gl_.shaderSource(r,n),this.gl_.compileShader(r),!this.gl_.getShaderParameter(r,this.gl_.COMPILE_STATUS)&&!this.gl_.isContextLost()){let h=this.gl_.getShaderInfoLog(r);return alert(`Error compiling shader:
`+h),this.gl_.deleteShader(r),null}return r};I.prototype.setClearColor=function(s){this.gl_.clearColor(s.r,s.g,s.b,s.a),this.gl_.enable(this.gl_.BLEND)};I.prototype.clear=function(s){this.gl_.clear(this.gl_.COLOR_BUFFER_BIT),this.gl_.viewport(0,0,s.width,s.height)};I.prototype.initVBO=function(s){this.vbo_=this.gl_.createBuffer(),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.vbo_),this.gl_.bufferData(this.gl_.ARRAY_BUFFER,s*4*2,this.gl_.DYNAMIC_DRAW)};I.prototype.setRenderType=function(s){this.gl_.uniform1i(this.locRenderType_,s)};I.prototype.prepareRender=function(s,n,r,h,o,l,c,m,T){this.gl_.useProgram(this.program_),this.gl_.uniform1f(this.locAlpha_,o),this.gl_.uniform4f(this.locRenderColor_,l.r,l.g,l.b,l.a),this.gl_.uniform2f(this.locProjCenter_,r,h),this.gl_.uniform2f(this.locViewXY1_,s[0],s[1]),this.gl_.uniform2f(this.locViewXY2_,s[2],s[3]),this.gl_.uniform1i(this.locTexture_,0),this.gl_.uniform1f(this.locUnifScale_,c),this.gl_.uniform1f(this.locRingRadius_,m),this.gl_.uniform1f(this.locFlatRatio_,T),this.locTranslateY_!=null&&this.gl_.uniform1f(this.locTranslateY_,0);let p=I.UNIT_RECT_TRIANGLE_STRIP.byteLength;this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,0,I.UNIT_RECT_TRIANGLE_STRIP),this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,p,n),this.gl_.enableVertexAttribArray(0),this.gl_.vertexAttribPointer(0,I.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,0),this.gl_.enableVertexAttribArray(1),this.gl_.vertexAttribPointer(1,I.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,p)};I.prototype.renderTexture=function(s,n){let r=n[0],h=n[1],o=n[2],l=n[3];this.gl_.bindTexture(this.gl_.TEXTURE_2D,s),this.gl_.uniform2f(this.locDataCoord1_,r,h),this.gl_.uniform2f(this.locDataCoord2_,o,l),this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP,0,4)};let Z=function(s,n,r,h){this.lam0=s,this.phi0=n,this.divN_=typeof h<"u"?h:180,this.sin_phi0_=Math.sin(n),this.cos_phi0_=Math.cos(n),this.zoomScale=r};Z.prototype.getProjCenter=function(){return{lambda:this.lam0,phi:this.phi0}};Z.prototype.fwd_fisheye=function(s,n){[s,n]=[s/Math.PI,n/Math.PI];let r=Math.sqrt(s*s+n*n),h=Math.atan2(n,s),o=Math.log(1+this.zoomScale*r)/Math.log(1+this.zoomScale);return[Math.cos(h)*o*Math.PI,Math.sin(h)*o*Math.PI]};Z.prototype.forward=function(s,n){let r={lam:s,phi:n},h=Math.sin(r.phi),o=Math.cos(r.phi),l=Math.sin(r.lam-this.lam0),c=Math.cos(r.lam-this.lam0),m=Math.acos(this.sin_phi0_*h+this.cos_phi0_*o*c);if(Math.abs(m)<v.EPSILON)return{x:0,y:0};let T=Math.sin(m);if(Math.abs(T)<v.EPSILON)return null;let p=m/T,_=p*o*l,d=p*(this.cos_phi0_*h-this.sin_phi0_*o*c);return[_,d]=this.fwd_fisheye(_,d),{x:_,y:d}};Z.prototype.inv_fisheye=function(s,n){[s,n]=[s/Math.PI,n/Math.PI];let r=Math.sqrt(s*s+n*n),h=Math.atan2(n,s),o=(Math.exp(r*Math.log(1+this.zoomScale))-1)/this.zoomScale;return[Math.cos(h)*o*Math.PI,Math.sin(h)*o*Math.PI]};Z.prototype.inverse=function(s,n){[s,n]=this.inv_fisheye(s,n);let r=s*s+n*n;if(v.PI_SQ<r)return null;let h=Math.sqrt(r);if(h<v.EPSILON)return{lambda:this.lam0,phi:this.phi0};let o=h,l=Math.sin(o),c=Math.cos(o),m=c*this.sin_phi0_+n*l*this.cos_phi0_/h,T=Math.asin(v.clamp(m,-1,1)),p;return v.HALF_PI-v.EPSILON<this.phi0?p=Math.atan2(s,-n)+this.lam0:this.phi0<-(v.HALF_PI-v.EPSILON)?p=Math.atan2(s,n)+this.lam0:p=Math.atan2(s*l,h*c*this.cos_phi0_-n*this.sin_phi0_*l)+this.lam0,(p<-Math.PI||Math.PI<=p)&&(p-=2*Math.PI*Math.floor((p+Math.PI)/(2*Math.PI))),{lambda:p,phi:T}};Z.prototype.setScale=function(s){this.zoomScale=s};const O=function(){this.shader_=null,this.backColor_={r:0,g:0,b:0,a:1},this.graticuleColor_={r:.88,g:.88,b:.88,a:1},this.alpha_=1,this.projection=new Z(0,0,.01),this.numberOfPoints=64,this.zoomScale=.01,this.ringRadius=null,this.flatRatio=null};O.prototype.init=function(s){if(this.shader_=new I(s),!this.shader_.init(O.VERTEX_SHADER_STR,O.FRAGMENT_SHADER_STR))return!1;let r=8+this.numberOfPoints;return this.shader_.initVBO(r),this.shader_.setClearColor(this.backColor_),!0};O.prototype.setAlpha=function(s){this.alpha_=s};O.prototype.setProjCenter=function(s,n){this.projection=new Z(s,n,this.zoomScale)};O.prototype.clear=function(s){this.shader_.clear(s)};O.prototype.prepareRender=function(s,n){this.shader_.prepareRender(n,s,this.projection.lam0,this.projection.phi0,this.alpha_,this.graticuleColor_,this.zoomScale,this.ringRadius,this.flatRatio)};O.prototype.renderTextures=function(s){for(let n=0;n<s.length;++n){this.shader_.setRenderType(I.RENDER_TYPE_TEXTURE);let r=s[n][0],h=s[n][1];this.shader_.renderTexture(r,h)}};O.prototype.setScale=function(s){this.zoomScale=s,this.projection.setScale(s)};O.prototype.setFlatRatio=function(s){this.ringRadius=s;let n=this.projection.lam0,r=this.projection.phi0+s,{x:h,y:o}=this.projection.forward(n,r);this.flatRatio=o/s};O.VERTEX_SHADER_STR=`#version 300 es
  precision highp float;
  in vec2 aPosition;
  in vec2 aTexCoord;
  out vec2 vTexCoord;

  void main() {
    gl_Position = vec4(aPosition.x, aPosition.y, 1.0, 1.0);
    vTexCoord = aTexCoord;
  }
`;O.FRAGMENT_SHADER_STR=`#version 300 es

  precision highp float;
  uniform sampler2D uTexture;
  in vec2 vTexCoord;
  uniform lowp int uRenderType;
  uniform vec2 uProjCenter; // lam0, phi0
  uniform vec2 uViewXY1;    // -PI,-PI
  uniform vec2 uViewXY2;    // +PI,+PI
  uniform vec2 uDataCoord1; // lam1, phi1: top left corner of current texture: radians
  uniform vec2 uDataCoord2; // lam2, phi2: bot right corner of current texture: radians
  uniform vec2 uFixedTextureSize;    //  アイコンサイズ（画面比） Icon size (screen ratio)
  uniform vec4 uRenderColor;
  uniform float uAlpha;
  uniform float uScale;       //  スケール zoom in zoomScale
  uniform float uRingRadius;  // radius of flat center disk in radians
  uniform float uFlatRatio;   // ratio of projectedFlatRadius / flatRadius  

  // const float flatradius = 0.0001;

  // float flatratio = 0.0002; // ratio of

  const float pi = 3.14159265;
  const float blurRatio = 0.015; // planet haze
  const float xyRadius = pi;
  const float atanSinhPi = 1.48442222; // atan(sinh(pi)) = max phi for web merc
  out vec4 fragColor;

  vec2 inner_flat(vec2 center, vec2 xy) {
    // Inside the ring - draw flat
    // Convert screen coordinates to web mercator coordinates
    // Scale by uFlatRatio to match the projection scale at the ring boundary
    float xflat = (xy.x / uFlatRatio) + center.x;
    float yflat = asinh(tan((xy.y / uFlatRatio) + center.y)) * 0.5;
    return vec2(xflat, yflat);
  }

  vec2 outer_projected(vec2 center, vec2 xy_fe, float rho) {
        // Inverse of azimuthal equidistant projection
    float sinPhi0 = sin(center.y);
    float cosPhi0 = cos(center.y);
    float phi = asin( clamp( cos(rho) * sinPhi0 + xy_fe.y * sin(rho) * cosPhi0 / rho, -1.0, 1.0 ) );
    float lambda = mod( center.x + atan( xy_fe.x * sin(rho), rho * cosPhi0 * cos(rho) - xy_fe.y * sinPhi0 * sin(rho) ) + pi, 2.0 * pi ) - pi;

    // Adj phi for web mercator
    if (abs(phi) < atanSinhPi) { // not for poles
      phi = asinh(tan(phi)) * 0.5;
    }
    return vec2(lambda, phi);
  }

  vec2 proj_inverse(vec2 center, vec2 xy) {
    float epsilon = 0.0001; // uRingRadius / 2.0; //0.00001
    // Fisheye effect
    vec2 xy_1 = xy / pi; // circle radius 1.0
    float rho_fe = length(xy_1);
    float theta = atan(xy.y, xy.x);
    float fisheyeR = (exp(rho_fe * log(1.0 + uScale)) - 1.0) / uScale;    
    vec2 xy_fe = vec2(cos(theta) * fisheyeR * pi, sin(theta) * fisheyeR * pi);
    
    float rho = length(xy_fe);

    if (rho > uRingRadius + epsilon || abs(center.y) >= atanSinhPi) { // outside ring: projected
      return outer_projected(center, xy_fe, rho);
    } else if (rho <= uRingRadius) {                                  // inside ring: flat
      return inner_flat(center, xy);
    } else {                                                // Smooth transition at the boundary
      float t = (rho - uRingRadius) / epsilon;
      vec2 flatCoords = inner_flat(center, xy);
      vec2 projectedCoords = outer_projected(center, xy_fe, rho);
      return mix( // Interpolate
        flatCoords,
        projectedCoords,
        smoothstep(0.0, 1.0, t)
      );
    }
  }

  float inner_xy(vec2 xy) { // returns zero outside of circle
    return 1.0 - smoothstep( (1.0 - blurRatio) * xyRadius, (1.0 + blurRatio) * xyRadius, length(xy) );
  }

  void main() {
  // Map the texture point vTexCoord ([0,0] - [1,1]) to a point on the XY plane
    vec2 xy = mix(uViewXY1, uViewXY2, vTexCoord); // lerp from -PI,-PI to +PI,+PI, inverse so rationalizes it
    // if ( uRenderType == 0 ) {    //  Texture (map) RENDER_TYPE_TEXTURE

      vec2 lp = proj_inverse(uProjCenter, xy);

      vec2 ts = (lp - uDataCoord1) / (uDataCoord2 - uDataCoord1);
      float inXY = inner_xy(xy);
      vec2 inData = step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts); // cut off outside of texture
      vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y * inXY;
      OutputColor.a *= clamp(uAlpha, 0.0, 1.0);
      fragColor = OutputColor;
    // }
  //  else if ( uRenderType == 1 ) {  //  PointTexture (icon)

  // //   XY平面上の点を画像上の点[0,0]-[1,1]にマッピングする 
  // //.  Map a point on the XY plane to a point [0, 0] - [1, 1] on the image
  //     vec2 fixedTextureSizeXY = uFixedTextureSize * (uViewXY2 - uViewXY1);
  //     vec2 r1 = vec2(uDataCoord1.x - 0.5 * fixedTextureSizeXY.x, uDataCoord1.x - 0.5 * fixedTextureSizeXY.y);
  //     vec2 ts = (xy - r1) / fixedTextureSizeXY;
  //     vec2 inData = (step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts));
  //     vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y;
  //     fragColor = OutputColor;

  // } 
  // else if ( uRenderType == 2 ) {  //  Polyline (Graticules)
  
  //       fragColor = uRenderColor;
  
      // }
    }

`;let me,ge;me="pk.eyJ1IjoiYml0c2xheWVyNDIiLCJhIjoiY21iNmp2dTdiMDBnYjJqcGxobWR4NWlrbyJ9.V6LS515oNG3QiZcDI_US5A",ge="AIzaSyBdMoioCgoUJK_mlXrOomNn0vtXIY7pTbs";var qt={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var pe;function ti(){return pe||(pe=1,function(s){(function(n,r,h,o){var l=["","webkit","Moz","MS","ms","o"],c=r.createElement("div"),m="function",T=Math.round,p=Math.abs,_=Date.now;function d(t,e,i){return setTimeout(wt(t,i),e)}function y(t,e,i){return Array.isArray(t)?(x(t,i[e],i),!0):!1}function x(t,e,i){var a;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==o)for(a=0;a<t.length;)e.call(i,t[a],a,t),a++;else for(a in t)t.hasOwnProperty(a)&&e.call(i,t[a],a,t)}function z(t,e,i){var a="DEPRECATED METHOD: "+e+`
`+i+` AT 
`;return function(){var u=new Error("get-stack-trace"),f=u&&u.stack?u.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",g=n.console&&(n.console.warn||n.console.log);return g&&g.call(n.console,a,f),t.apply(this,arguments)}}var Y;typeof Object.assign!="function"?Y=function(e){if(e===o||e===null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),a=1;a<arguments.length;a++){var u=arguments[a];if(u!==o&&u!==null)for(var f in u)u.hasOwnProperty(f)&&(i[f]=u[f])}return i}:Y=Object.assign;var Vt=z(function(e,i,a){for(var u=Object.keys(i),f=0;f<u.length;)(!a||a&&e[u[f]]===o)&&(e[u[f]]=i[u[f]]),f++;return e},"extend","Use `assign`."),de=z(function(e,i){return Vt(e,i,!0)},"merge","Use `assign`.");function L(t,e,i){var a=e.prototype,u;u=t.prototype=Object.create(a),u.constructor=t,u._super=a,i&&Y(u,i)}function wt(t,e){return function(){return t.apply(e,arguments)}}function Rt(t,e){return typeof t==m?t.apply(e&&e[0]||o,e):t}function jt(t,e){return t===o?e:t}function pt(t,e,i){x(gt(e),function(a){t.addEventListener(a,i,!1)})}function mt(t,e,i){x(gt(e),function(a){t.removeEventListener(a,i,!1)})}function Wt(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function J(t,e){return t.indexOf(e)>-1}function gt(t){return t.trim().split(/\s+/g)}function et(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var a=0;a<t.length;){if(i&&t[a][i]==e||!i&&t[a]===e)return a;a++}return-1}function dt(t){return Array.prototype.slice.call(t,0)}function Ht(t,e,i){for(var a=[],u=[],f=0;f<t.length;){var g=t[f][e];et(u,g)<0&&a.push(t[f]),u[f]=g,f++}return a=a.sort(function(A,R){return A[e]>R[e]}),a}function vt(t,e){for(var i,a,u=e[0].toUpperCase()+e.slice(1),f=0;f<l.length;){if(i=l[f],a=i?i+u:e,a in t)return a;f++}return o}var ve=1;function _e(){return ve++}function kt(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}var Te=/mobile|tablet|ip(ad|hone|od)|android/i,Gt="ontouchstart"in n,ye=vt(n,"PointerEvent")!==o,Ee=Gt&&Te.test(navigator.userAgent),st="touch",Pe="pen",Ct="mouse",Se="kinect",Ie=25,w=1,K=2,P=4,b=8,_t=1,rt=2,nt=4,at=8,ot=16,X=rt|nt,$=at|ot,Bt=X|$,Qt=["x","y"],Tt=["clientX","clientY"];function D(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(a){Rt(t.options.enable,[t])&&i.handler(a)},this.init()}D.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler),this.evTarget&&pt(this.target,this.evTarget,this.domHandler),this.evWin&&pt(kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(kt(this.element),this.evWin,this.domHandler)}};function xe(t){var e,i=t.options.inputClass;return i?e=i:ye?e=bt:Ee?e=Pt:Gt?e=Lt:e=Et,new e(t,Me)}function Me(t,e,i){var a=i.pointers.length,u=i.changedPointers.length,f=e&w&&a-u===0,g=e&(P|b)&&a-u===0;i.isFirst=!!f,i.isFinal=!!g,f&&(t.session={}),i.eventType=e,Ae(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function Ae(t,e){var i=t.session,a=e.pointers,u=a.length;i.firstInput||(i.firstInput=Zt(e)),u>1&&!i.firstMultiple?i.firstMultiple=Zt(e):u===1&&(i.firstMultiple=!1);var f=i.firstInput,g=i.firstMultiple,M=g?g.center:f.center,A=e.center=Jt(a);e.timeStamp=_(),e.deltaTime=e.timeStamp-f.timeStamp,e.angle=Nt(M,A),e.distance=yt(M,A),we(i,e),e.offsetDirection=$t(e.deltaX,e.deltaY);var R=Kt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=R.x,e.overallVelocityY=R.y,e.overallVelocity=p(R.x)>p(R.y)?R.x:R.y,e.scale=g?Ne(g.pointers,a):1,e.rotation=g?Ce(g.pointers,a):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,Re(i,e);var V=t.element;Wt(e.srcEvent.target,V)&&(V=e.srcEvent.target),e.target=V}function we(t,e){var i=e.center,a=t.offsetDelta||{},u=t.prevDelta||{},f=t.prevInput||{};(e.eventType===w||f.eventType===P)&&(u=t.prevDelta={x:f.deltaX||0,y:f.deltaY||0},a=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=u.x+(i.x-a.x),e.deltaY=u.y+(i.y-a.y)}function Re(t,e){var i=t.lastInterval||e,a=e.timeStamp-i.timeStamp,u,f,g,M;if(e.eventType!=b&&(a>Ie||i.velocity===o)){var A=e.deltaX-i.deltaX,R=e.deltaY-i.deltaY,V=Kt(a,A,R);f=V.x,g=V.y,u=p(V.x)>p(V.y)?V.x:V.y,M=$t(A,R),t.lastInterval=e}else u=i.velocity,f=i.velocityX,g=i.velocityY,M=i.direction;e.velocity=u,e.velocityX=f,e.velocityY=g,e.direction=M}function Zt(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:T(t.pointers[i].clientX),clientY:T(t.pointers[i].clientY)},i++;return{timeStamp:_(),pointers:e,center:Jt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Jt(t){var e=t.length;if(e===1)return{x:T(t[0].clientX),y:T(t[0].clientY)};for(var i=0,a=0,u=0;u<e;)i+=t[u].clientX,a+=t[u].clientY,u++;return{x:T(i/e),y:T(a/e)}}function Kt(t,e,i){return{x:e/t||0,y:i/t||0}}function $t(t,e){return t===e?_t:p(t)>=p(e)?t<0?rt:nt:e<0?at:ot}function yt(t,e,i){i||(i=Qt);var a=e[i[0]]-t[i[0]],u=e[i[1]]-t[i[1]];return Math.sqrt(a*a+u*u)}function Nt(t,e,i){i||(i=Qt);var a=e[i[0]]-t[i[0]],u=e[i[1]]-t[i[1]];return Math.atan2(u,a)*180/Math.PI}function Ce(t,e){return Nt(e[1],e[0],Tt)+Nt(t[1],t[0],Tt)}function Ne(t,e){return yt(e[0],e[1],Tt)/yt(t[0],t[1],Tt)}var be={mousedown:w,mousemove:K,mouseup:P},Le="mousedown",Oe="mousemove mouseup";function Et(){this.evEl=Le,this.evWin=Oe,this.pressed=!1,D.apply(this,arguments)}L(Et,D,{handler:function(e){var i=be[e.type];i&w&&e.button===0&&(this.pressed=!0),i&K&&e.which!==1&&(i=P),this.pressed&&(i&P&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[e],changedPointers:[e],pointerType:Ct,srcEvent:e}))}});var ze={pointerdown:w,pointermove:K,pointerup:P,pointercancel:b,pointerout:b},De={2:st,3:Pe,4:Ct,5:Se},te="pointerdown",ee="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(te="MSPointerDown",ee="MSPointerMove MSPointerUp MSPointerCancel");function bt(){this.evEl=te,this.evWin=ee,D.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}L(bt,D,{handler:function(e){var i=this.store,a=!1,u=e.type.toLowerCase().replace("ms",""),f=ze[u],g=De[e.pointerType]||e.pointerType,M=g==st,A=et(i,e.pointerId,"pointerId");f&w&&(e.button===0||M)?A<0&&(i.push(e),A=i.length-1):f&(P|b)&&(a=!0),!(A<0)&&(i[A]=e,this.callback(this.manager,f,{pointers:i,changedPointers:[e],pointerType:g,srcEvent:e}),a&&i.splice(A,1))}});var Ue={touchstart:w,touchmove:K,touchend:P,touchcancel:b},Fe="touchstart",Ye="touchstart touchmove touchend touchcancel";function ie(){this.evTarget=Fe,this.evWin=Ye,this.started=!1,D.apply(this,arguments)}L(ie,D,{handler:function(e){var i=Ue[e.type];if(i===w&&(this.started=!0),!!this.started){var a=Xe.call(this,e,i);i&(P|b)&&a[0].length-a[1].length===0&&(this.started=!1),this.callback(this.manager,i,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}}});function Xe(t,e){var i=dt(t.touches),a=dt(t.changedTouches);return e&(P|b)&&(i=Ht(i.concat(a),"identifier")),[i,a]}var qe={touchstart:w,touchmove:K,touchend:P,touchcancel:b},Ve="touchstart touchmove touchend touchcancel";function Pt(){this.evTarget=Ve,this.targetIds={},D.apply(this,arguments)}L(Pt,D,{handler:function(e){var i=qe[e.type],a=je.call(this,e,i);a&&this.callback(this.manager,i,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}});function je(t,e){var i=dt(t.touches),a=this.targetIds;if(e&(w|K)&&i.length===1)return a[i[0].identifier]=!0,[i,i];var u,f,g=dt(t.changedTouches),M=[],A=this.target;if(f=i.filter(function(R){return Wt(R.target,A)}),e===w)for(u=0;u<f.length;)a[f[u].identifier]=!0,u++;for(u=0;u<g.length;)a[g[u].identifier]&&M.push(g[u]),e&(P|b)&&delete a[g[u].identifier],u++;if(M.length)return[Ht(f.concat(M),"identifier"),M]}var We=2500,se=25;function Lt(){D.apply(this,arguments);var t=wt(this.handler,this);this.touch=new Pt(this.manager,t),this.mouse=new Et(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}L(Lt,D,{handler:function(e,i,a){var u=a.pointerType==st,f=a.pointerType==Ct;if(!(f&&a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents)){if(u)He.call(this,i,a);else if(f&&ke.call(this,a))return;this.callback(e,i,a)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function He(t,e){t&w?(this.primaryTouch=e.changedPointers[0].identifier,re.call(this,e)):t&(P|b)&&re.call(this,e)}function re(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var a=this.lastTouches,u=function(){var f=a.indexOf(i);f>-1&&a.splice(f,1)};setTimeout(u,We)}}function ke(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,a=0;a<this.lastTouches.length;a++){var u=this.lastTouches[a],f=Math.abs(e-u.x),g=Math.abs(i-u.y);if(f<=se&&g<=se)return!0}return!1}var ne=vt(c.style,"touchAction"),ae=ne!==o,oe="compute",he="auto",Ot="manipulation",tt="none",ht="pan-x",lt="pan-y",St=Be();function zt(t,e){this.manager=t,this.set(e)}zt.prototype={set:function(t){t==oe&&(t=this.compute()),ae&&this.manager.element.style&&St[t]&&(this.manager.element.style[ne]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return x(this.manager.recognizers,function(e){Rt(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Ge(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var a=this.actions,u=J(a,tt)&&!St[tt],f=J(a,lt)&&!St[lt],g=J(a,ht)&&!St[ht];if(u){var M=t.pointers.length===1,A=t.distance<2,R=t.deltaTime<250;if(M&&A&&R)return}if(!(g&&f)&&(u||f&&i&X||g&&i&$))return this.preventSrc(e)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function Ge(t){if(J(t,tt))return tt;var e=J(t,ht),i=J(t,lt);return e&&i?tt:e||i?e?ht:lt:J(t,Ot)?Ot:he}function Be(){if(!ae)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=e?n.CSS.supports("touch-action",i):!0}),t}var It=1,U=2,it=4,G=8,j=G,ut=16,q=32;function H(t){this.options=Y({},this.defaults,t||{}),this.id=_e(),this.manager=null,this.options.enable=jt(this.options.enable,!0),this.state=It,this.simultaneous={},this.requireFail=[]}H.prototype={defaults:{},set:function(t){return Y(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(y(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=xt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return y(t,"dropRecognizeWith",this)?this:(t=xt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(y(t,"requireFailure",this))return this;var e=this.requireFail;return t=xt(t,this),et(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(y(t,"dropRequireFailure",this))return this;t=xt(t,this);var e=et(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function a(u){e.manager.emit(u,t)}i<G&&a(e.options.event+le(i)),a(e.options.event),t.additionalEvent&&a(t.additionalEvent),i>=G&&a(e.options.event+le(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=q},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(q|It)))return!1;t++}return!0},recognize:function(t){var e=Y({},t);if(!Rt(this.options.enable,[this,e])){this.reset(),this.state=q;return}this.state&(j|ut|q)&&(this.state=It),this.state=this.process(e),this.state&(U|it|G|ut)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}};function le(t){return t&ut?"cancel":t&G?"end":t&it?"move":t&U?"start":""}function ue(t){return t==ot?"down":t==at?"up":t==rt?"left":t==nt?"right":""}function xt(t,e){var i=e.manager;return i?i.get(t):t}function F(){H.apply(this,arguments)}L(F,H,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return e===0||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,a=e&(U|it),u=this.attrTest(t);return a&&(i&b||!u)?e|ut:a||u?i&P?e|G:e&U?e|it:U:q}});function Mt(){F.apply(this,arguments),this.pX=null,this.pY=null}L(Mt,F,{defaults:{event:"pan",threshold:10,pointers:1,direction:Bt},getTouchAction:function(){var t=this.options.direction,e=[];return t&X&&e.push(lt),t&$&&e.push(ht),e},directionTest:function(t){var e=this.options,i=!0,a=t.distance,u=t.direction,f=t.deltaX,g=t.deltaY;return u&e.direction||(e.direction&X?(u=f===0?_t:f<0?rt:nt,i=f!=this.pX,a=Math.abs(t.deltaX)):(u=g===0?_t:g<0?at:ot,i=g!=this.pY,a=Math.abs(t.deltaY))),t.direction=u,i&&a>e.threshold&&u&e.direction},attrTest:function(t){return F.prototype.attrTest.call(this,t)&&(this.state&U||!(this.state&U)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=ue(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}});function Dt(){F.apply(this,arguments)}L(Dt,F,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&U)},emit:function(t){if(t.scale!==1){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}});function Ut(){H.apply(this,arguments),this._timer=null,this._input=null}L(Ut,H,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,u=t.deltaTime>e.time;if(this._input=t,!a||!i||t.eventType&(P|b)&&!u)this.reset();else if(t.eventType&w)this.reset(),this._timer=d(function(){this.state=j,this.tryEmit()},e.time,this);else if(t.eventType&P)return j;return q},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===j&&(t&&t.eventType&P?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=_(),this.manager.emit(this.options.event,this._input)))}});function Ft(){F.apply(this,arguments)}L(Ft,F,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&U)}});function Yt(){F.apply(this,arguments)}L(Yt,F,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:X|$,pointers:1},getTouchAction:function(){return Mt.prototype.getTouchAction.call(this)},attrTest:function(t){var e=this.options.direction,i;return e&(X|$)?i=t.overallVelocity:e&X?i=t.overallVelocityX:e&$&&(i=t.overallVelocityY),this._super.attrTest.call(this,t)&&e&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&p(i)>this.options.velocity&&t.eventType&P},emit:function(t){var e=ue(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}});function At(){H.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}L(At,H,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ot]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,u=t.deltaTime<e.time;if(this.reset(),t.eventType&w&&this.count===0)return this.failTimeout();if(a&&u&&i){if(t.eventType!=P)return this.failTimeout();var f=this.pTime?t.timeStamp-this.pTime<e.interval:!0,g=!this.pCenter||yt(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!g||!f?this.count=1:this.count+=1,this._input=t;var M=this.count%e.taps;if(M===0)return this.hasRequireFailures()?(this._timer=d(function(){this.state=j,this.tryEmit()},e.interval,this),U):j}return q},failTimeout:function(){return this._timer=d(function(){this.state=q},this.options.interval,this),q},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==j&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function B(t,e){return e=e||{},e.recognizers=jt(e.recognizers,B.defaults.preset),new Xt(t,e)}B.VERSION="2.0.7",B.defaults={domEvents:!1,touchAction:oe,enable:!0,inputTarget:null,inputClass:null,preset:[[Ft,{enable:!1}],[Dt,{enable:!1},["rotate"]],[Yt,{direction:X}],[Mt,{direction:X},["swipe"]],[At],[At,{event:"doubletap",taps:2},["tap"]],[Ut]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Qe=1,ce=2;function Xt(t,e){this.options=Y({},B.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=xe(this),this.touchAction=new zt(this,this.options.touchAction),fe(this,!0),x(this.options.recognizers,function(i){var a=this.add(new i[0](i[1]));i[2]&&a.recognizeWith(i[2]),i[3]&&a.requireFailure(i[3])},this)}Xt.prototype={set:function(t){return Y(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ce:Qe},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,a=this.recognizers,u=e.curRecognizer;(!u||u&&u.state&j)&&(u=e.curRecognizer=null);for(var f=0;f<a.length;)i=a[f],e.stopped!==ce&&(!u||i==u||i.canRecognizeWith(u))?i.recognize(t):i.reset(),!u&&i.state&(U|it|G)&&(u=e.curRecognizer=i),f++}},get:function(t){if(t instanceof H)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(y(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(y(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,i=et(e,t);i!==-1&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==o&&e!==o){var i=this.handlers;return x(gt(t),function(a){i[a]=i[a]||[],i[a].push(e)}),this}},off:function(t,e){if(t!==o){var i=this.handlers;return x(gt(t),function(a){e?i[a]&&i[a].splice(et(i[a],e),1):delete i[a]}),this}},emit:function(t,e){this.options.domEvents&&Ze(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(!(!i||!i.length)){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var a=0;a<i.length;)i[a](e),a++}},destroy:function(){this.element&&fe(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function fe(t,e){var i=t.element;if(i.style){var a;x(t.options.cssProps,function(u,f){a=vt(i.style,f),e?(t.oldCssProps[a]=i.style[a],i.style[a]=u):i.style[a]=t.oldCssProps[a]||""}),e||(t.oldCssProps={})}}function Ze(t,e){var i=r.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}Y(B,{INPUT_START:w,INPUT_MOVE:K,INPUT_END:P,INPUT_CANCEL:b,STATE_POSSIBLE:It,STATE_BEGAN:U,STATE_CHANGED:it,STATE_ENDED:G,STATE_RECOGNIZED:j,STATE_CANCELLED:ut,STATE_FAILED:q,DIRECTION_NONE:_t,DIRECTION_LEFT:rt,DIRECTION_RIGHT:nt,DIRECTION_UP:at,DIRECTION_DOWN:ot,DIRECTION_HORIZONTAL:X,DIRECTION_VERTICAL:$,DIRECTION_ALL:Bt,Manager:Xt,Input:D,TouchAction:zt,TouchInput:Pt,MouseInput:Et,PointerEventInput:bt,TouchMouseInput:Lt,SingleTouchInput:ie,Recognizer:H,AttrRecognizer:F,Tap:At,Pan:Mt,Swipe:Yt,Pinch:Dt,Rotate:Ft,Press:Ut,on:pt,off:mt,each:x,merge:de,extend:Vt,assign:Y,inherit:L,bindFn:wt,prefixed:vt});var Je=typeof n<"u"?n:typeof self<"u"?self:{};Je.Hammer=B,s.exports?s.exports=B:n[h]=B})(window,document,"Hammer")}(qt)),qt.exports}ti();let ei=function(){this.interpolateTimeSpan=1e3,this.gl=null,this.canvas=null,this.mapView=null,this.requestId=null,this.prevTime=null,this.prevScale=null,this.viewStatus={drag:!1,dragPrevPos:null,pinchPrevScale:null,zoomScale:300,targetLambdaPhi:null,interpolater:null,currTileLevel:null},this.layerSelect=document.querySelector("#layer"),this.selectedLayer=this.layerSelect.value,this.googleSessions=[];var s=[[-1.29174307860817,.7104078658215001],[-1.34406026074966,.6787546684457174],[-1.24019010226,.73929973401],[-1.40412724747,.43790456061],[-.00142463433,.89850833693],[0,0],[-.785017,1.15794],[-2.066469,.591122],[-1.4407952048317003,.6212504054863001]],n=8;[this.viewStatus.lam0,this.viewStatus.phi0]=s[n],this.zoomMin=.01,this.zoomMax=3e6,this.maxTileLevel=22,this.ringRadius=1e-5,this.rasterProj=null,this.debug=!1,this.animationFramesInit=80,this.animationFrames=this.animationFramesInit,document.addEventListener("DOMContentLoaded",async()=>{this.getQueryParams(),this.canvas=document.querySelector("#webglCanvas"),this.resizeCanvas(this.canvas),this.rasterProj=new O,this.rasterProj.setScale(this.viewStatus.zoomScale),await this.startup(this.rasterProj),this.animation()}),window.addEventListener("resize",()=>{this.resizeCanvas(this.canvas),this.mapView.resizeCanvas(this.canvas),this.rasterProj.clear(this.canvas)}),this.animation=()=>{if(!this.mapView)return;let r=!1,h=new Date().getTime();this.setTileLevel();let o;if(this.viewStatus.interpolater!=null)o=this.viewStatus.interpolater.getPos(h),this.mapView.setProjCenter(o.lp.lambda,o.lp.phi),this.viewStatus.interpolater.isFinished()&&(this.viewStatus.interpolater=null,r=!0);else if(this.viewStatus.targetLambdaPhi!=null){let l=this.mapView.getProjCenter(),c=this.viewStatus.targetLambdaPhi;this.viewStatus.interpolater=ct.create(l,c,[0,0],[0,0],this.interpolateTimeSpan),this.viewStatus.targetLambdaPhi=null}this.prevScale!=this.viewStatus.zoomScale&&(this.rasterProj.setScale(this.viewStatus.zoomScale),this.rasterProj.setFlatRatio(this.ringRadius),this.prevScale=this.viewStatus.zoomScale,r=!0),this.mapView.render(r),this.animationFrames--,console.log("Animation frames left: "+this.animationFrames),this.animationFrames>0?this.requestId=requestAnimationFrame(this.animation):(console.log("Animation finished."),this.animationFrames=this.animationFramesInit,this.mapView.render(!0),this.setQueryParams())},this.startup=async r=>{if(this.gl=this.canvas.getContext("webgl2"),!this.gl)return void alert("Failed to setup WebGL.");this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this.layerSelect.addEventListener("change",this.handleLayerChange.bind(this),!1);let h=new Hammer.Manager(this.canvas,{recognizers:[[Hammer.Pinch,{enable:!0}],[Hammer.Pan,{enable:!0}],[Hammer.Tap,{enable:!0,taps:2}]]});h.on("pinch",this.handlePinch),h.on("pan",this.handlePan),h.on("panstart",this.handlePanStart),h.on("panend pancancel",this.handlePanEnd),h.on("tap",this.handleDoubleTap),window.WheelEvent&&document.addEventListener("wheel",this.handleWheel,!1),document.addEventListener("keydown",this.handleKeydown),this.googleSessions=await this.getSessions(),await this.init(r)},this.init=async r=>{let h=this.canvas.getBoundingClientRect(),o={width:h.width,height:h.height},l={},c={num:100,crossOrigin:!1,debug:this.debug};r.init(this.gl),this.mapView=new C(this.gl,r,o,l,c),this.mapView.setProjCenter(this.viewStatus.lam0,this.viewStatus.phi0),await this.setLayer(),this.setTileLevel(),this.mapView.requestImagesIfNecessary()},this.resizeCanvas=r=>{let h=r.clientWidth,o=r.clientHeight;r.width==h&&r.height==o||(r.width=h,r.height=o),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.setTileLevel=()=>{this.viewStatus.currTileLevel=Math.round(Math.log10(this.viewStatus.zoomScale)*3),this.viewStatus.currTileLevel=Math.max(Math.min(this.viewStatus.currTileLevel,this.maxTileLevel),0),this.mapView.setTileLevel(this.viewStatus.currTileLevel)},this.getQueryParams=()=>{let r=new URLSearchParams(window.location.search),h=r.get("zoom");h&&(h=parseFloat(h),isNaN(h)||(this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,h),this.zoomMax)));let o=r.get("lat"),l=r.get("lon");o&&l&&(o=parseFloat(o),l=parseFloat(l),!isNaN(o)&&!isNaN(l)&&(this.viewStatus.lam0=l*.0174533,this.viewStatus.phi0=o*.0174533)),r.get("local")==""&&(this.debug="local"),r.get("red")==""&&(this.debug="red")},this.getSessions=async()=>{const r=navigator.language||"en-US",o=new Intl.Locale(r).region||"US";let l={language:r,region:o};l.layerTypes=["layerRoadmap"],l.styles=[{featureType:"all",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{visibility:"on"}]}];let c=["satellite","roadmap","terrain"],m=[];for(let T of c){l.mapType=T;const p=await fetch("https://tile.googleapis.com/v1/createSession?key=AIzaSyClBtxCSpwQ7urX6L3ANbVy4atCvaXDwzk",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}}).then(d=>d.text()).catch(d=>{console.error("Error fetching Google Maps Tile Session:",d)}),_=JSON.parse(p);m.push(_.session)}return m},this.setLayer=async()=>{let r=null,h=document.querySelector(".attribution");this.selectedLayer==="mapbox_satellite"?(h.innerHTML=`© <a href="https://www.mapbox.com/about/maps">Mapbox</a> 
        © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>
        © <a href="https://www.maxar.com/">Maxar</a>
        <strong><a href="https://apps.mapbox.com/feedback/" target="_blank">Improve this map</a></strong>`,this.mapView.getURL=function(o,l,c){return`https://api.mapbox.com/v4/mapbox.satellite/${o}/${l}/${c}.png?access_token=${me}`}):this.selectedLayer.slice(0,6)==="google"&&(h.innerHTML="Map data @2025 Google",this.selectedLayer==="google_satellite"?r=this.googleSessions[0]:this.selectedLayer==="google_roadmap"?r=this.googleSessions[1]:this.selectedLayer==="google_terrain"&&(r=this.googleSessions[2]),this.mapView.getURL=function(o,l,c){return`https://tile.googleapis.com/v1/2dtiles/${o}/${l}/${c}?session=${r}&key=${ge}`})},this.setQueryParams=()=>{let r=new URLSearchParams(window.location.search);r.set("zoom",this.viewStatus.zoomScale.toFixed(2)),r.set("lon",(this.viewStatus.lam0*180/Math.PI).toFixed(6)),r.set("lat",(this.viewStatus.phi0*180/Math.PI).toFixed(6)),window.history.replaceState({},"",`${window.location.pathname}?${r.toString()}`)},this.checkAndGetGesturePos=r=>{let h=this.canvas.getBoundingClientRect(),o=r.center.x-h.left,l=r.center.y-h.top;return o<0||l<0||h.width<o||h.height<l?null:[o,l]},this.handleLayerChange=async r=>{this.selectedLayer=r.target.value,await this.setLayer(),await this.init(this.rasterProj),this.animation()},this.handleKeydown=r=>{switch(r.key){case"=":case"+":this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1;break;case"-":case"_":this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1;break}this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.handleWheel=r=>{r.deltaY<0?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.handlePinch=r=>{r.scale>1?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.05:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.05,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation),this.setQueryParams()},this.getPanRate=r=>r<1?100:r<10?300:r<100?500:r<1e3?1e3:r<1e4?1e4:r<1e5?5e4:r,this.handlePan=r=>{if(this.viewStatus.drag){let h=this.checkAndGetGesturePos(r);if(h!=null){if(this.viewStatus.dragPrevPos){r.preventDefault();let o=this.getPanRate(this.viewStatus.zoomScale),l=(h[0]-this.viewStatus.dragPrevPos[0])/o,c=(h[1]-this.viewStatus.dragPrevPos[1])/o,m=this.mapView.getProjCenter(),T=m.lambda-l,p=Math.max(Math.min(m.phi+c,Math.PI/2),-Math.PI/2);this.mapView.setProjCenter(T,p)}this.viewStatus.dragPrevPos=h}}},this.handlePanStart=r=>{this.viewStatus.drag=!0;let h=this.checkAndGetGesturePos(r);h&&(r.preventDefault(),this.viewStatus.dragPrevPos=h,this.requestId=requestAnimationFrame(this.animation))},this.handlePanEnd=r=>{this.viewStatus.drag=!1,this.viewStatus.dragPrevPos=null,this.mapView.render(!0)},this.handleDoubleTap=r=>{let h=this.checkAndGetGesturePos(r);if(h){r.preventDefault();let o=this.mapView.getLambdaPhiPointFromWindow(h[0],h[1]);this.viewStatus.lam0=o.lambda,this.viewStatus.phi0=o.phi,this.viewStatus.targetLambdaPhi=o,this.requestId=requestAnimationFrame(this.animation)}},this.handleContextLost=r=>{r.preventDefault(),cancelAnimationFrame(this.requestId),this.mapView.resetImages()},this.handleContextRestored=r=>{this.init(this.rasterProj),this.requestId=requestAnimationFrame(animation)}};new ei;
//# sourceMappingURL=index-bT1L_O5K.js.map
