(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function h(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();let g=function(){};g.EPSILON=1e-7;g.SQRT_2=Math.sqrt(2);g.PI_SQ=Math.PI*Math.PI;g.HALF_PI=Math.PI/2;g.clamp=function(i,r,n){return Math.max(r,Math.min(n,i))};g.atan2Range=function(i,r){console.assert(i.min<=i.max),console.assert(r.min<=r.max);let n=r.min,h=r.max,o=i.min,u=i.max;if(0<=o)return 0<n?{min:Math.atan2(o,h),max:Math.atan2(u,n)}:h<0?{min:Math.atan2(u,h),max:Math.atan2(o,n)}:{min:Math.atan2(o,h),max:Math.atan2(o,n)};if(u<0)return 0<n?{min:Math.atan2(o,n),max:Math.atan2(u,h)}:h<0?{min:Math.atan2(u,n),max:Math.atan2(o,h)}:{min:Math.atan2(u,n),max:Math.atan2(u,h)};if(0<n)return{min:Math.atan2(o,n),max:Math.atan2(u,n)};if(h<0){let c=Math.atan2(u,h),p=Math.atan2(o,h);return Math.PI<=c?{min:c-2*Math.PI,max:p}:{min:c,max:p+2*Math.PI}}return{min:-Math.PI,max:Math.PI}};g.toLambdaPhi=function(i){let r=Math.sqrt(i[0]*i[0]+i[1]*i[1]),n=Math.atan2(i[1],i[0]),h=Math.atan2(i[2],r);return{lambda:n,phi:h}};g.normalizeLambda=function(i){return-Math.PI<=i&&i<Math.PI?i:i-2*Math.PI*Math.floor((i+Math.PI)/(2*Math.PI))};g.neighborPoint=function(i,r){if(g.EPSILON<=Math.abs(i.phi-r.phi))return!1;let n=g.normalizeLambda(i.lambda),h=g.normalizeLambda(r.lambda);return Math.abs(n-h)<g.EPSILON};g.sphericalDistance=function(i,r){return Math.acos(Math.sin(i.phi)*Math.sin(r.phi)+Math.cos(i.phi)*Math.cos(r.phi)*Math.cos(g.normalizeLambda(r.lambda-i.lambda)))};let Z=function(){};Z.smoothstep=function(i,r,n){let h=g.clamp((n-i)/(r-i),0,1);return h*h*(3-2*h)};Z.smootherstep=function(i,r,n){let h=g.clamp((n-i)/(r-i),0,1);return h*h*h*(h*(6*h-15)+10)};Z.toUnitVector3d=function(i,r){let n=Math.cos(r);return[Math.cos(i)*n,Math.sin(i)*n,Math.sin(r)]};Z.slerp=function(i,r,n){let h=g.clamp(i[0]*r[0]+i[1]*r[1]+i[2]*r[2],-1,1);if(1-g.EPSILON<h)return[(i[0]+r[0])/2,(i[1]+r[1])/2,(i[2]+r[2])/2];h<-(1-g.EPSILON);let o=Math.acos(h),u=Math.sin(o),c=Math.sin((1-n)*o)/u,p=Math.sin(n*o)/u;return[c*i[0]+p*r[0],c*i[1]+p*r[1],c*i[2]+p*r[2]]};let ct=function(i,r,n,h,o){this.v1=Z.toUnitVector3d(i.lambda,i.phi),this.v2=Z.toUnitVector3d(r.lambda,r.phi),this.iniViewPos=n,this.finViewPos=h,this.timeSpan=o,this.startTime=null,this.finished=!1};ct.create=function(i,r,n,h,o){return g.neighborPoint(i,r)?null:(Math.PI-g.EPSILON<Math.abs(r.phi-i.phi)&&(i={lambda:i.lambda,phi:i.phi+1e-4*(0<i.phi?-1:1)}),new ct(i,r,n,h,o))};ct.prototype.getPos=function(i){let r=0;if(this.startTime==null)this.startTime=i;else{let c=i-this.startTime;r=g.clamp(c/this.timeSpan,0,1),this.startTime+this.timeSpan<i&&(this.finished=!0)}let n=Z.smootherstep(0,1,r),h=Z.slerp(this.v1,this.v2,n),o=g.toLambdaPhi(h),u=[this.iniViewPos[0]*(1-n)+this.finViewPos[0]*n,this.iniViewPos[1]*(1-n)+this.finViewPos[1]*n];return{lp:o,viewPos:u}};ct.prototype.isFinished=function(){return this.finished};var qt={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var pe;function Je(){return pe||(pe=1,function(i){(function(r,n,h,o){var u=["","webkit","Moz","MS","ms","o"],c=n.createElement("div"),p="function",_=Math.round,m=Math.abs,T=Date.now;function v(t,e,s){return setTimeout(Ct(t,s),e)}function y(t,e,s){return Array.isArray(t)?(x(t,s[e],s),!0):!1}function x(t,e,s){var a;if(t)if(t.forEach)t.forEach(e,s);else if(t.length!==o)for(a=0;a<t.length;)e.call(s,t[a],a,t),a++;else for(a in t)t.hasOwnProperty(a)&&e.call(s,t[a],a,t)}function L(t,e,s){var a="DEPRECATED METHOD: "+e+`
`+s+` AT 
`;return function(){var l=new Error("get-stack-trace"),f=l&&l.stack?l.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",d=r.console&&(r.console.warn||r.console.log);return d&&d.call(r.console,a,f),t.apply(this,arguments)}}var X;typeof Object.assign!="function"?X=function(e){if(e===o||e===null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(e),a=1;a<arguments.length;a++){var l=arguments[a];if(l!==o&&l!==null)for(var f in l)l.hasOwnProperty(f)&&(s[f]=l[f])}return s}:X=Object.assign;var Vt=L(function(e,s,a){for(var l=Object.keys(s),f=0;f<l.length;)(!a||a&&e[l[f]]===o)&&(e[l[f]]=s[l[f]]),f++;return e},"extend","Use `assign`."),de=L(function(e,s){return Vt(e,s,!0)},"merge","Use `assign`.");function b(t,e,s){var a=e.prototype,l;l=t.prototype=Object.create(a),l.constructor=t,l._super=a,s&&X(l,s)}function Ct(t,e){return function(){return t.apply(e,arguments)}}function Rt(t,e){return typeof t==p?t.apply(e&&e[0]||o,e):t}function Wt(t,e){return t===o?e:t}function pt(t,e,s){x(dt(e),function(a){t.addEventListener(a,s,!1)})}function mt(t,e,s){x(dt(e),function(a){t.removeEventListener(a,s,!1)})}function Ht(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function J(t,e){return t.indexOf(e)>-1}function dt(t){return t.trim().split(/\s+/g)}function et(t,e,s){if(t.indexOf&&!s)return t.indexOf(e);for(var a=0;a<t.length;){if(s&&t[a][s]==e||!s&&t[a]===e)return a;a++}return-1}function gt(t){return Array.prototype.slice.call(t,0)}function jt(t,e,s){for(var a=[],l=[],f=0;f<t.length;){var d=t[f][e];et(l,d)<0&&a.push(t[f]),l[f]=d,f++}return a=a.sort(function(A,R){return A[e]>R[e]}),a}function vt(t,e){for(var s,a,l=e[0].toUpperCase()+e.slice(1),f=0;f<u.length;){if(s=u[f],a=s?s+l:e,a in t)return a;f++}return o}var ge=1;function ve(){return ge++}function kt(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var Te=/mobile|tablet|ip(ad|hone|od)|android/i,Bt="ontouchstart"in r,_e=vt(r,"PointerEvent")!==o,Ee=Bt&&Te.test(navigator.userAgent),st="touch",ye="pen",wt="mouse",Pe="kinect",Ie=25,C=1,K=2,I=4,O=8,Tt=1,rt=2,nt=4,at=8,ot=16,F=rt|nt,$=at|ot,Gt=F|$,Qt=["x","y"],_t=["clientX","clientY"];function z(t,e){var s=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(a){Rt(t.options.enable,[t])&&s.handler(a)},this.init()}z.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler),this.evTarget&&pt(this.target,this.evTarget,this.domHandler),this.evWin&&pt(kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(kt(this.element),this.evWin,this.domHandler)}};function Se(t){var e,s=t.options.inputClass;return s?e=s:_e?e=Ot:Ee?e=Pt:Bt?e=bt:e=yt,new e(t,xe)}function xe(t,e,s){var a=s.pointers.length,l=s.changedPointers.length,f=e&C&&a-l===0,d=e&(I|O)&&a-l===0;s.isFirst=!!f,s.isFinal=!!d,f&&(t.session={}),s.eventType=e,Me(t,s),t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}function Me(t,e){var s=t.session,a=e.pointers,l=a.length;s.firstInput||(s.firstInput=Zt(e)),l>1&&!s.firstMultiple?s.firstMultiple=Zt(e):l===1&&(s.firstMultiple=!1);var f=s.firstInput,d=s.firstMultiple,M=d?d.center:f.center,A=e.center=Jt(a);e.timeStamp=T(),e.deltaTime=e.timeStamp-f.timeStamp,e.angle=Nt(M,A),e.distance=Et(M,A),Ae(s,e),e.offsetDirection=$t(e.deltaX,e.deltaY);var R=Kt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=R.x,e.overallVelocityY=R.y,e.overallVelocity=m(R.x)>m(R.y)?R.x:R.y,e.scale=d?we(d.pointers,a):1,e.rotation=d?Re(d.pointers,a):0,e.maxPointers=s.prevInput?e.pointers.length>s.prevInput.maxPointers?e.pointers.length:s.prevInput.maxPointers:e.pointers.length,Ce(s,e);var V=t.element;Ht(e.srcEvent.target,V)&&(V=e.srcEvent.target),e.target=V}function Ae(t,e){var s=e.center,a=t.offsetDelta||{},l=t.prevDelta||{},f=t.prevInput||{};(e.eventType===C||f.eventType===I)&&(l=t.prevDelta={x:f.deltaX||0,y:f.deltaY||0},a=t.offsetDelta={x:s.x,y:s.y}),e.deltaX=l.x+(s.x-a.x),e.deltaY=l.y+(s.y-a.y)}function Ce(t,e){var s=t.lastInterval||e,a=e.timeStamp-s.timeStamp,l,f,d,M;if(e.eventType!=O&&(a>Ie||s.velocity===o)){var A=e.deltaX-s.deltaX,R=e.deltaY-s.deltaY,V=Kt(a,A,R);f=V.x,d=V.y,l=m(V.x)>m(V.y)?V.x:V.y,M=$t(A,R),t.lastInterval=e}else l=s.velocity,f=s.velocityX,d=s.velocityY,M=s.direction;e.velocity=l,e.velocityX=f,e.velocityY=d,e.direction=M}function Zt(t){for(var e=[],s=0;s<t.pointers.length;)e[s]={clientX:_(t.pointers[s].clientX),clientY:_(t.pointers[s].clientY)},s++;return{timeStamp:T(),pointers:e,center:Jt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function Jt(t){var e=t.length;if(e===1)return{x:_(t[0].clientX),y:_(t[0].clientY)};for(var s=0,a=0,l=0;l<e;)s+=t[l].clientX,a+=t[l].clientY,l++;return{x:_(s/e),y:_(a/e)}}function Kt(t,e,s){return{x:e/t||0,y:s/t||0}}function $t(t,e){return t===e?Tt:m(t)>=m(e)?t<0?rt:nt:e<0?at:ot}function Et(t,e,s){s||(s=Qt);var a=e[s[0]]-t[s[0]],l=e[s[1]]-t[s[1]];return Math.sqrt(a*a+l*l)}function Nt(t,e,s){s||(s=Qt);var a=e[s[0]]-t[s[0]],l=e[s[1]]-t[s[1]];return Math.atan2(l,a)*180/Math.PI}function Re(t,e){return Nt(e[1],e[0],_t)+Nt(t[1],t[0],_t)}function we(t,e){return Et(e[0],e[1],_t)/Et(t[0],t[1],_t)}var Ne={mousedown:C,mousemove:K,mouseup:I},Oe="mousedown",be="mousemove mouseup";function yt(){this.evEl=Oe,this.evWin=be,this.pressed=!1,z.apply(this,arguments)}b(yt,z,{handler:function(e){var s=Ne[e.type];s&C&&e.button===0&&(this.pressed=!0),s&K&&e.which!==1&&(s=I),this.pressed&&(s&I&&(this.pressed=!1),this.callback(this.manager,s,{pointers:[e],changedPointers:[e],pointerType:wt,srcEvent:e}))}});var Le={pointerdown:C,pointermove:K,pointerup:I,pointercancel:O,pointerout:O},ze={2:st,3:ye,4:wt,5:Pe},te="pointerdown",ee="pointermove pointerup pointercancel";r.MSPointerEvent&&!r.PointerEvent&&(te="MSPointerDown",ee="MSPointerMove MSPointerUp MSPointerCancel");function Ot(){this.evEl=te,this.evWin=ee,z.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}b(Ot,z,{handler:function(e){var s=this.store,a=!1,l=e.type.toLowerCase().replace("ms",""),f=Le[l],d=ze[e.pointerType]||e.pointerType,M=d==st,A=et(s,e.pointerId,"pointerId");f&C&&(e.button===0||M)?A<0&&(s.push(e),A=s.length-1):f&(I|O)&&(a=!0),!(A<0)&&(s[A]=e,this.callback(this.manager,f,{pointers:s,changedPointers:[e],pointerType:d,srcEvent:e}),a&&s.splice(A,1))}});var De={touchstart:C,touchmove:K,touchend:I,touchcancel:O},Ue="touchstart",Ye="touchstart touchmove touchend touchcancel";function ie(){this.evTarget=Ue,this.evWin=Ye,this.started=!1,z.apply(this,arguments)}b(ie,z,{handler:function(e){var s=De[e.type];if(s===C&&(this.started=!0),!!this.started){var a=Xe.call(this,e,s);s&(I|O)&&a[0].length-a[1].length===0&&(this.started=!1),this.callback(this.manager,s,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}}});function Xe(t,e){var s=gt(t.touches),a=gt(t.changedTouches);return e&(I|O)&&(s=jt(s.concat(a),"identifier")),[s,a]}var Fe={touchstart:C,touchmove:K,touchend:I,touchcancel:O},qe="touchstart touchmove touchend touchcancel";function Pt(){this.evTarget=qe,this.targetIds={},z.apply(this,arguments)}b(Pt,z,{handler:function(e){var s=Fe[e.type],a=Ve.call(this,e,s);a&&this.callback(this.manager,s,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}});function Ve(t,e){var s=gt(t.touches),a=this.targetIds;if(e&(C|K)&&s.length===1)return a[s[0].identifier]=!0,[s,s];var l,f,d=gt(t.changedTouches),M=[],A=this.target;if(f=s.filter(function(R){return Ht(R.target,A)}),e===C)for(l=0;l<f.length;)a[f[l].identifier]=!0,l++;for(l=0;l<d.length;)a[d[l].identifier]&&M.push(d[l]),e&(I|O)&&delete a[d[l].identifier],l++;if(M.length)return[jt(f.concat(M),"identifier"),M]}var We=2500,se=25;function bt(){z.apply(this,arguments);var t=Ct(this.handler,this);this.touch=new Pt(this.manager,t),this.mouse=new yt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}b(bt,z,{handler:function(e,s,a){var l=a.pointerType==st,f=a.pointerType==wt;if(!(f&&a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents)){if(l)He.call(this,s,a);else if(f&&je.call(this,a))return;this.callback(e,s,a)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function He(t,e){t&C?(this.primaryTouch=e.changedPointers[0].identifier,re.call(this,e)):t&(I|O)&&re.call(this,e)}function re(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var s={x:e.clientX,y:e.clientY};this.lastTouches.push(s);var a=this.lastTouches,l=function(){var f=a.indexOf(s);f>-1&&a.splice(f,1)};setTimeout(l,We)}}function je(t){for(var e=t.srcEvent.clientX,s=t.srcEvent.clientY,a=0;a<this.lastTouches.length;a++){var l=this.lastTouches[a],f=Math.abs(e-l.x),d=Math.abs(s-l.y);if(f<=se&&d<=se)return!0}return!1}var ne=vt(c.style,"touchAction"),ae=ne!==o,oe="compute",he="auto",Lt="manipulation",tt="none",ht="pan-x",lt="pan-y",It=Be();function zt(t,e){this.manager=t,this.set(e)}zt.prototype={set:function(t){t==oe&&(t=this.compute()),ae&&this.manager.element.style&&It[t]&&(this.manager.element.style[ne]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return x(this.manager.recognizers,function(e){Rt(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),ke(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,s=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var a=this.actions,l=J(a,tt)&&!It[tt],f=J(a,lt)&&!It[lt],d=J(a,ht)&&!It[ht];if(l){var M=t.pointers.length===1,A=t.distance<2,R=t.deltaTime<250;if(M&&A&&R)return}if(!(d&&f)&&(l||f&&s&F||d&&s&$))return this.preventSrc(e)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function ke(t){if(J(t,tt))return tt;var e=J(t,ht),s=J(t,lt);return e&&s?tt:e||s?e?ht:lt:J(t,Lt)?Lt:he}function Be(){if(!ae)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(s){t[s]=e?r.CSS.supports("touch-action",s):!0}),t}var St=1,D=2,it=4,G=8,j=G,ut=16,q=32;function k(t){this.options=X({},this.defaults,t||{}),this.id=ve(),this.manager=null,this.options.enable=Wt(this.options.enable,!0),this.state=St,this.simultaneous={},this.requireFail=[]}k.prototype={defaults:{},set:function(t){return X(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(y(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=xt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return y(t,"dropRecognizeWith",this)?this:(t=xt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(y(t,"requireFailure",this))return this;var e=this.requireFail;return t=xt(t,this),et(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(y(t,"dropRequireFailure",this))return this;t=xt(t,this);var e=et(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,s=this.state;function a(l){e.manager.emit(l,t)}s<G&&a(e.options.event+le(s)),a(e.options.event),t.additionalEvent&&a(t.additionalEvent),s>=G&&a(e.options.event+le(s))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=q},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(q|St)))return!1;t++}return!0},recognize:function(t){var e=X({},t);if(!Rt(this.options.enable,[this,e])){this.reset(),this.state=q;return}this.state&(j|ut|q)&&(this.state=St),this.state=this.process(e),this.state&(D|it|G|ut)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}};function le(t){return t&ut?"cancel":t&G?"end":t&it?"move":t&D?"start":""}function ue(t){return t==ot?"down":t==at?"up":t==rt?"left":t==nt?"right":""}function xt(t,e){var s=e.manager;return s?s.get(t):t}function Y(){k.apply(this,arguments)}b(Y,k,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return e===0||t.pointers.length===e},process:function(t){var e=this.state,s=t.eventType,a=e&(D|it),l=this.attrTest(t);return a&&(s&O||!l)?e|ut:a||l?s&I?e|G:e&D?e|it:D:q}});function Mt(){Y.apply(this,arguments),this.pX=null,this.pY=null}b(Mt,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:Gt},getTouchAction:function(){var t=this.options.direction,e=[];return t&F&&e.push(lt),t&$&&e.push(ht),e},directionTest:function(t){var e=this.options,s=!0,a=t.distance,l=t.direction,f=t.deltaX,d=t.deltaY;return l&e.direction||(e.direction&F?(l=f===0?Tt:f<0?rt:nt,s=f!=this.pX,a=Math.abs(t.deltaX)):(l=d===0?Tt:d<0?at:ot,s=d!=this.pY,a=Math.abs(t.deltaY))),t.direction=l,s&&a>e.threshold&&l&e.direction},attrTest:function(t){return Y.prototype.attrTest.call(this,t)&&(this.state&D||!(this.state&D)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=ue(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}});function Dt(){Y.apply(this,arguments)}b(Dt,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&D)},emit:function(t){if(t.scale!==1){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}});function Ut(){k.apply(this,arguments),this._timer=null,this._input=null}b(Ut,k,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,a=t.distance<e.threshold,l=t.deltaTime>e.time;if(this._input=t,!a||!s||t.eventType&(I|O)&&!l)this.reset();else if(t.eventType&C)this.reset(),this._timer=v(function(){this.state=j,this.tryEmit()},e.time,this);else if(t.eventType&I)return j;return q},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===j&&(t&&t.eventType&I?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function Yt(){Y.apply(this,arguments)}b(Yt,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&D)}});function Xt(){Y.apply(this,arguments)}b(Xt,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:F|$,pointers:1},getTouchAction:function(){return Mt.prototype.getTouchAction.call(this)},attrTest:function(t){var e=this.options.direction,s;return e&(F|$)?s=t.overallVelocity:e&F?s=t.overallVelocityX:e&$&&(s=t.overallVelocityY),this._super.attrTest.call(this,t)&&e&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&m(s)>this.options.velocity&&t.eventType&I},emit:function(t){var e=ue(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}});function At(){k.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}b(At,k,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Lt]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,a=t.distance<e.threshold,l=t.deltaTime<e.time;if(this.reset(),t.eventType&C&&this.count===0)return this.failTimeout();if(a&&l&&s){if(t.eventType!=I)return this.failTimeout();var f=this.pTime?t.timeStamp-this.pTime<e.interval:!0,d=!this.pCenter||Et(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!d||!f?this.count=1:this.count+=1,this._input=t;var M=this.count%e.taps;if(M===0)return this.hasRequireFailures()?(this._timer=v(function(){this.state=j,this.tryEmit()},e.interval,this),D):j}return q},failTimeout:function(){return this._timer=v(function(){this.state=q},this.options.interval,this),q},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==j&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Q(t,e){return e=e||{},e.recognizers=Wt(e.recognizers,Q.defaults.preset),new Ft(t,e)}Q.VERSION="2.0.7",Q.defaults={domEvents:!1,touchAction:oe,enable:!0,inputTarget:null,inputClass:null,preset:[[Yt,{enable:!1}],[Dt,{enable:!1},["rotate"]],[Xt,{direction:F}],[Mt,{direction:F},["swipe"]],[At],[At,{event:"doubletap",taps:2},["tap"]],[Ut]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ge=1,ce=2;function Ft(t,e){this.options=X({},Q.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=Se(this),this.touchAction=new zt(this,this.options.touchAction),fe(this,!0),x(this.options.recognizers,function(s){var a=this.add(new s[0](s[1]));s[2]&&a.recognizeWith(s[2]),s[3]&&a.requireFailure(s[3])},this)}Ft.prototype={set:function(t){return X(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ce:Ge},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var s,a=this.recognizers,l=e.curRecognizer;(!l||l&&l.state&j)&&(l=e.curRecognizer=null);for(var f=0;f<a.length;)s=a[f],e.stopped!==ce&&(!l||s==l||s.canRecognizeWith(l))?s.recognize(t):s.reset(),!l&&s.state&(D|it|G)&&(l=e.curRecognizer=s),f++}},get:function(t){if(t instanceof k)return t;for(var e=this.recognizers,s=0;s<e.length;s++)if(e[s].options.event==t)return e[s];return null},add:function(t){if(y(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(y(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,s=et(e,t);s!==-1&&(e.splice(s,1),this.touchAction.update())}return this},on:function(t,e){if(t!==o&&e!==o){var s=this.handlers;return x(dt(t),function(a){s[a]=s[a]||[],s[a].push(e)}),this}},off:function(t,e){if(t!==o){var s=this.handlers;return x(dt(t),function(a){e?s[a]&&s[a].splice(et(s[a],e),1):delete s[a]}),this}},emit:function(t,e){this.options.domEvents&&Qe(t,e);var s=this.handlers[t]&&this.handlers[t].slice();if(!(!s||!s.length)){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var a=0;a<s.length;)s[a](e),a++}},destroy:function(){this.element&&fe(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function fe(t,e){var s=t.element;if(s.style){var a;x(t.options.cssProps,function(l,f){a=vt(s.style,f),e?(t.oldCssProps[a]=s.style[a],s.style[a]=l):s.style[a]=t.oldCssProps[a]||""}),e||(t.oldCssProps={})}}function Qe(t,e){var s=n.createEvent("Event");s.initEvent(t,!0,!0),s.gesture=e,e.target.dispatchEvent(s)}X(Q,{INPUT_START:C,INPUT_MOVE:K,INPUT_END:I,INPUT_CANCEL:O,STATE_POSSIBLE:St,STATE_BEGAN:D,STATE_CHANGED:it,STATE_ENDED:G,STATE_RECOGNIZED:j,STATE_CANCELLED:ut,STATE_FAILED:q,DIRECTION_NONE:Tt,DIRECTION_LEFT:rt,DIRECTION_RIGHT:nt,DIRECTION_UP:at,DIRECTION_DOWN:ot,DIRECTION_HORIZONTAL:F,DIRECTION_VERTICAL:$,DIRECTION_ALL:Gt,Manager:Ft,Input:z,TouchAction:zt,TouchInput:Pt,MouseInput:yt,PointerEventInput:Ot,TouchMouseInput:bt,SingleTouchInput:ie,Recognizer:k,AttrRecognizer:Y,Tap:At,Pan:Mt,Swipe:Xt,Pinch:Dt,Rotate:Yt,Press:Ut,on:pt,off:mt,each:x,merge:de,extend:Vt,assign:X,inherit:b,bindFn:Ct,prefixed:vt});var Ze=typeof r<"u"?r:typeof self<"u"?self:{};Ze.Hammer=Q,i.exports?i.exports=Q:r[h]=Q})(window,document,"Hammer")}(qt)),qt.exports}Je();let H=function(i,r){this.rasterProj=r,this.tileSize=256,this.centerOffset={X:0,Y:0},this.centerQuadkey=null};H.prototype.resizeCanvas=function(i){};H.prototype.getCenterTileInfo=function(i,r,n){let h=Math.sin(r),o=(i+Math.PI)/(2*Math.PI)*this.tileSize*Math.pow(2,n),u=(.5-Math.log((1+h)/(1-h))/(4*Math.PI))*this.tileSize*Math.pow(2,n),c=Math.floor(o/this.tileSize),p=Math.floor(u/this.tileSize),_=o/this.tileSize%1,m=u/this.tileSize%1;this.centerOffset={X:_,Y:m},this.centerQuadkey=this.tileXYToQuadkey(c,p,n)};H.prototype.tileXYToQuadkey=function(i,r,n){let h="";for(let o=n;o>0;o--){let u=0;const c=1<<o-1;(i&c)!==0&&(u|=1),(r&c)!==0&&(u|=2),h+=u.toString()}return h};function Ke(i){let r=0,n=0;const h=i.length;for(let o=h;o>0;o--){const u=1<<o-1,c=parseInt(i.charAt(h-o));c&1&&(r|=u),c&2&&(n|=u)}return{x:r,y:n,z:h}}H.prototype.getRectFromXYZ=function(i){let r=-Math.PI,n=Math.PI/2,h=Math.PI*2,o=Math.PI,u=h/Math.pow(2,i.xyz.z),c=o/Math.pow(2,i.xyz.z),p=r+i.xyz.x*u,_=n-i.xyz.y*c,m=r+(i.xyz.x+1)*u,T=n-(i.xyz.y+1)*c;return[p,T,m,_]};H.prototype.getNSWEtiles=function(i,r=[N,S,W,E,NE,NW,SE,SW]){let n=0,h=1,o=2,u=3,c=4,p=5,_=6,m=7,T=[],{x:v,y,z:x}=i.xyz,L=Math.pow(2,x)-1;return r.length===0||(r.includes(n)&&y>0&&T.push({xyz:{x:v,y:y-1,z:x}}),r.includes(c)&&y<L&&T.push({xyz:{x:v,y:y+1,z:x}}),r.includes(_)&&T.push({xyz:{x:v==0?L:v-1,y,z:x}}),r.includes(o)&&T.push({xyz:{x:v==L?0:v+1,y,z:x}}),r.includes(h)&&y>0&&T.push({xyz:{x:v==L?0:v+1,y:y-1,z:x}}),r.includes(m)&&y>0&&T.push({xyz:{x:v==0?L:v-1,y:y-1,z:x}}),r.includes(u)&&y<L&&T.push({xyz:{x:v==L?0:v+1,y:y+1,z:x}}),r.includes(p)&&y<L&&T.push({xyz:{x:v==0?L:v-1,y:y+1,z:x}})),T};H.prototype.getAdjacentTiles=function(i){let r=[],n=[],h=0,o=1,u=2,c=3,p=4,_=5,m=6,T=7,v=i.quadkey.slice(-1);return v==="0"?n=this.getNSWEtiles(i,[h,m,T]):v==="1"?n=this.getNSWEtiles(i,[h,u,o]):v==="2"?n=this.getNSWEtiles(i,[p,m,_]):v==="3"&&(n=this.getNSWEtiles(i,[p,u,c])),r.push(...n),r};H.prototype.getFirstQuadkey=function(i,r,n){let{tileX:h,tileY:o,centerOffsetX:u,centerOffsetY:c}=this.getCenterTileInfo(i,r,n);return{tileQuadkey:this.tileXYToQuadkey(h,o,n),centerOffset:{X:u,Y:c}}};H.prototype.pushLevelOneTiles=function(i){let r=[{xyz:{x:0,y:0,z:1},quadkey:"0"},{xyz:{x:1,y:0,z:1},quadkey:"1"},{xyz:{x:0,y:1,z:1},quadkey:"2"},{xyz:{x:1,y:1,z:1},quadkey:"3"}];i.push(...r)};H.prototype.getTileInfos=function(i,r,n,h){let o=[],u=null;this.getCenterTileInfo(i,r,n);for(let c=n;c>=2;c--){let p;u?p=u.quadkey.slice(0,-1):p=this.centerQuadkey;let m={xyz:Ke(p),quadkey:p};o.push(m);let T=this.getAdjacentTiles(m);o.push(...T),u=m}this.pushLevelOneTiles(o);for(const c of o)c.rect=this.getRectFromXYZ(c),c.url=h(c.xyz.z,c.xyz.x,c.xyz.y);return{tileArray:o.reverse(),centerOffset:this.centerOffset}};class $e{constructor(r){this.cache=new Map,this.capacity=r}get(r){if(!this.cache.has(r))return!1;let n=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,n),n}put(r,n){this.cache.delete(r),this.cache.size===this.capacity?(this.cache.delete(this.cache.keys().next().value),this.cache.set(r,n)):this.cache.set(r,n)}}let ft=function(i){this.num=32,this.crossOrigin=null,this.loading={},this.ongoingImageLoads=[],this.debug=!1,typeof i<"u"&&("num"in i&&(this.num=i.num),"crossOrigin"in i&&(this.crossOrigin=i.crossOrigin),"debug"in i&&(this.debug=i.debug)),this.createTexture=null,this.textures=new $e(this.num)};ft.prototype.loadImage_=function(i,r){const{promise:n,resolve:h,reject:o}=Promise.withResolvers();this.loading[i]=!0;let u=new Image;this.crossOrigin!=null&&(u.crossOrigin=this.crossOrigin);let c=this,p=this.debug,_;u.onload=async function(){if(c.ongoingImageLoads.splice(c.ongoingImageLoads.indexOf(u),1),c.createTexture==null)return;let m=c.createTexture(u);if(m&&c.textures.put(i,[m,r]),delete c.loading.url,p=="red"){let T=new OffscreenCanvas(256,256),v=T.getContext("2d");v.drawImage(u,0,0),v.strokeStyle="red",v.lineWidth=5,v.strokeRect(0,0,u.width,u.height);const y=await T.convertToBlob({type:"image/png"});_=new Image,_.src=URL.createObjectURL(y),h(_)}},p=="red"&&n.then(m=>{u.src=m.src}),this.ongoingImageLoads.push(u),p=="local"?u.src=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAACVBMVEX/AAAAAADAwMALHWY1AAAAqUlEQVR4nO3QwQnDABADQX/Sl5vwIwWkJdfrIiQwEXPcWzB7HK/f54ruLAzc31/wjYGBBggICAgIxYG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARAQEBASEIiEeiBsMRERAQEBAKBLigbjBQEQEBAQEhCIhHogbDEREQEBAQCgS4oG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARASEDcL/3wP26M0z+9z7bgAAAABJRU5ErkJggg==",import.meta.url):u.src=i};ft.prototype.loadImageIfAbsent=function(i,r){return this.textures.get(i)||i in this.loading?!1:(this.loadImage_(i,r),!0)};ft.prototype.getTexture=function(i){return this.textures.get(i)};ft.prototype.clearOngoingImageLoads=function(){for(let i=0;i<this.ongoingImageLoads.length;i++)this.ongoingImageLoads[i].onload=void 0;this.ongoingImageLoads=[]};let w=function(i,r,n,h,o){this.gl=i,this.rasterProj=r,this.canvasSize=n,this.tileManager=new H(h,this.rasterProj),this.prevTileInfos_=null,this.prevWindow_=null,this.imageCache=new ft(o);let u=this;this.imageCache.createTexture=function(c){return u.createTexture(c)},this.tileInfos=null,this.centerOffset=null,this.getURL=null,this.calculateLevel=null,this.currTileLevel=0,this.lam0=0,this.phi0=0};w.prototype.clearTileInfoCache_=function(){this.prevWindow_=null,this.prevTileInfos_=null};w.prototype.setProjCenter=function(i,r){this.lam0=i,this.phi0=r,this.clearTileInfoCache_(),this.rasterProj.setProjCenter(i,r)};w.prototype.getProjCenter=function(){return this.rasterProj.projection.getProjCenter()};w.prototype.resizeCanvas=function(i){this.canvasSize.width=i.width,this.canvasSize.height=i.height,this.tileManager.resizeCanvas(this.canvasSize)};w.prototype.setTileLevel=function(i){this.currTileLevel=i};w.prototype.getViewPointFromWindow=function(i,r){let n=Math.PI*2/this.canvasSize.width,h=Math.PI*2/-this.canvasSize.height,o=-Math.PI+i*n,u=-Math.PI+(r-this.canvasSize.height)*h;return[o,u]};w.prototype.getLambdaPhiPointFromWindow=function(i,r){let n=this.getViewPointFromWindow(i,r);return this.rasterProj.projection.inverse(n[0],n[1])};w.prototype.resetImages=function(){this.imageCache.clearOngoingImageLoads()};w.prototype.requestImagesIfNecessary=function(){return this.getURL==null?-1:(this.getTileInfos_(),this.requestImages_(this.tileInfos))};w.prototype.render=function(i){this.getURL!=null&&(i&&(this.getTileInfos_(),this.requestImages_(this.tileInfos)),this.render_(this.tileInfos))};w.prototype.createTexture=function(i){let r=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this.gl.bindTexture(this.gl.TEXTURE_2D,null),r};w.prototype.getTileInfos_=function(){let{tileArray:i,centerOffset:r}=this.tileManager.getTileInfos(this.lam0,this.phi0,this.currTileLevel,this.getURL);this.tileInfos=i,this.centerOffset=r};w.prototype.requestImages_=function(){let i=0;for(let r=0;r<this.tileInfos.length;++r)this.imageCache.loadImageIfAbsent(this.tileInfos[r].url,this.tileInfos[r].rect)&&++i;return i};w.prototype.render_=function(){this.rasterProj.clear(this.canvasSize);let i=[];for(let n=0;n<this.tileInfos.length;++n){let h=this.tileInfos[n],o=this.imageCache.getTexture(h.url);o&&i.push(o)}let r=new Float32Array([0,0,0,1,1,0,1,1]);this.rasterProj.prepareRender(r,[-Math.PI,-Math.PI,Math.PI,Math.PI]),0<i.length&&this.rasterProj.renderTextures(i,this.centerOffset)};let P=function(i){this.gl_=i,this.vbo_=null,this.program_=null,this.locTexture_=null,this.locAlpha_=null,this.locProjCenter_=null,this.locViewXY1_=null,this.locViewXY2_=null,this.locDataCoord1_=null,this.locDataCoord2_=null,this.locCenterOffset_=null,this.locFixedTextureSize_=null,this.locRenderColor_=null,this.locRenderType_=null,this.locUnifScale_=null,this.locTranslateY_=null};P.DIMENSION=2;P.UNIT_RECT_TRIANGLE_STRIP=new Float32Array([-1,-1,-1,1,1,-1,1,1]);P.RENDER_TYPE_TEXTURE=0;P.RENDER_TYPE_POINT_TEXTURE=1;P.RENDER_TYPE_POLYLINE=2;P.RENDER_TYPE_FLAT_TEXTURE=3;P.prototype.init=function(i,r){let n=this.loadShader_(this.gl_.VERTEX_SHADER,i),h=this.loadShader_(this.gl_.FRAGMENT_SHADER,r),o=this.gl_.createProgram();if(this.gl_.attachShader(o,n),this.gl_.attachShader(o,h),this.gl_.bindAttribLocation(o,0,"aPosition"),this.gl_.bindAttribLocation(o,1,"aTexCoord"),this.gl_.linkProgram(o),!this.gl_.getProgramParameter(o,this.gl_.LINK_STATUS)&&!this.gl_.isContextLost()){let c=this.gl_.getProgramInfoLog(o);return alert(`Error linking program:
`+c),this.gl_.deleteProgram(o),!1}return this.program_=o,this.locTexture_=this.gl_.getUniformLocation(this.program_,"uTexture"),this.locAlpha_=this.gl_.getUniformLocation(this.program_,"uAlpha"),this.locProjCenter_=this.gl_.getUniformLocation(this.program_,"uProjCenter"),this.locViewXY1_=this.gl_.getUniformLocation(this.program_,"uViewXY1"),this.locViewXY2_=this.gl_.getUniformLocation(this.program_,"uViewXY2"),this.locDataCoord1_=this.gl_.getUniformLocation(this.program_,"uDataCoord1"),this.locDataCoord2_=this.gl_.getUniformLocation(this.program_,"uDataCoord2"),this.locCenterOffset_=this.gl_.getUniformLocation(this.program_,"uCenterOffset"),this.locFixedTextureSize_=this.gl_.getUniformLocation(this.program_,"uFixedTextureSize"),this.locRenderColor_=this.gl_.getUniformLocation(this.program_,"uRenderColor"),this.locRenderType_=this.gl_.getUniformLocation(this.program_,"uRenderType"),this.locUnifScale_=this.gl_.getUniformLocation(this.program_,"uScale"),this.gl_.blendFunc(this.gl_.SRC_ALPHA,this.gl_.ONE_MINUS_SRC_ALPHA),!0};P.prototype.initAdditionalParams=function(){this.locTranslateY_=this.gl_.getUniformLocation(this.program_,"uTranslateY")};P.prototype.loadShader_=function(i,r){let n=this.gl_.createShader(i);if(this.gl_.shaderSource(n,r),this.gl_.compileShader(n),!this.gl_.getShaderParameter(n,this.gl_.COMPILE_STATUS)&&!this.gl_.isContextLost()){let h=this.gl_.getShaderInfoLog(n);return alert(`Error compiling shader:
`+h),this.gl_.deleteShader(n),null}return n};P.prototype.setClearColor=function(i){this.gl_.clearColor(i.r,i.g,i.b,i.a),this.gl_.enable(this.gl_.BLEND)};P.prototype.clear=function(i){this.gl_.clear(this.gl_.COLOR_BUFFER_BIT),this.gl_.viewport(0,0,i.width,i.height)};P.prototype.initVBO=function(i){this.vbo_=this.gl_.createBuffer(),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.vbo_),this.gl_.bufferData(this.gl_.ARRAY_BUFFER,i*4*2,this.gl_.DYNAMIC_DRAW)};P.prototype.setRenderType=function(i){this.gl_.uniform1i(this.locRenderType_,i)};P.prototype.prepareRender=function(i,r,n,h,o,u,c){this.gl_.useProgram(this.program_),this.gl_.uniform1f(this.locAlpha_,o),this.gl_.uniform4f(this.locRenderColor_,u.r,u.g,u.b,u.a),this.gl_.uniform2f(this.locProjCenter_,n,h),this.gl_.uniform2f(this.locViewXY1_,i[0],i[1]),this.gl_.uniform2f(this.locViewXY2_,i[2],i[3]),this.gl_.uniform1i(this.locTexture_,0),this.gl_.uniform1f(this.locUnifScale_,c),this.locTranslateY_!=null&&this.gl_.uniform1f(this.locTranslateY_,0);let p=P.UNIT_RECT_TRIANGLE_STRIP.byteLength;this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,0,P.UNIT_RECT_TRIANGLE_STRIP),this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,p,r),this.gl_.enableVertexAttribArray(0),this.gl_.vertexAttribPointer(0,P.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,0),this.gl_.enableVertexAttribArray(1),this.gl_.vertexAttribPointer(1,P.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,p)};P.prototype.renderTexture=function(i,r,n){let h=r[0],o=r[1],u=r[2],c=r[3];this.gl_.bindTexture(this.gl_.TEXTURE_2D,i),this.gl_.uniform2f(this.locDataCoord1_,h,o),this.gl_.uniform2f(this.locDataCoord2_,u,c),this.gl_.uniform2f(this.locCenterOffset_,n.X,n.Y),this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP,0,4)};let B=function(i,r,n,h){this.lam0=i,this.phi0=r,this.divN_=typeof h<"u"?h:180,this.sin_phi0_=Math.sin(r),this.cos_phi0_=Math.cos(r),this.zoomScale=n};B.prototype.getProjCenter=function(){return{lambda:this.lam0,phi:this.phi0}};B.prototype.frw_web_merc=function(i,r){return r=Math.atan(Math.sinh(r*Math.PI/1.48442222)),{lam:i,phi:r}};B.prototype.fwd_fisheye=function(i,r){[i,r]=[i/Math.PI,r/Math.PI];let n=Math.sqrt(i*i+r*r),h=Math.atan2(r,i),o=Math.log(1+this.zoomScale*n)/Math.log(1+this.zoomScale);return[Math.cos(h)*o*Math.PI,Math.sin(h)*o*Math.PI]};B.prototype.forward=function(i,r){let n=this.frw_web_merc(i,r),h=Math.sin(n.phi),o=Math.cos(n.phi),u=Math.sin(n.lam-this.lam0),c=Math.cos(n.lam-this.lam0),p=Math.acos(this.sin_phi0_*h+this.cos_phi0_*o*c);if(Math.abs(p)<g.EPSILON)return{x:0,y:0};let _=Math.sin(p);if(Math.abs(_)<g.EPSILON)return null;let m=p/_,T=m*o*u,v=m*(this.cos_phi0_*h-this.sin_phi0_*o*c);return[T,v]=this.fwd_fisheye(T,v),{x:T,y:v}};B.prototype.inv_fisheye=function(i,r){[i,r]=[i/Math.PI,r/Math.PI];let n=Math.sqrt(i*i+r*r),h=Math.atan2(r,i),o=(Math.exp(n*Math.log(1+this.zoomScale))-1)/this.zoomScale;return[Math.cos(h)*o*Math.PI,Math.sin(h)*o*Math.PI]};B.prototype.inverse=function(i,r){[i,r]=this.inv_fisheye(i,r);let n=i*i+r*r;if(g.PI_SQ<n)return null;let h=Math.sqrt(n);if(h<g.EPSILON)return{lambda:this.lam0,phi:this.phi0};let o=h,u=Math.sin(o),c=Math.cos(o),p=c*this.sin_phi0_+r*u*this.cos_phi0_/h,_=Math.asin(g.clamp(p,-1,1)),m;return g.HALF_PI-g.EPSILON<this.phi0?m=Math.atan2(i,-r)+this.lam0:this.phi0<-(g.HALF_PI-g.EPSILON)?m=Math.atan2(i,r)+this.lam0:m=Math.atan2(i*u,h*c*this.cos_phi0_-r*this.sin_phi0_*u)+this.lam0,(m<-Math.PI||Math.PI<=m)&&(m-=2*Math.PI*Math.floor((m+Math.PI)/(2*Math.PI))),{lambda:m,phi:_}};B.prototype.setScale=function(i){this.zoomScale=i};const U=function(){this.shader_=null,this.backColor_={r:0,g:0,b:0,a:1},this.graticuleColor_={r:.88,g:.88,b:.88,a:1},this.alpha_=1,this.projection=new B(0,0,.01),this.numberOfPoints=64,this.zoomScale=.01};U.prototype.init=function(i){if(this.shader_=new P(i),!this.shader_.init(U.VERTEX_SHADER_STR,U.FRAGMENT_SHADER_STR))return!1;let n=8+this.numberOfPoints;return this.shader_.initVBO(n),this.shader_.setClearColor(this.backColor_),!0};U.prototype.setAlpha=function(i){this.alpha_=i};U.prototype.setProjCenter=function(i,r){this.projection=new B(i,r,this.zoomScale)};U.prototype.clear=function(i){this.shader_.clear(i)};U.prototype.prepareRender=function(i,r){this.shader_.prepareRender(r,i,this.projection.lam0,this.projection.phi0,this.alpha_,this.graticuleColor_,this.zoomScale)};U.prototype.renderTextures=function(i,r){for(let n=0;n<i.length;++n){n==i.length-1?this.shader_.setRenderType(P.RENDER_TYPE_FLAT_TEXTURE):this.shader_.setRenderType(P.RENDER_TYPE_TEXTURE);let h=i[n][0],o=i[n][1];this.shader_.renderTexture(h,o,r)}};U.prototype.setScale=function(i){this.zoomScale=i,this.projection.setScale(i)};U.VERTEX_SHADER_STR=`#version 300 es
  precision highp float;
  in vec2 aPosition;
  in vec2 aTexCoord;
  out vec2 vTexCoord;

  void main() {
    gl_Position = vec4(aPosition.x, aPosition.y, 1.0, 1.0);
    vTexCoord = aTexCoord;
  }
`;U.FRAGMENT_SHADER_STR=`#version 300 es

  precision highp float;
  uniform sampler2D uTexture;
  in vec2 vTexCoord;
  uniform lowp int uRenderType;
  uniform vec2 uProjCenter; // lam0, phi0
  uniform vec2 uViewXY1;    // -PI,-PI
  uniform vec2 uViewXY2;    // +PI,+PI
  uniform vec2 uDataCoord1; // lam1, phi1: top left corner of current texture: radians
  uniform vec2 uDataCoord2; // lam2, phi2: bot right corner of current texture: radians
  uniform vec2 uCenterOffset; // central point offset in center tile
  uniform vec2 uFixedTextureSize;    //  アイコンサイズ（画面比） Icon size (screen ratio)
  uniform vec4 uRenderColor;
  uniform float uAlpha;
  uniform float uScale;       //  スケール zoom in zoomScale

  const float pi = 3.14159265;
  const float epsilon = 0.00000001;
  const float blurRatio = 0.015;
  const float xyRadius = pi;
  const float atanSinhPi = 1.48442222; // atan(sinh(pi)) = max phi for web merc
  out vec4 fragColor;

  vec2 web_merc(float lambda, float phi) {      //  Web Mercator
    if (abs(phi) < atanSinhPi) {
      phi = asinh(tan(phi)) * 0.5;
    }
    return vec2(lambda, phi);
  }

  vec2 fisheye(vec2 xy) {      //  fisheye effect
    xy = xy / pi; // circle radius 1.0
    float rho = length(xy);

    float theta = atan(xy.y, xy.x);
    float fisheyeR = (exp(rho * log(1.0 + uScale)) - 1.0) / uScale;
    return vec2(cos(theta) * fisheyeR * pi, sin(theta) * fisheyeR * pi);
  }

  vec2 proj_inverse(vec2 center, vec2 xy) {  // lat/lon from map coords
    xy = fisheye(xy);
    float sinPhi0 = sin(center.y);
    float cosPhi0 = cos(center.y);

    float rho = length(xy);

    if ( rho < epsilon ) {
      return center;
    }
    if ( rho - epsilon > xyRadius ) {
      rho = xyRadius;
    }

    float c_rh = rho;

    float cos_c = cos(c_rh);
    float sin_c = sin(c_rh);

    float phi = asin( clamp( cos_c * sinPhi0 + xy.y * sin_c * cosPhi0 / rho, -1.0, 1.0 ) );
    float lam = mod( center.x + atan( xy.x * sin_c, rho * cosPhi0 * cos_c - xy.y * sinPhi0 * sin_c ) + pi, 2.0 * pi ) - pi;
    vec2 lamphi = web_merc(lam,phi);

    return lamphi;
  }

  float inner_xy(vec2 xy) { // returns zero outside of circle
    return 1.0 - smoothstep( (1.0 - blurRatio) * xyRadius, (1.0 + blurRatio) * xyRadius, length(xy) );
  }

  void main() {
  // Map the texture point vTexCoord ([0,0] - [1,1]) to a point on the XY plane
    vec2 xy = mix(uViewXY1, uViewXY2, vTexCoord); // lerp from -PI,-PI to +PI,+PI, inverse so rationalizes it
    // if ( uRenderType == 0 ) {    //  Texture (map) RENDER_TYPE_TEXTURE

      vec2 lp = proj_inverse(uProjCenter, xy);

      vec2 ts = (lp - uDataCoord1) / (uDataCoord2 - uDataCoord1);
      float inXY = inner_xy(xy);
      vec2 inData = step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts); // cut off outside of texture
      vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y * inXY;
      OutputColor.a *= clamp(uAlpha, 0.0, 1.0);
      fragColor = OutputColor;
    // }
    // else 
    //   if ( uRenderType == 3 ) {  // center tile rendered flat RENDER_TYPE_FLAT_TEXTURE

    //     vec2 lp = vec2(xy.x + uCenterOffset.x, xy.y + (1.0 - uCenterOffset.y));

    //     vec2 inData = step(vec2(0.0, 0.0), lp) - step(vec2(1.0, 1.0), lp); // cut off outside of texture
    //     vec4 OutputColor = texture(uTexture, lp) * inData.x * inData.y;
    //     // if (length(xy) < 0.4) {
    //       fragColor = OutputColor;
    //     // }
    //   }
  //  else if ( uRenderType == 1 ) {  //  PointTexture (icon)

  // //   XY平面上の点を画像上の点[0,0]-[1,1]にマッピングする 
  // //.  Map a point on the XY plane to a point [0, 0] - [1, 1] on the image
  //     vec2 fixedTextureSizeXY = uFixedTextureSize * (uViewXY2 - uViewXY1);
  //     vec2 r1 = vec2(uDataCoord1.x - 0.5 * fixedTextureSizeXY.x, uDataCoord1.x - 0.5 * fixedTextureSizeXY.y);
  //     vec2 ts = (xy - r1) / fixedTextureSizeXY;
  //     vec2 inData = (step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts));
  //     vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y;
  //     fragColor = OutputColor;

  // } 
  // else if ( uRenderType == 2 ) {  //  Polyline (Graticules)
  
  //       fragColor = uRenderColor;
  
      // }
    }

`;let me;me="pk.eyJ1IjoiYml0c2xheWVyNDIiLCJhIjoiY21iNmp2dTdiMDBnYjJqcGxobWR4NWlrbyJ9.V6LS515oNG3QiZcDI_US5A";let ti=function(){this.interpolateTimeSpan=1e3,this.gl=null,this.canvas=null,this.mapView=null,this.requestId=null,this.prevTime=null,this.prevScale=null,this.viewStatus={drag:!1,dragPrevPos:null,pinchPrevScale:null,zoomScale:300.01,targetLambdaPhi:null,interpolater:null,currTileLevel:null,lam0:-71.0576282*.0174533,phi0:42.3587364*.0174533},this.zoomMin=.01,this.zoomMax=100000001e-2,this.maxTileLevel=18,this.rasterProj=null,this.debug=!1,this.animationFrames=80,document.addEventListener("DOMContentLoaded",()=>{this.getQueryParams(),this.canvas=document.getElementById("webglCanvas"),this.resizeCanvas(this.canvas),this.rasterProj=new U,this.rasterProj.setScale(this.viewStatus.zoomScale),this.startup(this.rasterProj),this.animation()}),window.addEventListener("resize",()=>{this.resizeCanvas(this.canvas),this.mapView.resizeCanvas(this.canvas),this.rasterProj.clear(this.canvas)}),this.animation=()=>{let i=!1,r=new Date().getTime();this.setTileLevel();let n;if(this.viewStatus.interpolater!=null)n=this.viewStatus.interpolater.getPos(r),this.mapView.setProjCenter(n.lp.lambda,n.lp.phi),this.viewStatus.interpolater.isFinished()&&(this.viewStatus.interpolater=null,i=!0);else if(this.viewStatus.targetLambdaPhi!=null){let h=this.mapView.getProjCenter(),o=this.viewStatus.targetLambdaPhi;this.viewStatus.interpolater=ct.create(h,o,[0,0],[0,0],this.interpolateTimeSpan),this.viewStatus.targetLambdaPhi=null}this.prevScale!=this.viewStatus.zoomScale&&(this.rasterProj.setScale(this.viewStatus.zoomScale),this.prevScale=this.viewStatus.zoomScale,i=!0),this.mapView.render(i),this.animationFrames--,this.animationFrames>0?this.requestId=requestAnimationFrame(this.animation):(this.animationFrames=80,this.mapView.render(!0))},this.startup=i=>{if(this.gl=this.canvas.getContext("webgl2"),!this.gl)return void alert("Failed to setup WebGL.");this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored,!1);let r=new Hammer.Manager(this.canvas,{recognizers:[[Hammer.Pinch,{enable:!0}],[Hammer.Pan,{enable:!0}],[Hammer.Tap,{enable:!0,taps:2}]]});r.on("pinch",this.handlePinch),r.on("pan",this.handlePan),r.on("panstart",this.handlePanStart),r.on("panend pancancel",this.handlePanEnd),r.on("tap",this.handleDoubleTap),window.WheelEvent&&document.addEventListener("wheel",this.handleWheel,!1),document.addEventListener("keydown",this.handleKeydown),this.init(i)},this.init=i=>{let r=this.canvas.getBoundingClientRect(),n={width:r.width,height:r.height},h={},o={num:100,crossOrigin:!1,debug:this.debug};i.init(this.gl),this.mapView=new w(this.gl,i,n,h,o),this.mapView.setProjCenter(this.viewStatus.lam0,this.viewStatus.phi0),this.mapView.getURL=function(u,c,p){return`https://api.mapbox.com/v4/mapbox.satellite/${u}/${c}/${p}.png?access_token=${me}`},this.setTileLevel(),this.mapView.requestImagesIfNecessary()},this.resizeCanvas=i=>{let r=i.clientWidth,n=i.clientHeight;i.width==r&&i.height==n||(i.width=r,i.height=n),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.setTileLevel=()=>{this.viewStatus.currTileLevel=Math.round(Math.log10(this.viewStatus.zoomScale)*3),this.viewStatus.currTileLevel=Math.max(Math.min(this.viewStatus.currTileLevel,this.maxTileLevel),0),this.mapView.setTileLevel(this.viewStatus.currTileLevel)},this.getQueryParams=()=>{let i=new URLSearchParams(window.location.search),r=i.get("zoom");r&&(r=parseFloat(r),isNaN(r)||(this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,r),this.zoomMax)));let n=i.get("lat"),h=i.get("lon");n&&h&&(n=parseFloat(n),h=parseFloat(h),!isNaN(n)&&!isNaN(h)&&(this.viewStatus.lam0=h*.0174533,this.viewStatus.phi0=n*.0174533)),i.get("local")==""&&(this.debug="local"),i.get("red")==""&&(this.debug="red")},this.checkAndGetGesturePos=i=>{let r=this.canvas.getBoundingClientRect(),n=i.center.x-r.left,h=i.center.y-r.top;return n<0||h<0||r.width<n||r.height<h?null:[n,h]},this.handleKeydown=i=>{if(i.key=="="||i.key=="+")this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1;else if(i.key==="-"||i.key==="_")this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1;else return;this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.handleWheel=i=>{i.deltaY<0?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.handlePinch=i=>{i.scale>1?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.05:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.05,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.getPanRate=i=>i<1?100:i<10?300:i<100?500:i<1e3?1e3:i<1e4?1e4:i<1e5?5e4:i,this.handlePan=i=>{if(this.viewStatus.drag){let r=this.checkAndGetGesturePos(i);if(r!=null){if(this.viewStatus.dragPrevPos){i.preventDefault();let n=this.getPanRate(this.viewStatus.zoomScale),h=(r[0]-this.viewStatus.dragPrevPos[0])/n,o=(r[1]-this.viewStatus.dragPrevPos[1])/n,u=this.mapView.getProjCenter(),c=u.lambda-h,p=Math.max(Math.min(u.phi+o,Math.PI/2),-Math.PI/2);this.mapView.setProjCenter(c,p)}this.viewStatus.dragPrevPos=r}}},this.handlePanStart=i=>{this.viewStatus.drag=!0;let r=this.checkAndGetGesturePos(i);r&&(i.preventDefault(),this.viewStatus.dragPrevPos=r,this.requestId=requestAnimationFrame(this.animation))},this.handlePanEnd=i=>{this.viewStatus.drag=!1,this.viewStatus.dragPrevPos=null,this.mapView.render(!0)},this.handleDoubleTap=i=>{let r=this.checkAndGetGesturePos(i);if(r){i.preventDefault();let n=this.mapView.getLambdaPhiPointFromWindow(r[0],r[1]);this.viewStatus.lam0=n.lambda,this.viewStatus.phi0=n.phi,this.viewStatus.targetLambdaPhi=n,this.requestId=requestAnimationFrame(this.animation)}},this.handleContextLost=i=>{i.preventDefault(),cancelAnimationFrame(this.requestId),this.mapView.resetImages()},this.handleContextRestored=i=>{init(),this.requestId=requestAnimationFrame(animation)}};new ti;
//# sourceMappingURL=index-Dlu7l70r.js.map
