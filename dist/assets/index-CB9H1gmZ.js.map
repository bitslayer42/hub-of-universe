{"version":3,"file":"index-CB9H1gmZ.js","sources":["../../src/mod/ProjMath.js","../../src/mod/Interpolater.js","../../src/mod/TileManager.js","../../src/mod/ImageCache.js","../../src/MapView.js","../../src/ShaderProgram.js","../../src/Projection.js","../../src/RasterProj.js","../../src/Handlers.js","../../node_modules/hammerjs/hammer.js","../../src/Main.js"],"sourcesContent":["let ProjMath = function() {};\n\nProjMath.EPSILON = 1.0e-7;\n\nProjMath.SQRT_2 = Math.sqrt(2);\n\nProjMath.PI_SQ = Math.PI * Math.PI;\nProjMath.HALF_PI = Math.PI / 2;\n\n\nProjMath.clamp = function(x, min, max) {\n  return Math.max(min, Math.min(max, x));\n};\n\n\n/**\n * atan2(y,x)の範囲を求める。  Find the range of\n * @param {Range} yRange\n * @param {Range} xRange\n * @return {Range}\n */\nProjMath.atan2Range = function(yRange, xRange) {\n  console.assert(yRange.min <= yRange.max);\n  console.assert(xRange.min <= xRange.max);\n\n  let xmin = xRange.min;\n  let xmax = xRange.max;\n  let ymin = yRange.min;\n  let ymax = yRange.max;\n\n  //  y方向正の領域内. Y direction is not within the domain\n  if (0 <= ymin) {\n    if (0 < xmin) {\n      return { min: Math.atan2(ymin, xmax), max: Math.atan2(ymax, xmin) };\n    }\n    if (xmax < 0) {\n      return { min: Math.atan2(ymax, xmax), max: Math.atan2(ymin, xmin) };\n    }\n    return { min: Math.atan2(ymin, xmax), max: Math.atan2(ymin, xmin) };\n  }\n\n  //  y方向負の領域内  Y direction \n  if (ymax < 0) {\n    if (0 < xmin) {\n      return { min: Math.atan2(ymin, xmin), max: Math.atan2(ymax, xmax) };\n    }\n    if (xmax < 0) {\n      return { min: Math.atan2(ymax, xmin), max: Math.atan2(ymin, xmax) };\n    }\n    return { min: Math.atan2(ymax, xmin), max: Math.atan2(ymax, xmax) };\n  }\n\n  //  x軸上の場合（原点を内部に含まない）\n  //. On the x axis (the origin is not included inside)\n  if (0 < xmin) {\n    return { min: Math.atan2(ymin, xmin), max: Math.atan2(ymax, xmin) };\n  }\n  if (xmax < 0) {\n    //  周期性の考慮. Consideration of periodicity\n    let t1 = Math.atan2(ymax, xmax);\n    let t2 = Math.atan2(ymin, xmax);\n    if (Math.PI <= t1) {\n      return { min: t1 - 2 * Math.PI, max: t2 };\n    } else {\n      return { min: t1, max: t2 + 2 * Math.PI };\n    }\n  }\n\n  //  原点を内部に含む. Include the origin inside\n  return { min: -Math.PI, max: Math.PI };\n};\n\n\nProjMath.toLambdaPhi = function(vec3d) {\n  let r = Math.sqrt(vec3d[0] * vec3d[0] + vec3d[1] * vec3d[1]);\n  let lam = Math.atan2( vec3d[1], vec3d[0] );\n  let phi = Math.atan2( vec3d[2], r );\n  return { lambda: lam, phi: phi };\n};\n\n\nProjMath.normalizeLambda = function(lam) {\n  if ( -Math.PI <= lam && lam < Math.PI ) {\n    return lam;\n  }\n  return lam - 2 * Math.PI * Math.floor( (lam + Math.PI) / (2 * Math.PI) );\n};\n\n\nProjMath.neighborPoint = function(pt1, pt2) {\n  if ( ProjMath.EPSILON <= Math.abs(pt1.phi - pt2.phi) ) {\n    return false;\n  }\n  let lam1 = ProjMath.normalizeLambda(pt1.lambda);\n  let lam2 = ProjMath.normalizeLambda(pt2.lambda);\n  return Math.abs(lam1 - lam2) < ProjMath.EPSILON;\n};\n\n\nProjMath.sphericalDistance = function(pt1, pt2) {\n  let distance = Math.acos( // cosine rule\n    (Math.sin(pt1.phi) * Math.sin(pt2.phi)) +\n    (Math.cos(pt1.phi) * Math.cos(pt2.phi) *\n     Math.cos( ProjMath.normalizeLambda(pt2.lambda - pt1.lambda) )) \n  );\n  return distance;\n};\n/* -------------------------------------------------------------------------- */\nexport { ProjMath };","import { ProjMath } from \"./ProjMath.js\";\n\n///////////////////////////////////////////////////////////////////\n///////MapMathUtils////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////\nlet MapMathUtils = function () { };\nMapMathUtils.smoothstep = function (a, b, c) {\n  let d = ProjMath.clamp((c - a) / (b - a), 0, 1);\n  return d * d * (3 - 2 * d);\n};\nMapMathUtils.smootherstep = function (a, b, c) {\n  let d = ProjMath.clamp((c - a) / (b - a), 0, 1);\n  return d * d * d * (d * (6 * d - 15) + 10);\n};\nMapMathUtils.toUnitVector3d = function (lambda, phi) {\n  let cosphi = Math.cos(phi);\n  return [Math.cos(lambda) * cosphi, Math.sin(lambda) * cosphi, Math.sin(phi)];\n};\nMapMathUtils.slerp = function (from3dVec, to3dVec, intrpRatio) {\n  //Spherical Linear Interpolation\n  let d = ProjMath.clamp(from3dVec[0] * to3dVec[0] + from3dVec[1] * to3dVec[1] + from3dVec[2] * to3dVec[2], -1, 1);\n  if (1 - ProjMath.EPSILON < d)\n    return [(from3dVec[0] + to3dVec[0]) / 2, (from3dVec[1] + to3dVec[1]) / 2, (from3dVec[2] + to3dVec[2]) / 2];\n  d < -(1 - ProjMath.EPSILON);\n  let e = Math.acos(d),\n    f = Math.sin(e),\n    g = Math.sin((1 - intrpRatio) * e) / f,\n    h = Math.sin(intrpRatio * e) / f;\n  return [g * from3dVec[0] + h * to3dVec[0], g * from3dVec[1] + h * to3dVec[1], g * from3dVec[2] + h * to3dVec[2]];\n};\n\n///////////////////////////////////////////////////////////////////\n///////Interpolater////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////\nlet Interpolater = function (currLP, targLP, iniViewPos, finViewPos, timeSpan) {\n  this.v1 = MapMathUtils.toUnitVector3d(currLP.lambda, currLP.phi);\n  this.v2 = MapMathUtils.toUnitVector3d(targLP.lambda, targLP.phi);\n  this.iniViewPos = iniViewPos;\n  this.finViewPos = finViewPos;\n  this.timeSpan = timeSpan;\n  this.startTime = null;\n  this.finished = false;\n};\nInterpolater.create = function (currLP, targLP, iniViewPos, finViewPos, timeSpan) {\n  return ProjMath.neighborPoint(currLP, targLP)\n    ? null\n    : (Math.PI - ProjMath.EPSILON < Math.abs(targLP.phi - currLP.phi) &&\n      (currLP = {\n        lambda: currLP.lambda,\n        phi: currLP.phi + 1e-4 * (0 < currLP.phi ? -1 : 1),\n      }),\n      new Interpolater(currLP, targLP, iniViewPos, finViewPos, timeSpan));\n};\nInterpolater.prototype.getPos = function (currTime) {\n  let tm = 0;\n  if (null == this.startTime) this.startTime = currTime;\n  else {\n    let deltaTime = currTime - this.startTime;\n    (tm = ProjMath.clamp(deltaTime / this.timeSpan, 0, 1)),\n      this.startTime + this.timeSpan < currTime && (this.finished = true);\n  }\n  let intrpRatio = MapMathUtils.smootherstep(0, 1, tm);\n  let currVec3d = MapMathUtils.slerp(this.v1, this.v2, intrpRatio);\n  let currLP = ProjMath.toLambdaPhi(currVec3d);\n  let currViewPos = [\n      this.iniViewPos[0] * (1 - intrpRatio) + this.finViewPos[0] * intrpRatio,\n      this.iniViewPos[1] * (1 - intrpRatio) + this.finViewPos[1] * intrpRatio,\n    ];\n  return {\n    lp: currLP,\n    viewPos: currViewPos,\n  };\n};\nInterpolater.prototype.isFinished = function () {\n  return this.finished;\n};\n\n///////////////////////////////////////////////////////////////////\nexport { Interpolater };\n","let TileManager = function (tile_opts, showCities) {\n  this.showCities = showCities; // Function in MapView\n  // this.canvasSize = { width: null, height: null };\n  // this.tilesAcross = 0;\n  // // this.tileMaxSize = 0;\n  this.tileSize = 256; // tile size in pixels\n  this.centerQuadkey = null; // quadkey of tile at center of map\n};\n\nTileManager.prototype.resizeCanvas = function (canvasSize) {\n}\n\nTileManager.prototype.getCenterTileInfo = function (lam0, phi0, level) {\n  // Get tile at center of map\n  let sinPhi0 = Math.sin(phi0);\n  let pixelX = ((lam0 + Math.PI) / (2 * Math.PI)) * this.tileSize * Math.pow(2, level);\n  let pixelY = (0.5 - Math.log((1 + sinPhi0) / (1 - sinPhi0)) / (4 * Math.PI)) * this.tileSize * Math.pow(2, level);\n  let tileX = Math.floor(pixelX / this.tileSize);\n  let tileY = Math.floor(pixelY / this.tileSize);\n  this.centerQuadkey = this.tileXYToQuadkey(tileX, tileY, level);\n}\n\nTileManager.prototype.tileXYToQuadkey = function (tileX, tileY, level) {\n  let quadkey = '';\n  for (let i = level; i > 0; i--) {\n    let digit = 0;\n    const mask = 1 << (i - 1);\n    if ((tileX & mask) !== 0) {\n      digit |= 1;\n    }\n    if ((tileY & mask) !== 0) {\n      digit |= 2;\n    }\n    quadkey += digit.toString();\n  }\n  return quadkey;\n}\n\nfunction quadkeyToTileXY(quadkey) {\n  let x = 0;\n  let y = 0;\n  const z = quadkey.length;\n  for (let i = z; i > 0; i--) {\n    const mask = 1 << (i - 1);\n    const digit = parseInt(quadkey.charAt(z - i));\n    if (digit & 1) {\n      x |= mask;\n    }\n    if (digit & 2) {\n      y |= mask;\n    }\n  }\n  return { x: x, y: y, z: z };\n}\n\nTileManager.prototype.getRectFromXYZ = function (tile) {\n  //  get the tile rect from tile xyz\n  let baseX = -Math.PI;\n  let baseY = Math.PI / 2.0;\n  let baseWidth = Math.PI * 2.0;\n  let baseHeight = Math.PI;\n  let tileWidth = baseWidth / Math.pow(2, tile.xyz.z);\n  let tileHeight = baseHeight / Math.pow(2, tile.xyz.z);\n  let x1 = baseX + tile.xyz.x * tileWidth;\n  let y2 = baseY - tile.xyz.y * tileHeight;\n  let x2 = baseX + (tile.xyz.x + 1) * tileWidth;\n  let y1 = baseY - (tile.xyz.y + 1) * tileHeight;\n\n  return [x1, y1, x2, y2];\n}\n\nTileManager.prototype.getNSWEtiles = function (tile, tileList = [N, S, W, E, NE, NW, SE, SW]) {\n  // Get the tiles surrounding the given tile that are specified by the parameter tileList\n  // which is an array which can include: [N, S, W, E, NE, NW, SE, SW]\n  let N = 0, NE = 1, E = 2, SE = 3, S = 4, SW = 5, W = 6, NW = 7;\n  let tiles = [];\n  let { x, y, z } = tile.xyz;\n  let maxZ = Math.pow(2, z) - 1; // max tile index at this zoom level\n\n  if (tileList.length === 0) {\n    return tiles; //  no tiles to return\n  }\n  if (tileList.includes(N)) {\n    if (y > 0) {\n      tiles.push({ \"xyz\": { \"x\": x, \"y\": y - 1, \"z\": z }, });\n    }\n  }\n  if (tileList.includes(S)) {\n    if (y < maxZ) {\n      tiles.push({ \"xyz\": { \"x\": x, \"y\": y + 1, \"z\": z }, });\n    }\n  }\n  if (tileList.includes(W)) {\n    tiles.push({ \"xyz\": { \"x\": (x == 0 ? maxZ : x - 1), \"y\": y, \"z\": z }, });\n  }\n  if (tileList.includes(E)) {\n    tiles.push({ \"xyz\": { \"x\": (x == maxZ ? 0 : x + 1), \"y\": y, \"z\": z }, });\n  }\n  if (tileList.includes(NE)) {\n    if (y > 0) {\n      tiles.push({ \"xyz\": { \"x\": (x == maxZ ? 0 : x + 1), \"y\": y - 1, \"z\": z }, });\n    }\n  }\n  if (tileList.includes(NW)) {\n    if (y > 0) {\n      tiles.push({ \"xyz\": { \"x\": (x == 0 ? maxZ : x - 1), \"y\": y - 1, \"z\": z }, });\n    }\n  }\n  if (tileList.includes(SE)) {\n    if (y < maxZ) {\n      tiles.push({ \"xyz\": { \"x\": (x == maxZ ? 0 : x + 1), \"y\": y + 1, \"z\": z }, });\n    }\n  }\n  if (tileList.includes(SW)) {\n    if (y < maxZ) {\n      tiles.push({ \"xyz\": { \"x\": (x == 0 ? maxZ : x - 1), \"y\": y + 1, \"z\": z }, });\n    }\n  }\n  return tiles;\n}\n\nTileManager.prototype.getAdjacentTiles = function (currTile) {\n  let tileInfos = [];\n  let NSWEtiles = [];\n  let N = 0, NE = 1, E = 2, SE = 3, S = 4, SW = 5, W = 6, NW = 7;\n\n  let quadrant = currTile.quadkey.slice(-1);\n  // add three tiles in the current quadrant\n  if (quadrant === '0') {\n    NSWEtiles = this.getNSWEtiles(currTile, [N, W, NW]);\n  }\n  else if (quadrant === '1') {\n    NSWEtiles = this.getNSWEtiles(currTile, [N, E, NE]);\n  }\n  else if (quadrant === '2') {\n    NSWEtiles = this.getNSWEtiles(currTile, [S, W, SW]);\n  }\n  else if (quadrant === '3') {\n    NSWEtiles = this.getNSWEtiles(currTile, [S, E, SE]);\n  }\n  tileInfos.push(...NSWEtiles);\n\n  return tileInfos;\n}\n\nTileManager.prototype.pushLevelOneTiles = function (tileInfos) {\n  //  push all four level one tiles to the tileInfos array\n  let levelOneTiles = [\n    { \"xyz\": { \"x\": 0, \"y\": 0, \"z\": 1 }, \"quadkey\": \"0\" },\n    { \"xyz\": { \"x\": 1, \"y\": 0, \"z\": 1 }, \"quadkey\": \"1\" },\n    { \"xyz\": { \"x\": 0, \"y\": 1, \"z\": 1 }, \"quadkey\": \"2\" },\n    { \"xyz\": { \"x\": 1, \"y\": 1, \"z\": 1 }, \"quadkey\": \"3\" }\n  ];\n  tileInfos.push(...levelOneTiles);\n}\n\nTileManager.prototype.getTileInfos = function (lam0, phi0, currTileLevel, getUrl) {\n  // console.log(\"getTileInfos\", lam0, phi0, currTileLevel);\n  let tileInfos = [];\n  let prevTile = null;\n  this.getCenterTileInfo(lam0, phi0, currTileLevel);\n  this.showCities(this.centerQuadkey);\n  for (let level = currTileLevel; level >= 2; level--) {\n    let currTileQuadkey;\n    if (prevTile ){\n      currTileQuadkey = prevTile.quadkey.slice(0, -1);\n    } else { // first tile\n      currTileQuadkey = this.centerQuadkey;\n    }\n    let currTileXYZ = quadkeyToTileXY(currTileQuadkey);\n    let currTile = {\n      \"xyz\": currTileXYZ, \"quadkey\": currTileQuadkey,\n    };\n    tileInfos.push(currTile);\n    let nextAdjacentTiles = this.getAdjacentTiles(currTile);\n    tileInfos.push(...nextAdjacentTiles);\n    prevTile = currTile;\n  }\n  this.pushLevelOneTiles(tileInfos);\n\n  for (const tile of tileInfos) {\n    tile.rect = this.getRectFromXYZ(tile);\n    tile.url = getUrl(tile.xyz.z, tile.xyz.x, tile.xyz.y);\n    // console.log(tile.url); //.slice(0, 50) + \"...\");\n  }\n  return tileInfos.reverse();\n\n};\n\nexport { TileManager };\n","class LRUCache {\n  constructor(capacity) {\n    this.cache = new Map();\n    this.capacity = capacity;\n  }\n\n  get(key) {\n    if (!this.cache.has(key)) return false;\n    let val = this.cache.get(key);\n    this.cache.delete(key);\n    this.cache.set(key, val); // move to top of list\n    return val;\n  }\n\n  put(key, value) {\n    this.cache.delete(key);\n    if (this.cache.size === this.capacity) {\n      this.cache.delete(this.cache.keys().next().value);\n      this.cache.set(key, value);\n    } else {\n      this.cache.set(key, value);\n    }\n    // console.log(\"cache size\", this.cache.size);\n  }\n\n}\n\n\nlet ImageCache = function (cache_opts) {\n  this.num = 32;             //  default: 32\n  this.crossOrigin = null;\n  // this.textures = {};\n  this.loading = {};\n  this.ongoingImageLoads = [];\n  this.debug = false;\n\n  if (typeof cache_opts !== 'undefined') {\n    if ('num' in cache_opts) {\n      this.num = cache_opts.num;\n    }\n    if ('crossOrigin' in cache_opts) {\n      this.crossOrigin = cache_opts.crossOrigin;\n    }\n    if ('debug' in cache_opts) {\n      this.debug = cache_opts.debug;\n    }\n  }\n  //\n  this.createTexture = null;\n  this.textures = new LRUCache(this.num);\n};\n\n\nImageCache.prototype.loadImage_ = function (url, info) {\n  const { promise, resolve, reject } = Promise.withResolvers();\n  this.loading[url] = true;\n  let image = new Image();\n  if (this.crossOrigin != null) {\n    image.crossOrigin = this.crossOrigin;\n  }\n  let cache = this;\n  let debug = this.debug;\n  let redImage;\n  image.onload = async function () {\n    cache.ongoingImageLoads.splice(cache.ongoingImageLoads.indexOf(image), 1); //remove from ongoing load list\n    if (cache.createTexture == null) return;\n    let tex = cache.createTexture(image);\n    if (tex) {\n      cache.textures.put(url, [tex, info]);\n    }\n    delete cache.loading.url;\n\n    // For DEBUG: Draw a red border around each loaded image\n    if (debug == \"red\") {\n      let canvas = new OffscreenCanvas(256, 256);\n      let ctx = canvas.getContext('2d');\n      ctx.drawImage(image, 0, 0);\n      ctx.strokeStyle = 'red';\n      ctx.lineWidth = 5;\n      ctx.strokeRect(0, 0, image.width, image.height);\n      const blob = await canvas.convertToBlob({ type: 'image/png' });\n      redImage = new Image();\n      redImage.src = URL.createObjectURL(blob);\n      // console.log(\"DEBUG: Image loaded with red border\", url);\n      resolve(redImage);\n    }\n  }\n  if (debug == \"red\") {\n    promise.then((redImage) => {\n      image.src = redImage.src; // Use the red bordered image\n    });\n  }\n\n  this.ongoingImageLoads.push(image);\n  // use local debug tile\n  if (debug == \"local\") {\n    image.src = new URL(\n      './debug.png',\n      import.meta.url\n    );\n  } else {\n    image.src = url;\n  }\n};\n\n\nImageCache.prototype.loadImageIfAbsent = function (url, info) {\n  if (this.textures.get(url)) return false;\n  if (url in this.loading) return false;\n  this.loadImage_(url, info);\n  return true;  //  ロード開始 Start loading\n};\n\n\nImageCache.prototype.getTexture = function (url) {\n  let tex = this.textures.get(url);\n  return tex;\n};\n\n\nImageCache.prototype.clearOngoingImageLoads = function () {\n  for (let i = 0; i < this.ongoingImageLoads.length; i++) {\n    this.ongoingImageLoads[i].onload = undefined;\n  }\n  this.ongoingImageLoads = [];\n};\n\nexport { ImageCache, LRUCache };","import { TileManager } from \"./mod/TileManager.js\";\nimport { ImageCache, LRUCache } from \"./mod/ImageCache.js\";\n\nlet MapView = function (gl, imgProj, canvasSize, tile_opts, cache_opts) {\n  this.gl = gl;\n  this.rasterProj = imgProj;\n\n  this.canvasSize = canvasSize;\n  //\n  this.tileManager = new TileManager(tile_opts, this.showCities.bind(this));\n  this.prevTileInfos_ = null;\n  this.prevWindow_ = null;\n  //\n  this.imageCache = new ImageCache(cache_opts);\n  //\n  let self = this;\n  this.imageCache.createTexture = function (img) {\n    return self.createTexture(img);\n  };\n  //\n  this.tileInfos = null;\n  this.getURL = null;\n  this.calculateLevel = null;\n  this.currTileLevel = 0;\n  // this.prevTileLevel = null;\n  this.lam0 = 0;\n  this.phi0 = 0;\n\n  this.cityList = []; // list of cities in current view\n  this.cityDiv = document.getElementById('citydiv');\n  this.cityCache = new LRUCache(1000);\n  this.cityFontColor = \"black\";\n};\n\nMapView.prototype.clearTileInfoCache_ = function () {\n  this.prevWindow_ = null;\n  this.prevTileInfos_ = null;\n};\n\nMapView.prototype.setProjCenter = function (lam, phi) {\n  this.lam0 = lam;\n  this.phi0 = phi;\n  this.clearTileInfoCache_();\n  this.rasterProj.setProjCenter(lam, phi);\n};\n\nMapView.prototype.getProjCenter = function () {\n  return this.rasterProj.projection.getProjCenter();\n};\n\nMapView.prototype.resizeCanvas = function (canvas) {\n  this.canvasSize.width = canvas.width;\n  this.canvasSize.height = canvas.height;\n  this.tileManager.resizeCanvas(this.canvasSize);\n}\n\nMapView.prototype.setTileLevel = function (currTileLevel) {\n  this.currTileLevel = currTileLevel;\n};\n\nMapView.prototype.setCityFontColor = function (color) {\n  this.cityFontColor = color;\n};\n\nMapView.prototype.getViewPointFromWindow = function (canvX, canvY) {\n  let scaleX_ = (Math.PI * 2) / this.canvasSize.width; // convert pixel to pi\n  let scaleY_ = (Math.PI * 2) / -this.canvasSize.height;\n  let x = -Math.PI + canvX * scaleX_;\n  let y = -Math.PI + (canvY - this.canvasSize.height) * scaleY_;\n  return [x, y]; //radians\n};\n\nMapView.prototype.getLambdaPhiPointFromWindow = function (x, y) { // canvas x y pixel coordinates\n  let viewPos = this.getViewPointFromWindow(x, y);\n  let lam_phi = this.rasterProj.projection.inverse(viewPos[0], viewPos[1]);\n  return lam_phi; // projected lambda, phi\n};\n\n\nMapView.prototype.resetImages = function () {\n  this.imageCache.clearOngoingImageLoads();\n};\n\n// Called from init\nMapView.prototype.requestImagesIfNecessary = function () {\n  if (this.getURL == null) return -1;\n  this.getTileInfos_();\n  let count = this.requestImages_(this.tileInfos);\n  return count;\n};\n\n// Called from animation\nMapView.prototype.render = function (getNewTiles) {\n  if (this.getURL == null) return;\n  if (getNewTiles) {\n    this.getTileInfos_();\n    this.requestImages_(this.tileInfos);\n  }\n  this.render_(this.tileInfos);\n}\n\n//  TODO この実装の詳細は別の場所にあるべきか Should this implementation's detail be in a different location?\nMapView.prototype.createTexture = function (img) {\n  let tex = this.gl.createTexture();\n  this.gl.bindTexture(this.gl.TEXTURE_2D, tex);\n  this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, true);\n  this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n  this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\n  this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n  this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n\n  this.gl.bindTexture(this.gl.TEXTURE_2D, tex);\n  this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, img);\n\n  this.gl.bindTexture(this.gl.TEXTURE_2D, null);\n  return tex;\n};\n\n// Called from TileManager\nMapView.prototype.showCities = async function (centerQuadkey) {\n  this.cityList = this.cityCache.get(centerQuadkey);\n  if (this.cityList) {\n    this.placeCities_(this.cityList, this.rasterProj.projection);\n    return;\n  }\n  this.requestCities_(centerQuadkey);\n}\n\nMapView.prototype.requestCities_ = function (centerQuadkey) {\n  let api_key = import.meta.env.VITE_HUB_API_KEY;\n\n  const params = new URLSearchParams();\n  params.append(\"quadkey\", centerQuadkey);\n  params.append(\"apikey\", api_key);\n\n  fetch(`${import.meta.env.VITE_CITIES_URL}?${params}`, {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  })\n    .then(response => response.json())\n    .then(data => {\n      this.cityList = data || [];\n      this.cityCache.put(centerQuadkey, this.cityList);\n      this.placeCities_(this.cityList, this.rasterProj.projection);\n    })\n    .catch(error => {\n      console.error(\"Error fetching cities:\", error);\n      this.cityList = [];\n    });\n};\n\nMapView.prototype.placeCities_ = function (cityList, projection) {\n  this.cityDiv.innerHTML = '';\n  const rect = this.cityDiv.getBoundingClientRect();\n  this.cityList = cityList || [];\n  for (let city of this.cityList) {\n    let { x, y } = projection.forward(\n      city.longitude * Math.PI / 180,\n      city.latitude * Math.PI / 180\n    );\n    x = ( x / (2 * Math.PI) + 0.5) * rect.width;\n    y = (-y / (2 * Math.PI) + 0.5) * rect.height;\n\n    const worddiv = document.createElement('div');\n    worddiv.classList.add('word'); // for css\n    worddiv.classList.add(this.cityFontColor); // for css\n    worddiv.style.left = `${x}px`;\n    worddiv.style.top = `${y}px`;\n\n    worddiv.textContent = city.name;\n    this.cityDiv.appendChild(worddiv);\n  }\n    // After elements are in the DOM test for overlap and hide if necessary\n    const children = Array.from(this.cityDiv.children);\n    const placedRects = [];\n    const padding = 0; // minimum space between words\n\n    children.forEach(child => {\n      const cRect = child.getBoundingClientRect();\n      const x = parseInt(child.style.left);\n      const y = parseInt(child.style.top);\n      const w = parseInt(cRect.width);\n      const h = parseInt(cRect.height);\n\n      const candidate = { left: x - w / 2 - padding, top: y - h / 2 - padding, right: x + w / 2 + padding, bottom: y + h / 2 + padding };\n\n      const collision = placedRects.some(r => !(candidate.right < r.left || candidate.left > r.right || candidate.bottom < r.top || candidate.top > r.bottom));\n      if (collision) {\n        child.style.display = 'none';\n      } else {\n        placedRects.push({ name: child.textContent, left: candidate.left, top: candidate.top, right: candidate.right, bottom: candidate.bottom });\n      }\n      // child.style.left = `${left}px`;\n      // child.style.top = `${top}px`;\n    });\n}\n\nMapView.prototype.getTileInfos_ = function () {\n  let tileArray = this.tileManager.getTileInfos(this.lam0, this.phi0, this.currTileLevel, this.getURL);\n  this.tileInfos = tileArray;\n};\n\n\nMapView.prototype.requestImages_ = function () {\n  let count = 0;\n  for (let i = 0; i < this.tileInfos.length; ++i) {\n    if (this.imageCache.loadImageIfAbsent(this.tileInfos[i].url, this.tileInfos[i].rect)) {\n      ++count;\n    }\n  }\n  return count;\n};\n\n\nMapView.prototype.render_ = function () {\n  this.rasterProj.clear(this.canvasSize);\n  let targetTextures = [];\n  for (let i = 0; i < this.tileInfos.length; ++i) {\n    let info = this.tileInfos[i];\n    let tex = this.imageCache.getTexture(info.url);\n    if (tex) {\n      targetTextures.push(tex);\n    }\n  }\n\n  let texCoords = new Float32Array([\n    0.0, 0.0,   // left top\n    0.0, 1.0,   // left bottom\n    1.0, 0.0,   // right top\n    1.0, 1.0    // right bottom\n  ]);\n  this.rasterProj.prepareRender(texCoords, [-Math.PI, -Math.PI, Math.PI, Math.PI]);\n  if (0 < targetTextures.length) {\n    this.rasterProj.renderTextures(targetTextures);\n  }\n  this.placeCities_(this.cityList, this.rasterProj.projection);\n};\n\n\n/* -------------------------------------------------------------------------- */\nexport { MapView };\n","let ShaderProgram = function(gl) {\n  this.gl_ = gl;\n  this.vbo_ = null;\n  this.program_ = null;\n  //\n  this.locTexture_ = null;\n  this.locAlpha_ = null;\n  this.locProjCenter_ = null;\n  this.locViewXY1_ = null;\n  this.locViewXY2_ = null;\n  this.locDataCoord1_ = null;\n  this.locDataCoord2_ = null;\n  this.locFixedTextureSize_ = null;\n  this.locRenderColor_ = null;\n  this.locRenderType_ = null;\n  this.locUnifScale_ = null;\n  this.locRingRadius_ = null; // radius of flat center disk in radians\n  this.locFlatRatio_ = null;\n  this.locTranslateY_ = null;   //  TODO tmerc独自の処理の調整. Adjust your own processing\n};\n\nShaderProgram.DIMENSION = 2;\n\nShaderProgram.UNIT_RECT_TRIANGLE_STRIP = new Float32Array([\n    -1.0, -1.0,\n    -1.0, +1.0,\n    +1.0, -1.0,\n    +1.0, +1.0\n  ]);\n\nShaderProgram.RENDER_TYPE_TEXTURE = 0;        // dim=2, dataType=GeoGraphic\nShaderProgram.RENDER_TYPE_POINT_TEXTURE = 1;  // dim=0, dataType=XYCoordinates\nShaderProgram.RENDER_TYPE_POLYLINE = 2;       \n\nShaderProgram.prototype.init = function(vertShaderStr, fragShaderStr) {\n  let vertexShader = this.loadShader_(this.gl_.VERTEX_SHADER, vertShaderStr);\n  let fragmentShader = this.loadShader_(this.gl_.FRAGMENT_SHADER, fragShaderStr);\n\n  let prog = this.gl_.createProgram();\n  this.gl_.attachShader(prog, vertexShader);\n  this.gl_.attachShader(prog, fragmentShader);\n\n  this.gl_.bindAttribLocation(prog, 0, \"aPosition\");  //  TODO ??\n  this.gl_.bindAttribLocation(prog, 1, \"aTexCoord\");\n  this.gl_.linkProgram(prog);\n\n  let linked = this.gl_.getProgramParameter(prog, this.gl_.LINK_STATUS);\n  if (!linked && !this.gl_.isContextLost()) {\n    let info = this.gl_.getProgramInfoLog(prog);\n    alert(\"Error linking program:\\n\" + info);\n    this.gl_.deleteProgram(prog);\n    return false;\n  }\n  this.program_ = prog;\n\n  this.locTexture_ = this.gl_.getUniformLocation(this.program_, \"uTexture\");\n  this.locAlpha_ = this.gl_.getUniformLocation(this.program_, \"uAlpha\");\n  this.locProjCenter_ = this.gl_.getUniformLocation(this.program_, \"uProjCenter\");\n  this.locViewXY1_ = this.gl_.getUniformLocation(this.program_, \"uViewXY1\");\n  this.locViewXY2_ = this.gl_.getUniformLocation(this.program_, \"uViewXY2\");\n  this.locDataCoord1_ = this.gl_.getUniformLocation(this.program_, \"uDataCoord1\");\n  this.locDataCoord2_ = this.gl_.getUniformLocation(this.program_, \"uDataCoord2\");\n  this.locFixedTextureSize_ = this.gl_.getUniformLocation(this.program_, \"uFixedTextureSize\");\n  this.locRenderColor_ = this.gl_.getUniformLocation(this.program_, \"uRenderColor\");\n  this.locRenderType_ = this.gl_.getUniformLocation(this.program_, \"uRenderType\");\n  this.locUnifScale_ = this.gl_.getUniformLocation(this.program_, \"uScale\");\n  this.locRingRadius_ = this.gl_.getUniformLocation(this.program_, \"uRingRadius\");\n  this.locFlatRatio_ = this.gl_.getUniformLocation(this.program_, \"uFlatRatio\");\n  //this.gl_.blendFunc(this.gl_.SRC_ALPHA, this.gl_.ONE);\n  this.gl_.blendFunc(this.gl_.SRC_ALPHA, this.gl_.ONE_MINUS_SRC_ALPHA);\n\n  return true;\n};\n\nShaderProgram.prototype.initAdditionalParams = function() {\n  this.locTranslateY_ = this.gl_.getUniformLocation(this.program_, \"uTranslateY\");  //  NOTICE tmerc独自. Original\n};\n\nShaderProgram.prototype.loadShader_ = function(type, shaderSrc) {\n  let shader = this.gl_.createShader(type);\n  this.gl_.shaderSource(shader, shaderSrc);\n  this.gl_.compileShader(shader);\n  if (!this.gl_.getShaderParameter(shader, this.gl_.COMPILE_STATUS) && !this.gl_.isContextLost()) {\n    let info = this.gl_.getShaderInfoLog(shader);\n    alert(\"Error compiling shader:\\n\" + info);\n    this.gl_.deleteShader(shader);\n    return null;\n  }\n  return shader;\n};\n\nShaderProgram.prototype.setClearColor = function(color) {\n  this.gl_.clearColor(color.r, color.g, color.b, color.a);\n  this.gl_.enable(this.gl_.BLEND);\n};\n\nShaderProgram.prototype.clear = function(canvasSize) {\n  this.gl_.clear(this.gl_.COLOR_BUFFER_BIT);\n  this.gl_.viewport(0, 0, canvasSize.width, canvasSize.height);\n};\n\nShaderProgram.prototype.initVBO = function(numberOfItems) {\n  this.vbo_ = this.gl_.createBuffer();\n  this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER, this.vbo_);\n  this.gl_.bufferData(this.gl_.ARRAY_BUFFER, numberOfItems * 4 * 2, this.gl_.DYNAMIC_DRAW);\n};\n\nShaderProgram.prototype.setRenderType = function(type) {\n  this.gl_.uniform1i(this.locRenderType_, type);\n};\n\nShaderProgram.prototype.prepareRender = function(viewRect, texCoords, lam0, phi0, alpha, lineColor, zoomScale, ringRadius, flatRatio) {\n  this.gl_.useProgram(this.program_);\n\n  this.gl_.uniform1f(this.locAlpha_, alpha);\n  this.gl_.uniform4f(this.locRenderColor_, lineColor.r, lineColor.g, lineColor.b, lineColor.a);\n  this.gl_.uniform2f(this.locProjCenter_, lam0, phi0);\n  this.gl_.uniform2f(this.locViewXY1_, viewRect[0], viewRect[1]); // -PI,-PI\n  this.gl_.uniform2f(this.locViewXY2_, viewRect[2], viewRect[3]); // +PI,+PI\n  this.gl_.uniform1i(this.locTexture_, 0);\n  this.gl_.uniform1f(this.locUnifScale_, zoomScale);\n  this.gl_.uniform1f(this.locRingRadius_, ringRadius);\n  this.gl_.uniform1f(this.locFlatRatio_, flatRatio);\n\n  // console.log(\"prepareRender: \", {ringRadius, flatRatio, lam0, phi0, zoomScale});\n\n  if ( this.locTranslateY_ != null ) {\n    this.gl_.uniform1f(this.locTranslateY_, 0.0);   //  NOTICE uTranslateY, tmerc独自 Original\n  }\n\n  let offset = ShaderProgram.UNIT_RECT_TRIANGLE_STRIP.byteLength;\n  this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER, 0, ShaderProgram.UNIT_RECT_TRIANGLE_STRIP);\n  this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER, offset, texCoords);\n\n  this.gl_.enableVertexAttribArray(0);\n  this.gl_.vertexAttribPointer(0, ShaderProgram.DIMENSION, this.gl_.FLOAT, this.gl_.FALSE, 0, 0);\n  this.gl_.enableVertexAttribArray(1);\n  this.gl_.vertexAttribPointer(1, ShaderProgram.DIMENSION, this.gl_.FLOAT, this.gl_.FALSE, 0, offset);\n};\n\n\n//  TODO コメントとしてこれは残しておく. I will leave this as a comment\n// ShaderProgram.prototype.prepareRenderPolyline = function() {\n//   this.gl_.enableVertexAttribArray(0);\n//   this.gl_.vertexAttribPointer(0, ShaderProgram.DIMENSION, this.gl_.FLOAT, this.gl_.FALSE, 0, 0);\n//   this.gl_.enableVertexAttribArray(1);\n//   this.gl_.vertexAttribPointer(1, ShaderProgram.DIMENSION, this.gl_.FLOAT, this.gl_.FALSE, 0, 0);\n// };\n\n//  TODO 要検討. To study\n// ShaderProgram.prototype.renderIconTexture = function(texture, iconSize, xyPos) {\n//   this.gl_.bindTexture(this.gl_.TEXTURE_2D, texture);\n//   this.gl_.uniform2f(this.locDataCoord1_, xyPos.x, xyPos.y);\n//   this.gl_.uniform2f(this.locDataCoord2_, 0, 0);\n//   this.gl_.uniform2f(this.locFixedTextureSize_, iconSize.width, iconSize.height);\n//   this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP, 0, 4);\n// };\n\nShaderProgram.prototype.renderTexture = function(texture, region) {\n  let lam1 = region[0];\n  let phi1 = region[1];\n  let lam2 = region[2];\n  let phi2 = region[3];\n\n  this.gl_.bindTexture(this.gl_.TEXTURE_2D, texture);\n  this.gl_.uniform2f(this.locDataCoord1_, lam1, phi1);\n  this.gl_.uniform2f(this.locDataCoord2_, lam2, phi2);\n  this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP, 0, 4);\n};\n\n// ShaderProgram.prototype.renderPolyline = function(points) {\n//   this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER, 0, new Float32Array(points));\n//   this.gl_.drawArrays(this.gl_.LINE_STRIP, 0, points.length / 2);\n// };\n\n// ShaderProgram.prototype.setPolylineData = function(points) {\n//   this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER, 0, new Float32Array(points));\n// };\n\n// ShaderProgram.prototype.renderPolylineData = function(numPoints, ty) {\n//   if (typeof ty !== 'undefined') {\n//     this.gl_.uniform1f(this.locTranslateY_, ty);    //  NOTICE uTranslateY, tmerc独自. Original\n//   }\n//   this.gl_.drawArrays(this.gl_.LINE_STRIP, 0, numPoints / 2);\n// };\n\n/* ------------------------------------------------------------ */\nexport { ShaderProgram };","import { ProjMath } from \"./mod/ProjMath.js\";\n\n\nlet Projection = function(lam0, phi0, zoomScale, opt_divn) {\n  // this.rando = Math.random();\n  this.lam0 = lam0;\n  this.phi0 = phi0;\n  this.divN_ = (typeof opt_divn !== 'undefined') ? opt_divn : 180;\n  //\n  this.sin_phi0_ = Math.sin(phi0);\n  this.cos_phi0_ = Math.cos(phi0);\n  this.zoomScale = zoomScale;\n};\n\nProjection.prototype.getProjCenter = function() {\n  return { lambda: this.lam0, phi: this.phi0 };\n};\n\n//////////////////////////////////\n// Projection.prototype.frw_web_merc = function(lam, phi) {      //  Web Mercator\n//   const atanSinhPi = 1.48442222;\n//   phi = Math.atan(Math.sinh(phi * Math.PI / atanSinhPi));\n//   return { lam, phi };\n// };\n\nProjection.prototype.fwd_fisheye = function(x, y) { \n  [x, y] = [x / Math.PI, y / Math.PI];\n  let rho = Math.sqrt(x*x + y*y);\n  let theta = Math.atan2(y, x);\n  let fisheyeR = Math.log(1 + this.zoomScale * rho) / Math.log(1 + this.zoomScale);\n  return [ Math.cos(theta) * fisheyeR * Math.PI, Math.sin(theta) * fisheyeR * Math.PI ];\n}\n\nProjection.prototype.forward = function(lambda, phi) { //called from setFlatRatio\n  // let wm = this.frw_web_merc(lambda, phi);\n  let wm = { lam: lambda, phi: phi };\n  let sin_phi = Math.sin(wm.phi);\n  let cos_phi = Math.cos(wm.phi);\n  let sin_lam = Math.sin(wm.lam - this.lam0);\n  let cos_lam = Math.cos(wm.lam - this.lam0);\n\n  let c = Math.acos( this.sin_phi0_ * sin_phi + this.cos_phi0_ * cos_phi * cos_lam );\n  if ( Math.abs(c) < ProjMath.EPSILON ) {\n    return { x: 0.0, y: 0.0 };\n  }\n\n  let sin_c = Math.sin(c);\n  if ( Math.abs(sin_c) < ProjMath.EPSILON ) {\n    return null;  //  対蹠点. point of view\n  }\n\n  let k = c / sin_c;\n  let x = k * cos_phi * sin_lam;\n  let y = k * ( this.cos_phi0_ * sin_phi - this.sin_phi0_ * cos_phi * cos_lam );\n  [x, y] = this.fwd_fisheye(x, y);\n  return { x:x, y:y };\n};\n\n//////////////////////////////////\n// Projection.prototype.inv_web_merc = function(phi) {      //  Web Mercator\n//   const atanSinhPi = 1.48442222; // atan(sinh(pi)) = max phi for web merc\n//   if (Math.abs(phi) < atanSinhPi) {\n//     phi = Math.asinh(Math.tan(phi)) * 0.5;\n//     // phi = Math.asinh(Math.tan(phi)) * atanSinhPi / Math.PI; [or * 0.5]\n//   }\n//   return phi;\n// };\n\nProjection.prototype.inv_fisheye = function(x, y) { \n  [x, y] = [x / Math.PI, y / Math.PI];\n  let rho = Math.sqrt(x*x + y*y);\n  let theta = Math.atan2(y, x);\n  let fisheyeR = (Math.exp(rho * Math.log(1.0 + this.zoomScale)) - 1.0) / this.zoomScale;\n  return [ Math.cos(theta) * fisheyeR * Math.PI, Math.sin(theta) * fisheyeR * Math.PI ];\n}\n\nProjection.prototype.inverse = function(x, y) {// Called from getLambdaPhiPointFromWindow (handleDoubleTap)\n  [x, y] = this.inv_fisheye(x, y);\n\n  let rh2 = x * x + y * y;\n  if ( ProjMath.PI_SQ < rh2 )   return null;\n\n  let rho = Math.sqrt(rh2);\n  if ( rho < ProjMath.EPSILON )  return { lambda: this.lam0, phi: this.phi0 };\n\n  let c_rh = rho;\n  let sin_c = Math.sin(c_rh);\n  let cos_c = Math.cos(c_rh);\n\n  let sinPhi = cos_c * this.sin_phi0_ + y * sin_c * this.cos_phi0_ / rho;\n  let phi = Math.asin(ProjMath.clamp(sinPhi, -1, 1));\n  let lam;\n  if ( ProjMath.HALF_PI - ProjMath.EPSILON < this.phi0 ) {   //  phi0 = pi/2\n    lam = Math.atan2(x, -y) + this.lam0;\n  } else if ( this.phi0 < -(ProjMath.HALF_PI - ProjMath.EPSILON) ) {   //  phi0 = -pi/2\n    lam = Math.atan2(x, y) + this.lam0;\n  } else {\n    lam = Math.atan2(x * sin_c, rho * cos_c * this.cos_phi0_ - y * this.sin_phi0_ * sin_c) + this.lam0;\n  }\n\n  if ( lam < -Math.PI || Math.PI <= lam ) {\n    lam -= 2 * Math.PI * Math.floor((lam + Math.PI) / (2*Math.PI));\n  }\n  // let retphi = this.inv_web_merc(phi); // This is not correct for some reason?\n  // return { lambda: lam, phi: retphi };\n  return { lambda: lam, phi: phi };\n};\n\n//////////////////////////////////\nProjection.prototype.setScale = function(zoomScale) {\n  this.zoomScale = zoomScale;\n}\n/* -------------------------------------------------------------------------- */\nexport { Projection };\n","import { ShaderProgram } from './ShaderProgram.js';\nimport { Projection } from './Projection.js';\n\n/* ------------------------------------------------------------ */\n\nconst RasterProj = function () {\n  this.shader_ = null;\n  //\n  this.backColor_ = { r: 0.0, g: 0.0, b: 0.0, a: 1.0 };\n  this.graticuleColor_ = { r: 0.88, g: 0.88, b: 0.88, a: 1.0 };\n  this.alpha_ = 1.0;\n  //\n  this.projection = new Projection(0.0, 0.0, 0.01);   // public\n  //\n  this.numberOfPoints = 64;\n  this.zoomScale = 0.01; // 0 > zoomScale >= 40\n  this.ringRadius = null; // radius of flat center disk in radians\n  this.flatRatio = null;    // ratio of projectedFlatRadius / flatRadius\n\n};\n\nRasterProj.prototype.init = function (gl) {\n  this.shader_ = new ShaderProgram(gl);\n  let ret = this.shader_.init(RasterProj.VERTEX_SHADER_STR, RasterProj.FRAGMENT_SHADER_STR);\n  if (!ret) {\n    return false;\n  }\n\n  let numberOfItems = 4 + 4 + this.numberOfPoints;\n  this.shader_.initVBO(numberOfItems);\n  this.shader_.setClearColor(this.backColor_);\n  return true;\n};\n\nRasterProj.prototype.setAlpha = function (alpha) {\n  this.alpha_ = alpha;\n};\n\nRasterProj.prototype.setProjCenter = function (lam0, phi0) {\n  this.projection = new Projection(lam0, phi0, this.zoomScale);\n};\n\nRasterProj.prototype.clear = function (canvasSize) {\n  this.shader_.clear(canvasSize);\n};\n\nRasterProj.prototype.prepareRender = function (texCoords, viewRect) {\n  this.shader_.prepareRender(\n    viewRect, \n    texCoords, \n    this.projection.lam0,\n    this.projection.phi0, \n    this.alpha_, \n    this.graticuleColor_, \n    this.zoomScale,\n    this.ringRadius,\n    this.flatRatio\n  );\n};\n\n// c- Renders textures at locations specified in textureInfos\nRasterProj.prototype.renderTextures = function (textureInfos) {\n  for (let i = 0; i < textureInfos.length; ++i) {\n    this.shader_.setRenderType(ShaderProgram.RENDER_TYPE_TEXTURE);\n\n    let texture = textureInfos[i][0];\n    let region = textureInfos[i][1];\n    this.shader_.renderTexture(texture, region);\n  }\n};\n\n// c- Renders an icon at the center of the map \n// RasterProj.prototype.renderOverlays = function(centerIcon, iconSize) {\n//   this.shader_.setRenderType(ShaderProgram.RENDER_TYPE_POINT_TEXTURE);\n//   this.shader_.renderIconTexture(centerIcon, iconSize, { x:0.0, y:0.0});\n// };\n\nRasterProj.prototype.setScale = function (zoomScale) {\n  this.zoomScale = zoomScale;\n  this.projection.setScale(zoomScale);\n}\n\n// The center of the map is unprojected and is just displayed flat\nRasterProj.prototype.setFlatRatio = function (ringRadius) {\n  this.ringRadius = ringRadius;\n  let lambda = this.projection.lam0;\n  let phi = this.projection.phi0 + ringRadius; // a lambda, phi on the north edge of the flat disk\n  let {x,y} = this.projection.forward(lambda, phi); // projected x,y of that point\n  this.flatRatio = y / ringRadius; // ratio of projectedFlatRadius / flatRadius\n  // console.log(\"setFlatRatio: \", { \n  //   lambda, phi, \n  //   lam0: this.projection.lam0, phi0: this.projection.phi0, \n  //   x, y, \n  //   zoom: this.zoomScale, \n  //   ratio: y / ringRadius });\n}\n\n/*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*/\nRasterProj.VERTEX_SHADER_STR = /*.glsl*/`#version 300 es\n  precision highp float;\n  in vec2 aPosition;\n  in vec2 aTexCoord;\n  out vec2 vTexCoord;\n\n  void main() {\n    gl_Position = vec4(aPosition.x, aPosition.y, 1.0, 1.0);\n    vTexCoord = aTexCoord;\n  }\n`;\n\n/*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*//*glsl*/\nRasterProj.FRAGMENT_SHADER_STR = /*glsl*/`#version 300 es\n\n  precision highp float;\n  uniform sampler2D uTexture;\n  in vec2 vTexCoord;\n  uniform lowp int uRenderType;\n  uniform vec2 uProjCenter; // lam0, phi0\n  uniform vec2 uViewXY1;    // -PI,-PI\n  uniform vec2 uViewXY2;    // +PI,+PI\n  uniform vec2 uDataCoord1; // lam1, phi1: top left corner of current texture: radians\n  uniform vec2 uDataCoord2; // lam2, phi2: bot right corner of current texture: radians\n  uniform vec2 uFixedTextureSize;    //  アイコンサイズ（画面比） Icon size (screen ratio)\n  uniform vec4 uRenderColor;\n  uniform float uAlpha;\n  uniform float uScale;       //  スケール zoom in zoomScale\n  uniform float uRingRadius;  // radius of flat center disk in radians\n  uniform float uFlatRatio;   // ratio of projectedFlatRadius / flatRadius  \n\n  // const float flatradius = 0.0001;\n\n  // float flatratio = 0.0002; // ratio of\n\n  const float pi = 3.14159265;\n  const float blurRatio = 0.015; // planet haze\n  const float xyRadius = pi;\n  const float atanSinhPi = 1.48442222; // atan(sinh(pi)) = max phi for web merc\n  out vec4 fragColor;\n\n  vec2 inner_flat(vec2 center, vec2 xy) {\n    // Inside the ring - draw flat\n    // Convert screen coordinates to web mercator coordinates\n    // Scale by uFlatRatio to match the projection scale at the ring boundary\n    float xflat = (xy.x / uFlatRatio) + center.x;\n    float yflat = asinh(tan((xy.y / uFlatRatio) + center.y)) * 0.5;\n    return vec2(xflat, yflat);\n  }\n\n  vec2 outer_projected(vec2 center, vec2 xy_fe, float rho) {\n        // Inverse of azimuthal equidistant projection\n    float sinPhi0 = sin(center.y);\n    float cosPhi0 = cos(center.y);\n    float phi = asin( clamp( cos(rho) * sinPhi0 + xy_fe.y * sin(rho) * cosPhi0 / rho, -1.0, 1.0 ) );\n    float lambda = mod( center.x + atan( xy_fe.x * sin(rho), rho * cosPhi0 * cos(rho) - xy_fe.y * sinPhi0 * sin(rho) ) + pi, 2.0 * pi ) - pi;\n\n    // Adj phi for web mercator\n    if (abs(phi) < atanSinhPi) { // not for poles\n      phi = asinh(tan(phi)) * 0.5;\n    }\n    return vec2(lambda, phi);\n  }\n\n  vec2 proj_inverse(vec2 center, vec2 xy) {\n    float epsilon = 0.0001; // uRingRadius / 2.0; //0.00001\n    // Fisheye effect\n    vec2 xy_1 = xy / pi; // circle radius 1.0\n    float rho_fe = length(xy_1);\n    float theta = atan(xy.y, xy.x);\n    float fisheyeR = (exp(rho_fe * log(1.0 + uScale)) - 1.0) / uScale;    \n    vec2 xy_fe = vec2(cos(theta) * fisheyeR * pi, sin(theta) * fisheyeR * pi);\n    \n    float rho = length(xy_fe);\n\n    if (rho > uRingRadius + epsilon || abs(center.y) >= atanSinhPi) { // outside ring: projected\n      return outer_projected(center, xy_fe, rho);\n    } else if (rho <= uRingRadius) {                                  // inside ring: flat\n      return inner_flat(center, xy);\n    } else {                                                // Smooth transition at the boundary\n      // return vec2( -0.785017, 1.15794); // debug with white ring\n      float t = (rho - uRingRadius) / epsilon;\n      vec2 flatCoords = inner_flat(center, xy);\n      vec2 projectedCoords = outer_projected(center, xy_fe, rho);\n      return mix( // Interpolate\n        flatCoords,\n        projectedCoords,\n        smoothstep(0.0, 1.0, t)\n      );\n    }\n  }\n\n  float inner_xy(vec2 xy) { // returns zero outside of circle\n    return 1.0 - smoothstep( (1.0 - blurRatio) * xyRadius, (1.0 + blurRatio) * xyRadius, length(xy) );\n  }\n\n  void main() {\n  // Map the texture point vTexCoord ([0,0] - [1,1]) to a point on the XY plane\n    vec2 xy = mix(uViewXY1, uViewXY2, vTexCoord); // lerp from -PI,-PI to +PI,+PI, inverse so rationalizes it\n    // if ( uRenderType == 0 ) {    //  Texture (map) RENDER_TYPE_TEXTURE\n\n      vec2 lp = proj_inverse(uProjCenter, xy);\n\n      vec2 ts = (lp - uDataCoord1) / (uDataCoord2 - uDataCoord1);\n      float inXY = inner_xy(xy);\n      vec2 inData = step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts); // cut off outside of texture\n      vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y * inXY;\n      OutputColor.a *= clamp(uAlpha, 0.0, 1.0);\n      fragColor = OutputColor;\n    // }\n  //  else if ( uRenderType == 1 ) {  //  PointTexture (icon)\n\n  // //   XY平面上の点を画像上の点[0,0]-[1,1]にマッピングする \n  // //.  Map a point on the XY plane to a point [0, 0] - [1, 1] on the image\n  //     vec2 fixedTextureSizeXY = uFixedTextureSize * (uViewXY2 - uViewXY1);\n  //     vec2 r1 = vec2(uDataCoord1.x - 0.5 * fixedTextureSizeXY.x, uDataCoord1.x - 0.5 * fixedTextureSizeXY.y);\n  //     vec2 ts = (xy - r1) / fixedTextureSizeXY;\n  //     vec2 inData = (step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts));\n  //     vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y;\n  //     fragColor = OutputColor;\n\n  // } \n  // else if ( uRenderType == 2 ) {  //  Polyline (Graticules)\n  \n  //       fragColor = uRenderColor;\n  \n      // }\n    }\n\n`;\n\n/* -------------------------------------------------------------------------- */\nexport { RasterProj };\n\n\n","export const Handlers = {\n  checkAndGetGesturePos(event) {\n    let canv_xy = this.canvas.getBoundingClientRect();\n    let left = event.center.x - canv_xy.left;\n    let top = event.center.y - canv_xy.top;\n    if (left < 0 || top < 0 || canv_xy.width < left || canv_xy.height < top) { //offscreen\n      return null;\n    }\n    return [left, top];\n  },\n\n  handleLayerChange: async function (event) {\n    this.selectedLayer = event.target.value;\n    await this.setLayer();\n    await this.init(this.rasterProj);\n    this.animation();\n  },\n\n  handleKeydown(event) {\n    switch (event.key) {\n      case '=':\n      case '+':\n        this.viewStatus.zoomScale = this.viewStatus.zoomScale * 1.1;\n        break;\n      case '-':\n      case '_':\n        this.viewStatus.zoomScale = this.viewStatus.zoomScale / 1.1;\n        break;\n      // case \"ArrowUp\":\n      //   console.log(\"ArrowUp\");\n      //   this.lat0 += this.getPanRate(this.viewStatus.zoomScale);\n      //   break;\n      // case \"ArrowDown\":\n      //   this.lat0 -= this.getPanRate(this.viewStatus.zoomScale);\n      //   break;\n      // case \"ArrowLeft\":\n      //   this.lon0 -= this.getPanRate(this.viewStatus.zoomScale);\n      //   break;\n      // case \"ArrowRight\":\n      //   this.lon0 += this.getPanRate(this.viewStatus.zoomScale);\n      //   break;        \n      default:\n        break;\n    }\n    this.viewStatus.zoomScale = Math.min(Math.max(this.zoomMin, this.viewStatus.zoomScale), this.zoomMax);\n    cancelAnimationFrame(this.requestId);\n    this.requestId = requestAnimationFrame(this.animation);\n  },\n\n  handleWheel(event) {\n    if (event.deltaY < 0) {\n      this.viewStatus.zoomScale = this.viewStatus.zoomScale * 1.1;\n    }\n    else {\n      this.viewStatus.zoomScale = this.viewStatus.zoomScale / 1.1;\n    }\n    this.viewStatus.zoomScale = Math.min(Math.max(this.zoomMin, this.viewStatus.zoomScale), this.zoomMax);\n    cancelAnimationFrame(this.requestId);\n    this.requestId = requestAnimationFrame(this.animation);\n  },\n\n  handlePinch(event) {\n    if (event.scale > 1.0) {\n      this.viewStatus.zoomScale = this.viewStatus.zoomScale * 1.05;\n    }\n    else {\n      this.viewStatus.zoomScale = this.viewStatus.zoomScale / 1.05;\n    }\n    this.viewStatus.zoomScale = Math.min(Math.max(this.zoomMin, this.viewStatus.zoomScale), this.zoomMax);\n    cancelAnimationFrame(this.requestId);\n    this.requestId = requestAnimationFrame(this.animation);\n    this.setQueryParams();\n  },\n\n  getPanRate(zoomScale) {\n   // how far should we pan given current zoom level?    \n    if (zoomScale < 1) {\n      return 100;\n    } else if (zoomScale < 10) {\n      return 300;\n    } else if (zoomScale < 100) {\n      return 500;\n    } else if (zoomScale < 1000) {\n      return 1000;\n    } else if (zoomScale < 10000) {\n      return 10000;\n    } else if (zoomScale < 100000) {\n      return 50000;\n    } else {\n      return zoomScale;\n    }\n  },\n\n  handlePan(event) {\n    if (this.viewStatus.drag) {\n      let canv_xy = this.checkAndGetGesturePos(event);\n      if (null != canv_xy) {\n        if (this.viewStatus.dragPrevPos) {\n          event.preventDefault();\n          let deltaPanRate = this.getPanRate(this.viewStatus.zoomScale);\n          let deltaX = (canv_xy[0] - this.viewStatus.dragPrevPos[0]) / deltaPanRate;\n          let deltaY = (canv_xy[1] - this.viewStatus.dragPrevPos[1]) / deltaPanRate;\n          let curr_lam_phi = this.mapView.getProjCenter();\n          let newLam0 = curr_lam_phi.lambda - deltaX;\n          let newPhi0 = Math.max(Math.min(curr_lam_phi.phi + deltaY, Math.PI / 2.0), -Math.PI / 2.0); // limit phi to -90 to 90 degrees\n          this.mapView.setProjCenter(newLam0, newPhi0);\n        }\n        this.viewStatus.dragPrevPos = canv_xy;\n      }\n    }\n  },\n\n  handlePanStart(event) {\n    this.viewStatus.drag = true;\n    let canv_xy = this.checkAndGetGesturePos(event); // get canvas x y from upper left corner\n    if (canv_xy) {\n      event.preventDefault();\n      this.viewStatus.dragPrevPos = canv_xy;\n      this.requestId = requestAnimationFrame(this.animation);\n    }\n  },\n\n  handlePanEnd(event) {\n    this.viewStatus.drag = false;\n    this.viewStatus.dragPrevPos = null;\n    this.mapView.render(true);\n  },\n\n  handleDoubleTap(event) {\n    let canv_xy = this.checkAndGetGesturePos(event);\n    if (canv_xy) {\n      // console.log(`Double tap at canvas coordinates: (${canv_xy[0]}, ${canv_xy[1]})`);\n      event.preventDefault();\n      let lam_phi = this.mapView.getLambdaPhiPointFromWindow(canv_xy[0], canv_xy[1]);\n      this.viewStatus.lam0 = lam_phi.lambda;\n      this.viewStatus.phi0 = lam_phi.phi;\n      this.viewStatus.targetLambdaPhi = lam_phi; // set target lambda, phi for interpolater\n      this.requestId = requestAnimationFrame(this.animation);\n    }\n  },\n\n  handleContextLost(event) {\n    event.preventDefault();\n    cancelAnimationFrame(this.requestId);\n    this.mapView.resetImages();\n  },\n\n  handleContextRestored(event) {\n    this.init(this.rasterProj);\n    this.requestId = requestAnimationFrame(this.animation);\n  }\n};","/*! Hammer.JS - v2.0.7 - 2016-04-22\n * http://hammerjs.github.io/\n *\n * Copyright (c) 2016 Jorik Tangelder;\n * Licensed under the MIT license */\n(function(window, document, exportName, undefined) {\n  'use strict';\n\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\nvar TEST_ELEMENT = document.createElement('div');\n\nvar TYPE_FUNCTION = 'function';\n\nvar round = Math.round;\nvar abs = Math.abs;\nvar now = Date.now;\n\n/**\n * set a timeout with a given scope\n * @param {Function} fn\n * @param {Number} timeout\n * @param {Object} context\n * @returns {number}\n */\nfunction setTimeoutContext(fn, timeout, context) {\n    return setTimeout(bindFn(fn, context), timeout);\n}\n\n/**\n * if the argument is an array, we want to execute the fn on each entry\n * if it aint an array we don't want to do a thing.\n * this is used by all the methods that accept a single and array argument.\n * @param {*|Array} arg\n * @param {String} fn\n * @param {Object} [context]\n * @returns {Boolean}\n */\nfunction invokeArrayArg(arg, fn, context) {\n    if (Array.isArray(arg)) {\n        each(arg, context[fn], context);\n        return true;\n    }\n    return false;\n}\n\n/**\n * walk objects and arrays\n * @param {Object} obj\n * @param {Function} iterator\n * @param {Object} context\n */\nfunction each(obj, iterator, context) {\n    var i;\n\n    if (!obj) {\n        return;\n    }\n\n    if (obj.forEach) {\n        obj.forEach(iterator, context);\n    } else if (obj.length !== undefined) {\n        i = 0;\n        while (i < obj.length) {\n            iterator.call(context, obj[i], i, obj);\n            i++;\n        }\n    } else {\n        for (i in obj) {\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\n        }\n    }\n}\n\n/**\n * wrap a method with a deprecation warning and stack trace\n * @param {Function} method\n * @param {String} name\n * @param {String} message\n * @returns {Function} A new function wrapping the supplied method.\n */\nfunction deprecate(method, name, message) {\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\n    return function() {\n        var e = new Error('get-stack-trace');\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\n            .replace(/^\\s+at\\s+/gm, '')\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\n\n        var log = window.console && (window.console.warn || window.console.log);\n        if (log) {\n            log.call(window.console, deprecationMessage, stack);\n        }\n        return method.apply(this, arguments);\n    };\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} target\n * @param {...Object} objects_to_assign\n * @returns {Object} target\n */\nvar assign;\nif (typeof Object.assign !== 'function') {\n    assign = function assign(target) {\n        if (target === undefined || target === null) {\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n            var source = arguments[index];\n            if (source !== undefined && source !== null) {\n                for (var nextKey in source) {\n                    if (source.hasOwnProperty(nextKey)) {\n                        output[nextKey] = source[nextKey];\n                    }\n                }\n            }\n        }\n        return output;\n    };\n} else {\n    assign = Object.assign;\n}\n\n/**\n * extend object.\n * means that properties in dest will be overwritten by the ones in src.\n * @param {Object} dest\n * @param {Object} src\n * @param {Boolean} [merge=false]\n * @returns {Object} dest\n */\nvar extend = deprecate(function extend(dest, src, merge) {\n    var keys = Object.keys(src);\n    var i = 0;\n    while (i < keys.length) {\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\n            dest[keys[i]] = src[keys[i]];\n        }\n        i++;\n    }\n    return dest;\n}, 'extend', 'Use `assign`.');\n\n/**\n * merge the values from src in the dest.\n * means that properties that exist in dest will not be overwritten by src\n * @param {Object} dest\n * @param {Object} src\n * @returns {Object} dest\n */\nvar merge = deprecate(function merge(dest, src) {\n    return extend(dest, src, true);\n}, 'merge', 'Use `assign`.');\n\n/**\n * simple class inheritance\n * @param {Function} child\n * @param {Function} base\n * @param {Object} [properties]\n */\nfunction inherit(child, base, properties) {\n    var baseP = base.prototype,\n        childP;\n\n    childP = child.prototype = Object.create(baseP);\n    childP.constructor = child;\n    childP._super = baseP;\n\n    if (properties) {\n        assign(childP, properties);\n    }\n}\n\n/**\n * simple function bind\n * @param {Function} fn\n * @param {Object} context\n * @returns {Function}\n */\nfunction bindFn(fn, context) {\n    return function boundFn() {\n        return fn.apply(context, arguments);\n    };\n}\n\n/**\n * let a boolean value also be a function that must return a boolean\n * this first item in args will be used as the context\n * @param {Boolean|Function} val\n * @param {Array} [args]\n * @returns {Boolean}\n */\nfunction boolOrFn(val, args) {\n    if (typeof val == TYPE_FUNCTION) {\n        return val.apply(args ? args[0] || undefined : undefined, args);\n    }\n    return val;\n}\n\n/**\n * use the val2 when val1 is undefined\n * @param {*} val1\n * @param {*} val2\n * @returns {*}\n */\nfunction ifUndefined(val1, val2) {\n    return (val1 === undefined) ? val2 : val1;\n}\n\n/**\n * addEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction addEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.addEventListener(type, handler, false);\n    });\n}\n\n/**\n * removeEventListener with multiple events at once\n * @param {EventTarget} target\n * @param {String} types\n * @param {Function} handler\n */\nfunction removeEventListeners(target, types, handler) {\n    each(splitStr(types), function(type) {\n        target.removeEventListener(type, handler, false);\n    });\n}\n\n/**\n * find if a node is in the given parent\n * @method hasParent\n * @param {HTMLElement} node\n * @param {HTMLElement} parent\n * @return {Boolean} found\n */\nfunction hasParent(node, parent) {\n    while (node) {\n        if (node == parent) {\n            return true;\n        }\n        node = node.parentNode;\n    }\n    return false;\n}\n\n/**\n * small indexOf wrapper\n * @param {String} str\n * @param {String} find\n * @returns {Boolean} found\n */\nfunction inStr(str, find) {\n    return str.indexOf(find) > -1;\n}\n\n/**\n * split string on whitespace\n * @param {String} str\n * @returns {Array} words\n */\nfunction splitStr(str) {\n    return str.trim().split(/\\s+/g);\n}\n\n/**\n * find if a array contains the object using indexOf or a simple polyFill\n * @param {Array} src\n * @param {String} find\n * @param {String} [findByKey]\n * @return {Boolean|Number} false when not found, or the index\n */\nfunction inArray(src, find, findByKey) {\n    if (src.indexOf && !findByKey) {\n        return src.indexOf(find);\n    } else {\n        var i = 0;\n        while (i < src.length) {\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\n                return i;\n            }\n            i++;\n        }\n        return -1;\n    }\n}\n\n/**\n * convert array-like objects to real arrays\n * @param {Object} obj\n * @returns {Array}\n */\nfunction toArray(obj) {\n    return Array.prototype.slice.call(obj, 0);\n}\n\n/**\n * unique array with objects based on a key (like 'id') or just by the array's value\n * @param {Array} src [{id:1},{id:2},{id:1}]\n * @param {String} [key]\n * @param {Boolean} [sort=False]\n * @returns {Array} [{id:1},{id:2}]\n */\nfunction uniqueArray(src, key, sort) {\n    var results = [];\n    var values = [];\n    var i = 0;\n\n    while (i < src.length) {\n        var val = key ? src[i][key] : src[i];\n        if (inArray(values, val) < 0) {\n            results.push(src[i]);\n        }\n        values[i] = val;\n        i++;\n    }\n\n    if (sort) {\n        if (!key) {\n            results = results.sort();\n        } else {\n            results = results.sort(function sortUniqueArray(a, b) {\n                return a[key] > b[key];\n            });\n        }\n    }\n\n    return results;\n}\n\n/**\n * get the prefixed property\n * @param {Object} obj\n * @param {String} property\n * @returns {String|Undefined} prefixed\n */\nfunction prefixed(obj, property) {\n    var prefix, prop;\n    var camelProp = property[0].toUpperCase() + property.slice(1);\n\n    var i = 0;\n    while (i < VENDOR_PREFIXES.length) {\n        prefix = VENDOR_PREFIXES[i];\n        prop = (prefix) ? prefix + camelProp : property;\n\n        if (prop in obj) {\n            return prop;\n        }\n        i++;\n    }\n    return undefined;\n}\n\n/**\n * get a unique id\n * @returns {number} uniqueId\n */\nvar _uniqueId = 1;\nfunction uniqueId() {\n    return _uniqueId++;\n}\n\n/**\n * get the window object of an element\n * @param {HTMLElement} element\n * @returns {DocumentView|Window}\n */\nfunction getWindowForElement(element) {\n    var doc = element.ownerDocument || element;\n    return (doc.defaultView || doc.parentWindow || window);\n}\n\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\nvar SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\n\nvar INPUT_TYPE_TOUCH = 'touch';\nvar INPUT_TYPE_PEN = 'pen';\nvar INPUT_TYPE_MOUSE = 'mouse';\nvar INPUT_TYPE_KINECT = 'kinect';\n\nvar COMPUTE_INTERVAL = 25;\n\nvar INPUT_START = 1;\nvar INPUT_MOVE = 2;\nvar INPUT_END = 4;\nvar INPUT_CANCEL = 8;\n\nvar DIRECTION_NONE = 1;\nvar DIRECTION_LEFT = 2;\nvar DIRECTION_RIGHT = 4;\nvar DIRECTION_UP = 8;\nvar DIRECTION_DOWN = 16;\n\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\n\nvar PROPS_XY = ['x', 'y'];\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\n\n/**\n * create new input type manager\n * @param {Manager} manager\n * @param {Function} callback\n * @returns {Input}\n * @constructor\n */\nfunction Input(manager, callback) {\n    var self = this;\n    this.manager = manager;\n    this.callback = callback;\n    this.element = manager.element;\n    this.target = manager.options.inputTarget;\n\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\n    // so when disabled the input events are completely bypassed.\n    this.domHandler = function(ev) {\n        if (boolOrFn(manager.options.enable, [manager])) {\n            self.handler(ev);\n        }\n    };\n\n    this.init();\n\n}\n\nInput.prototype = {\n    /**\n     * should handle the inputEvent data and trigger the callback\n     * @virtual\n     */\n    handler: function() { },\n\n    /**\n     * bind the events\n     */\n    init: function() {\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    },\n\n    /**\n     * unbind the events\n     */\n    destroy: function() {\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\n    }\n};\n\n/**\n * create new input type manager\n * called by the Manager constructor\n * @param {Hammer} manager\n * @returns {Input}\n */\nfunction createInputInstance(manager) {\n    var Type;\n    var inputClass = manager.options.inputClass;\n\n    if (inputClass) {\n        Type = inputClass;\n    } else if (SUPPORT_POINTER_EVENTS) {\n        Type = PointerEventInput;\n    } else if (SUPPORT_ONLY_TOUCH) {\n        Type = TouchInput;\n    } else if (!SUPPORT_TOUCH) {\n        Type = MouseInput;\n    } else {\n        Type = TouchMouseInput;\n    }\n    return new (Type)(manager, inputHandler);\n}\n\n/**\n * handle input events\n * @param {Manager} manager\n * @param {String} eventType\n * @param {Object} input\n */\nfunction inputHandler(manager, eventType, input) {\n    var pointersLen = input.pointers.length;\n    var changedPointersLen = input.changedPointers.length;\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\n\n    input.isFirst = !!isFirst;\n    input.isFinal = !!isFinal;\n\n    if (isFirst) {\n        manager.session = {};\n    }\n\n    // source event is the normalized value of the domEvents\n    // like 'touchstart, mouseup, pointerdown'\n    input.eventType = eventType;\n\n    // compute scale, rotation etc\n    computeInputData(manager, input);\n\n    // emit secret event\n    manager.emit('hammer.input', input);\n\n    manager.recognize(input);\n    manager.session.prevInput = input;\n}\n\n/**\n * extend the data with some usable properties like scale, rotate, velocity etc\n * @param {Object} manager\n * @param {Object} input\n */\nfunction computeInputData(manager, input) {\n    var session = manager.session;\n    var pointers = input.pointers;\n    var pointersLength = pointers.length;\n\n    // store the first input to calculate the distance and direction\n    if (!session.firstInput) {\n        session.firstInput = simpleCloneInputData(input);\n    }\n\n    // to compute scale and rotation we need to store the multiple touches\n    if (pointersLength > 1 && !session.firstMultiple) {\n        session.firstMultiple = simpleCloneInputData(input);\n    } else if (pointersLength === 1) {\n        session.firstMultiple = false;\n    }\n\n    var firstInput = session.firstInput;\n    var firstMultiple = session.firstMultiple;\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\n\n    var center = input.center = getCenter(pointers);\n    input.timeStamp = now();\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\n\n    input.angle = getAngle(offsetCenter, center);\n    input.distance = getDistance(offsetCenter, center);\n\n    computeDeltaXY(session, input);\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\n\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\n    input.overallVelocityX = overallVelocity.x;\n    input.overallVelocityY = overallVelocity.y;\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\n\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\n\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\n\n    computeIntervalInputData(session, input);\n\n    // find the correct target\n    var target = manager.element;\n    if (hasParent(input.srcEvent.target, target)) {\n        target = input.srcEvent.target;\n    }\n    input.target = target;\n}\n\nfunction computeDeltaXY(session, input) {\n    var center = input.center;\n    var offset = session.offsetDelta || {};\n    var prevDelta = session.prevDelta || {};\n    var prevInput = session.prevInput || {};\n\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\n        prevDelta = session.prevDelta = {\n            x: prevInput.deltaX || 0,\n            y: prevInput.deltaY || 0\n        };\n\n        offset = session.offsetDelta = {\n            x: center.x,\n            y: center.y\n        };\n    }\n\n    input.deltaX = prevDelta.x + (center.x - offset.x);\n    input.deltaY = prevDelta.y + (center.y - offset.y);\n}\n\n/**\n * velocity is calculated every x ms\n * @param {Object} session\n * @param {Object} input\n */\nfunction computeIntervalInputData(session, input) {\n    var last = session.lastInterval || input,\n        deltaTime = input.timeStamp - last.timeStamp,\n        velocity, velocityX, velocityY, direction;\n\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\n        var deltaX = input.deltaX - last.deltaX;\n        var deltaY = input.deltaY - last.deltaY;\n\n        var v = getVelocity(deltaTime, deltaX, deltaY);\n        velocityX = v.x;\n        velocityY = v.y;\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n        direction = getDirection(deltaX, deltaY);\n\n        session.lastInterval = input;\n    } else {\n        // use latest velocity info if it doesn't overtake a minimum period\n        velocity = last.velocity;\n        velocityX = last.velocityX;\n        velocityY = last.velocityY;\n        direction = last.direction;\n    }\n\n    input.velocity = velocity;\n    input.velocityX = velocityX;\n    input.velocityY = velocityY;\n    input.direction = direction;\n}\n\n/**\n * create a simple clone from the input used for storage of firstInput and firstMultiple\n * @param {Object} input\n * @returns {Object} clonedInputData\n */\nfunction simpleCloneInputData(input) {\n    // make a simple copy of the pointers because we will get a reference if we don't\n    // we only need clientXY for the calculations\n    var pointers = [];\n    var i = 0;\n    while (i < input.pointers.length) {\n        pointers[i] = {\n            clientX: round(input.pointers[i].clientX),\n            clientY: round(input.pointers[i].clientY)\n        };\n        i++;\n    }\n\n    return {\n        timeStamp: now(),\n        pointers: pointers,\n        center: getCenter(pointers),\n        deltaX: input.deltaX,\n        deltaY: input.deltaY\n    };\n}\n\n/**\n * get the center of all the pointers\n * @param {Array} pointers\n * @return {Object} center contains `x` and `y` properties\n */\nfunction getCenter(pointers) {\n    var pointersLength = pointers.length;\n\n    // no need to loop when only one touch\n    if (pointersLength === 1) {\n        return {\n            x: round(pointers[0].clientX),\n            y: round(pointers[0].clientY)\n        };\n    }\n\n    var x = 0, y = 0, i = 0;\n    while (i < pointersLength) {\n        x += pointers[i].clientX;\n        y += pointers[i].clientY;\n        i++;\n    }\n\n    return {\n        x: round(x / pointersLength),\n        y: round(y / pointersLength)\n    };\n}\n\n/**\n * calculate the velocity between two points. unit is in px per ms.\n * @param {Number} deltaTime\n * @param {Number} x\n * @param {Number} y\n * @return {Object} velocity `x` and `y`\n */\nfunction getVelocity(deltaTime, x, y) {\n    return {\n        x: x / deltaTime || 0,\n        y: y / deltaTime || 0\n    };\n}\n\n/**\n * get the direction between two points\n * @param {Number} x\n * @param {Number} y\n * @return {Number} direction\n */\nfunction getDirection(x, y) {\n    if (x === y) {\n        return DIRECTION_NONE;\n    }\n\n    if (abs(x) >= abs(y)) {\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\n    }\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\n}\n\n/**\n * calculate the absolute distance between two points\n * @param {Object} p1 {x, y}\n * @param {Object} p2 {x, y}\n * @param {Array} [props] containing x and y keys\n * @return {Number} distance\n */\nfunction getDistance(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n\n    return Math.sqrt((x * x) + (y * y));\n}\n\n/**\n * calculate the angle between two coordinates\n * @param {Object} p1\n * @param {Object} p2\n * @param {Array} [props] containing x and y keys\n * @return {Number} angle\n */\nfunction getAngle(p1, p2, props) {\n    if (!props) {\n        props = PROPS_XY;\n    }\n    var x = p2[props[0]] - p1[props[0]],\n        y = p2[props[1]] - p1[props[1]];\n    return Math.atan2(y, x) * 180 / Math.PI;\n}\n\n/**\n * calculate the rotation degrees between two pointersets\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} rotation\n */\nfunction getRotation(start, end) {\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\n}\n\n/**\n * calculate the scale factor between two pointersets\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\n * @param {Array} start array of pointers\n * @param {Array} end array of pointers\n * @return {Number} scale\n */\nfunction getScale(start, end) {\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\n}\n\nvar MOUSE_INPUT_MAP = {\n    mousedown: INPUT_START,\n    mousemove: INPUT_MOVE,\n    mouseup: INPUT_END\n};\n\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\n\n/**\n * Mouse events input\n * @constructor\n * @extends Input\n */\nfunction MouseInput() {\n    this.evEl = MOUSE_ELEMENT_EVENTS;\n    this.evWin = MOUSE_WINDOW_EVENTS;\n\n    this.pressed = false; // mousedown state\n\n    Input.apply(this, arguments);\n}\n\ninherit(MouseInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function MEhandler(ev) {\n        var eventType = MOUSE_INPUT_MAP[ev.type];\n\n        // on start we want to have the left mouse button down\n        if (eventType & INPUT_START && ev.button === 0) {\n            this.pressed = true;\n        }\n\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\n            eventType = INPUT_END;\n        }\n\n        // mouse must be down\n        if (!this.pressed) {\n            return;\n        }\n\n        if (eventType & INPUT_END) {\n            this.pressed = false;\n        }\n\n        this.callback(this.manager, eventType, {\n            pointers: [ev],\n            changedPointers: [ev],\n            pointerType: INPUT_TYPE_MOUSE,\n            srcEvent: ev\n        });\n    }\n});\n\nvar POINTER_INPUT_MAP = {\n    pointerdown: INPUT_START,\n    pointermove: INPUT_MOVE,\n    pointerup: INPUT_END,\n    pointercancel: INPUT_CANCEL,\n    pointerout: INPUT_CANCEL\n};\n\n// in IE10 the pointer types is defined as an enum\nvar IE10_POINTER_TYPE_ENUM = {\n    2: INPUT_TYPE_TOUCH,\n    3: INPUT_TYPE_PEN,\n    4: INPUT_TYPE_MOUSE,\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\n};\n\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\n\n// IE10 has prefixed support, and case-sensitive\nif (window.MSPointerEvent && !window.PointerEvent) {\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\n}\n\n/**\n * Pointer events input\n * @constructor\n * @extends Input\n */\nfunction PointerEventInput() {\n    this.evEl = POINTER_ELEMENT_EVENTS;\n    this.evWin = POINTER_WINDOW_EVENTS;\n\n    Input.apply(this, arguments);\n\n    this.store = (this.manager.session.pointerEvents = []);\n}\n\ninherit(PointerEventInput, Input, {\n    /**\n     * handle mouse events\n     * @param {Object} ev\n     */\n    handler: function PEhandler(ev) {\n        var store = this.store;\n        var removePointer = false;\n\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\n\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\n\n        // get index of the event in the store\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\n\n        // start and mouse must be down\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\n            if (storeIndex < 0) {\n                store.push(ev);\n                storeIndex = store.length - 1;\n            }\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n            removePointer = true;\n        }\n\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\n        if (storeIndex < 0) {\n            return;\n        }\n\n        // update the event in the store\n        store[storeIndex] = ev;\n\n        this.callback(this.manager, eventType, {\n            pointers: store,\n            changedPointers: [ev],\n            pointerType: pointerType,\n            srcEvent: ev\n        });\n\n        if (removePointer) {\n            // remove from the store\n            store.splice(storeIndex, 1);\n        }\n    }\n});\n\nvar SINGLE_TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Touch events input\n * @constructor\n * @extends Input\n */\nfunction SingleTouchInput() {\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\n    this.started = false;\n\n    Input.apply(this, arguments);\n}\n\ninherit(SingleTouchInput, Input, {\n    handler: function TEhandler(ev) {\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\n\n        // should we handle the touch events?\n        if (type === INPUT_START) {\n            this.started = true;\n        }\n\n        if (!this.started) {\n            return;\n        }\n\n        var touches = normalizeSingleTouches.call(this, ev, type);\n\n        // when done, reset the started state\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\n            this.started = false;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction normalizeSingleTouches(ev, type) {\n    var all = toArray(ev.touches);\n    var changed = toArray(ev.changedTouches);\n\n    if (type & (INPUT_END | INPUT_CANCEL)) {\n        all = uniqueArray(all.concat(changed), 'identifier', true);\n    }\n\n    return [all, changed];\n}\n\nvar TOUCH_INPUT_MAP = {\n    touchstart: INPUT_START,\n    touchmove: INPUT_MOVE,\n    touchend: INPUT_END,\n    touchcancel: INPUT_CANCEL\n};\n\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\n\n/**\n * Multi-user touch events input\n * @constructor\n * @extends Input\n */\nfunction TouchInput() {\n    this.evTarget = TOUCH_TARGET_EVENTS;\n    this.targetIds = {};\n\n    Input.apply(this, arguments);\n}\n\ninherit(TouchInput, Input, {\n    handler: function MTEhandler(ev) {\n        var type = TOUCH_INPUT_MAP[ev.type];\n        var touches = getTouches.call(this, ev, type);\n        if (!touches) {\n            return;\n        }\n\n        this.callback(this.manager, type, {\n            pointers: touches[0],\n            changedPointers: touches[1],\n            pointerType: INPUT_TYPE_TOUCH,\n            srcEvent: ev\n        });\n    }\n});\n\n/**\n * @this {TouchInput}\n * @param {Object} ev\n * @param {Number} type flag\n * @returns {undefined|Array} [all, changed]\n */\nfunction getTouches(ev, type) {\n    var allTouches = toArray(ev.touches);\n    var targetIds = this.targetIds;\n\n    // when there is only one touch, the process can be simplified\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\n        targetIds[allTouches[0].identifier] = true;\n        return [allTouches, allTouches];\n    }\n\n    var i,\n        targetTouches,\n        changedTouches = toArray(ev.changedTouches),\n        changedTargetTouches = [],\n        target = this.target;\n\n    // get target touches from touches\n    targetTouches = allTouches.filter(function(touch) {\n        return hasParent(touch.target, target);\n    });\n\n    // collect touches\n    if (type === INPUT_START) {\n        i = 0;\n        while (i < targetTouches.length) {\n            targetIds[targetTouches[i].identifier] = true;\n            i++;\n        }\n    }\n\n    // filter changed touches to only contain touches that exist in the collected target ids\n    i = 0;\n    while (i < changedTouches.length) {\n        if (targetIds[changedTouches[i].identifier]) {\n            changedTargetTouches.push(changedTouches[i]);\n        }\n\n        // cleanup removed touches\n        if (type & (INPUT_END | INPUT_CANCEL)) {\n            delete targetIds[changedTouches[i].identifier];\n        }\n        i++;\n    }\n\n    if (!changedTargetTouches.length) {\n        return;\n    }\n\n    return [\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\n        changedTargetTouches\n    ];\n}\n\n/**\n * Combined touch and mouse input\n *\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\n * This because touch devices also emit mouse events while doing a touch.\n *\n * @constructor\n * @extends Input\n */\n\nvar DEDUP_TIMEOUT = 2500;\nvar DEDUP_DISTANCE = 25;\n\nfunction TouchMouseInput() {\n    Input.apply(this, arguments);\n\n    var handler = bindFn(this.handler, this);\n    this.touch = new TouchInput(this.manager, handler);\n    this.mouse = new MouseInput(this.manager, handler);\n\n    this.primaryTouch = null;\n    this.lastTouches = [];\n}\n\ninherit(TouchMouseInput, Input, {\n    /**\n     * handle mouse and touch events\n     * @param {Hammer} manager\n     * @param {String} inputEvent\n     * @param {Object} inputData\n     */\n    handler: function TMEhandler(manager, inputEvent, inputData) {\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\n\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\n            return;\n        }\n\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\n        if (isTouch) {\n            recordTouches.call(this, inputEvent, inputData);\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\n            return;\n        }\n\n        this.callback(manager, inputEvent, inputData);\n    },\n\n    /**\n     * remove the event listeners\n     */\n    destroy: function destroy() {\n        this.touch.destroy();\n        this.mouse.destroy();\n    }\n});\n\nfunction recordTouches(eventType, eventData) {\n    if (eventType & INPUT_START) {\n        this.primaryTouch = eventData.changedPointers[0].identifier;\n        setLastTouch.call(this, eventData);\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\n        setLastTouch.call(this, eventData);\n    }\n}\n\nfunction setLastTouch(eventData) {\n    var touch = eventData.changedPointers[0];\n\n    if (touch.identifier === this.primaryTouch) {\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\n        this.lastTouches.push(lastTouch);\n        var lts = this.lastTouches;\n        var removeLastTouch = function() {\n            var i = lts.indexOf(lastTouch);\n            if (i > -1) {\n                lts.splice(i, 1);\n            }\n        };\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\n    }\n}\n\nfunction isSyntheticEvent(eventData) {\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\n    for (var i = 0; i < this.lastTouches.length; i++) {\n        var t = this.lastTouches[i];\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\n\n// magical touchAction value\nvar TOUCH_ACTION_COMPUTE = 'compute';\nvar TOUCH_ACTION_AUTO = 'auto';\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\nvar TOUCH_ACTION_NONE = 'none';\nvar TOUCH_ACTION_PAN_X = 'pan-x';\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\nvar TOUCH_ACTION_MAP = getTouchActionProps();\n\n/**\n * Touch Action\n * sets the touchAction property or uses the js alternative\n * @param {Manager} manager\n * @param {String} value\n * @constructor\n */\nfunction TouchAction(manager, value) {\n    this.manager = manager;\n    this.set(value);\n}\n\nTouchAction.prototype = {\n    /**\n     * set the touchAction value on the element or enable the polyfill\n     * @param {String} value\n     */\n    set: function(value) {\n        // find out the touch-action by the event handlers\n        if (value == TOUCH_ACTION_COMPUTE) {\n            value = this.compute();\n        }\n\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\n        }\n        this.actions = value.toLowerCase().trim();\n    },\n\n    /**\n     * just re-set the touchAction value\n     */\n    update: function() {\n        this.set(this.manager.options.touchAction);\n    },\n\n    /**\n     * compute the value for the touchAction property based on the recognizer's settings\n     * @returns {String} value\n     */\n    compute: function() {\n        var actions = [];\n        each(this.manager.recognizers, function(recognizer) {\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\n                actions = actions.concat(recognizer.getTouchAction());\n            }\n        });\n        return cleanTouchActions(actions.join(' '));\n    },\n\n    /**\n     * this method is called on each input cycle and provides the preventing of the browser behavior\n     * @param {Object} input\n     */\n    preventDefaults: function(input) {\n        var srcEvent = input.srcEvent;\n        var direction = input.offsetDirection;\n\n        // if the touch action did prevented once this session\n        if (this.manager.session.prevented) {\n            srcEvent.preventDefault();\n            return;\n        }\n\n        var actions = this.actions;\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\n\n        if (hasNone) {\n            //do not prevent defaults if this is a tap gesture\n\n            var isTapPointer = input.pointers.length === 1;\n            var isTapMovement = input.distance < 2;\n            var isTapTouchTime = input.deltaTime < 250;\n\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\n                return;\n            }\n        }\n\n        if (hasPanX && hasPanY) {\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\n            return;\n        }\n\n        if (hasNone ||\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\n            return this.preventSrc(srcEvent);\n        }\n    },\n\n    /**\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\n     * @param {Object} srcEvent\n     */\n    preventSrc: function(srcEvent) {\n        this.manager.session.prevented = true;\n        srcEvent.preventDefault();\n    }\n};\n\n/**\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\n * @param {String} actions\n * @returns {*}\n */\nfunction cleanTouchActions(actions) {\n    // none\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\n\n    // if both pan-x and pan-y are set (different recognizers\n    // for different directions, e.g. horizontal pan but vertical swipe?)\n    // we need none (as otherwise with pan-x pan-y combined none of these\n    // recognizers will work, since the browser would handle all panning\n    if (hasPanX && hasPanY) {\n        return TOUCH_ACTION_NONE;\n    }\n\n    // pan-x OR pan-y\n    if (hasPanX || hasPanY) {\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\n    }\n\n    // manipulation\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\n        return TOUCH_ACTION_MANIPULATION;\n    }\n\n    return TOUCH_ACTION_AUTO;\n}\n\nfunction getTouchActionProps() {\n    if (!NATIVE_TOUCH_ACTION) {\n        return false;\n    }\n    var touchMap = {};\n    var cssSupports = window.CSS && window.CSS.supports;\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\n\n        // If css.supports is not supported but there is native touch-action assume it supports\n        // all values. This is the case for IE 10 and 11.\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\n    });\n    return touchMap;\n}\n\n/**\n * Recognizer flow explained; *\n * All recognizers have the initial state of POSSIBLE when a input session starts.\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\n *\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\n * which determines with state it should be.\n *\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\n * POSSIBLE to give it another change on the next cycle.\n *\n *               Possible\n *                  |\n *            +-----+---------------+\n *            |                     |\n *      +-----+-----+               |\n *      |           |               |\n *   Failed      Cancelled          |\n *                          +-------+------+\n *                          |              |\n *                      Recognized       Began\n *                                         |\n *                                      Changed\n *                                         |\n *                                  Ended/Recognized\n */\nvar STATE_POSSIBLE = 1;\nvar STATE_BEGAN = 2;\nvar STATE_CHANGED = 4;\nvar STATE_ENDED = 8;\nvar STATE_RECOGNIZED = STATE_ENDED;\nvar STATE_CANCELLED = 16;\nvar STATE_FAILED = 32;\n\n/**\n * Recognizer\n * Every recognizer needs to extend from this class.\n * @constructor\n * @param {Object} options\n */\nfunction Recognizer(options) {\n    this.options = assign({}, this.defaults, options || {});\n\n    this.id = uniqueId();\n\n    this.manager = null;\n\n    // default is enable true\n    this.options.enable = ifUndefined(this.options.enable, true);\n\n    this.state = STATE_POSSIBLE;\n\n    this.simultaneous = {};\n    this.requireFail = [];\n}\n\nRecognizer.prototype = {\n    /**\n     * @virtual\n     * @type {Object}\n     */\n    defaults: {},\n\n    /**\n     * set options\n     * @param {Object} options\n     * @return {Recognizer}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // also update the touchAction, in case something changed about the directions/enabled state\n        this.manager && this.manager.touchAction.update();\n        return this;\n    },\n\n    /**\n     * recognize simultaneous with an other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    recognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\n            return this;\n        }\n\n        var simultaneous = this.simultaneous;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (!simultaneous[otherRecognizer.id]) {\n            simultaneous[otherRecognizer.id] = otherRecognizer;\n            otherRecognizer.recognizeWith(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRecognizeWith: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        delete this.simultaneous[otherRecognizer.id];\n        return this;\n    },\n\n    /**\n     * recognizer can only run when an other is failing\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    requireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\n            return this;\n        }\n\n        var requireFail = this.requireFail;\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        if (inArray(requireFail, otherRecognizer) === -1) {\n            requireFail.push(otherRecognizer);\n            otherRecognizer.requireFailure(this);\n        }\n        return this;\n    },\n\n    /**\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\n     * @param {Recognizer} otherRecognizer\n     * @returns {Recognizer} this\n     */\n    dropRequireFailure: function(otherRecognizer) {\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\n            return this;\n        }\n\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\n        var index = inArray(this.requireFail, otherRecognizer);\n        if (index > -1) {\n            this.requireFail.splice(index, 1);\n        }\n        return this;\n    },\n\n    /**\n     * has require failures boolean\n     * @returns {boolean}\n     */\n    hasRequireFailures: function() {\n        return this.requireFail.length > 0;\n    },\n\n    /**\n     * if the recognizer can recognize simultaneous with an other recognizer\n     * @param {Recognizer} otherRecognizer\n     * @returns {Boolean}\n     */\n    canRecognizeWith: function(otherRecognizer) {\n        return !!this.simultaneous[otherRecognizer.id];\n    },\n\n    /**\n     * You should use `tryEmit` instead of `emit` directly to check\n     * that all the needed recognizers has failed before emitting.\n     * @param {Object} input\n     */\n    emit: function(input) {\n        var self = this;\n        var state = this.state;\n\n        function emit(event) {\n            self.manager.emit(event, input);\n        }\n\n        // 'panstart' and 'panmove'\n        if (state < STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n\n        emit(self.options.event); // simple 'eventName' events\n\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\n            emit(input.additionalEvent);\n        }\n\n        // panend and pancancel\n        if (state >= STATE_ENDED) {\n            emit(self.options.event + stateStr(state));\n        }\n    },\n\n    /**\n     * Check that all the require failure recognizers has failed,\n     * if true, it emits a gesture event,\n     * otherwise, setup the state to FAILED.\n     * @param {Object} input\n     */\n    tryEmit: function(input) {\n        if (this.canEmit()) {\n            return this.emit(input);\n        }\n        // it's failing anyway\n        this.state = STATE_FAILED;\n    },\n\n    /**\n     * can we emit?\n     * @returns {boolean}\n     */\n    canEmit: function() {\n        var i = 0;\n        while (i < this.requireFail.length) {\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\n                return false;\n            }\n            i++;\n        }\n        return true;\n    },\n\n    /**\n     * update the recognizer\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        // make a new copy of the inputData\n        // so we can change the inputData without messing up the other recognizers\n        var inputDataClone = assign({}, inputData);\n\n        // is is enabled and allow recognizing?\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\n            this.reset();\n            this.state = STATE_FAILED;\n            return;\n        }\n\n        // reset when we've reached the end\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\n            this.state = STATE_POSSIBLE;\n        }\n\n        this.state = this.process(inputDataClone);\n\n        // the recognizer has recognized a gesture\n        // so trigger an event\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\n            this.tryEmit(inputDataClone);\n        }\n    },\n\n    /**\n     * return the state of the recognizer\n     * the actual recognizing happens in this method\n     * @virtual\n     * @param {Object} inputData\n     * @returns {Const} STATE\n     */\n    process: function(inputData) { }, // jshint ignore:line\n\n    /**\n     * return the preferred touch-action\n     * @virtual\n     * @returns {Array}\n     */\n    getTouchAction: function() { },\n\n    /**\n     * called when the gesture isn't allowed to recognize\n     * like when another is being recognized or it is disabled\n     * @virtual\n     */\n    reset: function() { }\n};\n\n/**\n * get a usable string, used as event postfix\n * @param {Const} state\n * @returns {String} state\n */\nfunction stateStr(state) {\n    if (state & STATE_CANCELLED) {\n        return 'cancel';\n    } else if (state & STATE_ENDED) {\n        return 'end';\n    } else if (state & STATE_CHANGED) {\n        return 'move';\n    } else if (state & STATE_BEGAN) {\n        return 'start';\n    }\n    return '';\n}\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction directionStr(direction) {\n    if (direction == DIRECTION_DOWN) {\n        return 'down';\n    } else if (direction == DIRECTION_UP) {\n        return 'up';\n    } else if (direction == DIRECTION_LEFT) {\n        return 'left';\n    } else if (direction == DIRECTION_RIGHT) {\n        return 'right';\n    }\n    return '';\n}\n\n/**\n * get a recognizer by name if it is bound to a manager\n * @param {Recognizer|String} otherRecognizer\n * @param {Recognizer} recognizer\n * @returns {Recognizer}\n */\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\n    var manager = recognizer.manager;\n    if (manager) {\n        return manager.get(otherRecognizer);\n    }\n    return otherRecognizer;\n}\n\n/**\n * This recognizer is just used as a base for the simple attribute recognizers.\n * @constructor\n * @extends Recognizer\n */\nfunction AttrRecognizer() {\n    Recognizer.apply(this, arguments);\n}\n\ninherit(AttrRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof AttrRecognizer\n     */\n    defaults: {\n        /**\n         * @type {Number}\n         * @default 1\n         */\n        pointers: 1\n    },\n\n    /**\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {Boolean} recognized\n     */\n    attrTest: function(input) {\n        var optionPointers = this.options.pointers;\n        return optionPointers === 0 || input.pointers.length === optionPointers;\n    },\n\n    /**\n     * Process the input and return the state for the recognizer\n     * @memberof AttrRecognizer\n     * @param {Object} input\n     * @returns {*} State\n     */\n    process: function(input) {\n        var state = this.state;\n        var eventType = input.eventType;\n\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\n        var isValid = this.attrTest(input);\n\n        // on cancel input and we've recognized before, return STATE_CANCELLED\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\n            return state | STATE_CANCELLED;\n        } else if (isRecognized || isValid) {\n            if (eventType & INPUT_END) {\n                return state | STATE_ENDED;\n            } else if (!(state & STATE_BEGAN)) {\n                return STATE_BEGAN;\n            }\n            return state | STATE_CHANGED;\n        }\n        return STATE_FAILED;\n    }\n});\n\n/**\n * Pan\n * Recognized when the pointer is down and moved in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PanRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n\n    this.pX = null;\n    this.pY = null;\n}\n\ninherit(PanRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PanRecognizer\n     */\n    defaults: {\n        event: 'pan',\n        threshold: 10,\n        pointers: 1,\n        direction: DIRECTION_ALL\n    },\n\n    getTouchAction: function() {\n        var direction = this.options.direction;\n        var actions = [];\n        if (direction & DIRECTION_HORIZONTAL) {\n            actions.push(TOUCH_ACTION_PAN_Y);\n        }\n        if (direction & DIRECTION_VERTICAL) {\n            actions.push(TOUCH_ACTION_PAN_X);\n        }\n        return actions;\n    },\n\n    directionTest: function(input) {\n        var options = this.options;\n        var hasMoved = true;\n        var distance = input.distance;\n        var direction = input.direction;\n        var x = input.deltaX;\n        var y = input.deltaY;\n\n        // lock to axis?\n        if (!(direction & options.direction)) {\n            if (options.direction & DIRECTION_HORIZONTAL) {\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n                hasMoved = x != this.pX;\n                distance = Math.abs(input.deltaX);\n            } else {\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n                hasMoved = y != this.pY;\n                distance = Math.abs(input.deltaY);\n            }\n        }\n        input.direction = direction;\n        return hasMoved && distance > options.threshold && direction & options.direction;\n    },\n\n    attrTest: function(input) {\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n    },\n\n    emit: function(input) {\n\n        this.pX = input.deltaX;\n        this.pY = input.deltaY;\n\n        var direction = directionStr(input.direction);\n\n        if (direction) {\n            input.additionalEvent = this.options.event + direction;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Pinch\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\n * @constructor\n * @extends AttrRecognizer\n */\nfunction PinchRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(PinchRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'pinch',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\n    },\n\n    emit: function(input) {\n        if (input.scale !== 1) {\n            var inOut = input.scale < 1 ? 'in' : 'out';\n            input.additionalEvent = this.options.event + inOut;\n        }\n        this._super.emit.call(this, input);\n    }\n});\n\n/**\n * Press\n * Recognized when the pointer is down for x ms without any movement.\n * @constructor\n * @extends Recognizer\n */\nfunction PressRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    this._timer = null;\n    this._input = null;\n}\n\ninherit(PressRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PressRecognizer\n     */\n    defaults: {\n        event: 'press',\n        pointers: 1,\n        time: 251, // minimal time of the pointer to be pressed\n        threshold: 9 // a minimal movement is ok, but keep it low\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_AUTO];\n    },\n\n    process: function(input) {\n        var options = this.options;\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTime = input.deltaTime > options.time;\n\n        this._input = input;\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\n            this.reset();\n        } else if (input.eventType & INPUT_START) {\n            this.reset();\n            this._timer = setTimeoutContext(function() {\n                this.state = STATE_RECOGNIZED;\n                this.tryEmit();\n            }, options.time, this);\n        } else if (input.eventType & INPUT_END) {\n            return STATE_RECOGNIZED;\n        }\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function(input) {\n        if (this.state !== STATE_RECOGNIZED) {\n            return;\n        }\n\n        if (input && (input.eventType & INPUT_END)) {\n            this.manager.emit(this.options.event + 'up', input);\n        } else {\n            this._input.timeStamp = now();\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Rotate\n * Recognized when two or more pointer are moving in a circular motion.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction RotateRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(RotateRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof RotateRecognizer\n     */\n    defaults: {\n        event: 'rotate',\n        threshold: 0,\n        pointers: 2\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_NONE];\n    },\n\n    attrTest: function(input) {\n        return this._super.attrTest.call(this, input) &&\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\n    }\n});\n\n/**\n * Swipe\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\n * @constructor\n * @extends AttrRecognizer\n */\nfunction SwipeRecognizer() {\n    AttrRecognizer.apply(this, arguments);\n}\n\ninherit(SwipeRecognizer, AttrRecognizer, {\n    /**\n     * @namespace\n     * @memberof SwipeRecognizer\n     */\n    defaults: {\n        event: 'swipe',\n        threshold: 10,\n        velocity: 0.3,\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\n        pointers: 1\n    },\n\n    getTouchAction: function() {\n        return PanRecognizer.prototype.getTouchAction.call(this);\n    },\n\n    attrTest: function(input) {\n        var direction = this.options.direction;\n        var velocity;\n\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\n            velocity = input.overallVelocity;\n        } else if (direction & DIRECTION_HORIZONTAL) {\n            velocity = input.overallVelocityX;\n        } else if (direction & DIRECTION_VERTICAL) {\n            velocity = input.overallVelocityY;\n        }\n\n        return this._super.attrTest.call(this, input) &&\n            direction & input.offsetDirection &&\n            input.distance > this.options.threshold &&\n            input.maxPointers == this.options.pointers &&\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\n    },\n\n    emit: function(input) {\n        var direction = directionStr(input.offsetDirection);\n        if (direction) {\n            this.manager.emit(this.options.event + direction, input);\n        }\n\n        this.manager.emit(this.options.event, input);\n    }\n});\n\n/**\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\n * a single tap.\n *\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\n * multi-taps being recognized.\n * @constructor\n * @extends Recognizer\n */\nfunction TapRecognizer() {\n    Recognizer.apply(this, arguments);\n\n    // previous time and center,\n    // used for tap counting\n    this.pTime = false;\n    this.pCenter = false;\n\n    this._timer = null;\n    this._input = null;\n    this.count = 0;\n}\n\ninherit(TapRecognizer, Recognizer, {\n    /**\n     * @namespace\n     * @memberof PinchRecognizer\n     */\n    defaults: {\n        event: 'tap',\n        pointers: 1,\n        taps: 1,\n        interval: 300, // max time between the multi-tap taps\n        time: 250, // max time of the pointer to be down (like finger on the screen)\n        threshold: 9, // a minimal movement is ok, but keep it low\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\n    },\n\n    getTouchAction: function() {\n        return [TOUCH_ACTION_MANIPULATION];\n    },\n\n    process: function(input) {\n        var options = this.options;\n\n        var validPointers = input.pointers.length === options.pointers;\n        var validMovement = input.distance < options.threshold;\n        var validTouchTime = input.deltaTime < options.time;\n\n        this.reset();\n\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\n            return this.failTimeout();\n        }\n\n        // we only allow little movement\n        // and we've reached an end event, so a tap is possible\n        if (validMovement && validTouchTime && validPointers) {\n            if (input.eventType != INPUT_END) {\n                return this.failTimeout();\n            }\n\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\n\n            this.pTime = input.timeStamp;\n            this.pCenter = input.center;\n\n            if (!validMultiTap || !validInterval) {\n                this.count = 1;\n            } else {\n                this.count += 1;\n            }\n\n            this._input = input;\n\n            // if tap count matches we have recognized it,\n            // else it has began recognizing...\n            var tapCount = this.count % options.taps;\n            if (tapCount === 0) {\n                // no failing requirements, immediately trigger the tap event\n                // or wait as long as the multitap interval to trigger\n                if (!this.hasRequireFailures()) {\n                    return STATE_RECOGNIZED;\n                } else {\n                    this._timer = setTimeoutContext(function() {\n                        this.state = STATE_RECOGNIZED;\n                        this.tryEmit();\n                    }, options.interval, this);\n                    return STATE_BEGAN;\n                }\n            }\n        }\n        return STATE_FAILED;\n    },\n\n    failTimeout: function() {\n        this._timer = setTimeoutContext(function() {\n            this.state = STATE_FAILED;\n        }, this.options.interval, this);\n        return STATE_FAILED;\n    },\n\n    reset: function() {\n        clearTimeout(this._timer);\n    },\n\n    emit: function() {\n        if (this.state == STATE_RECOGNIZED) {\n            this._input.tapCount = this.count;\n            this.manager.emit(this.options.event, this._input);\n        }\n    }\n});\n\n/**\n * Simple way to create a manager with a default set of recognizers.\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Hammer(element, options) {\n    options = options || {};\n    options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);\n    return new Manager(element, options);\n}\n\n/**\n * @const {string}\n */\nHammer.VERSION = '2.0.7';\n\n/**\n * default settings\n * @namespace\n */\nHammer.defaults = {\n    /**\n     * set if DOM events are being triggered.\n     * But this is slower and unused by simple implementations, so disabled by default.\n     * @type {Boolean}\n     * @default false\n     */\n    domEvents: false,\n\n    /**\n     * The value for the touchAction property/fallback.\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\n     * @type {String}\n     * @default compute\n     */\n    touchAction: TOUCH_ACTION_COMPUTE,\n\n    /**\n     * @type {Boolean}\n     * @default true\n     */\n    enable: true,\n\n    /**\n     * EXPERIMENTAL FEATURE -- can be removed/changed\n     * Change the parent input target element.\n     * If Null, then it is being set the to main element.\n     * @type {Null|EventTarget}\n     * @default null\n     */\n    inputTarget: null,\n\n    /**\n     * force an input class\n     * @type {Null|Function}\n     * @default null\n     */\n    inputClass: null,\n\n    /**\n     * Default recognizer setup when calling `Hammer()`\n     * When creating a new Manager these will be skipped.\n     * @type {Array}\n     */\n    preset: [\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\n        [RotateRecognizer, {enable: false}],\n        [PinchRecognizer, {enable: false}, ['rotate']],\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\n        [TapRecognizer],\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\n        [PressRecognizer]\n    ],\n\n    /**\n     * Some CSS properties can be used to improve the working of Hammer.\n     * Add them to this method and they will be set when creating a new Manager.\n     * @namespace\n     */\n    cssProps: {\n        /**\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userSelect: 'none',\n\n        /**\n         * Disable the Windows Phone grippers when pressing an element.\n         * @type {String}\n         * @default 'none'\n         */\n        touchSelect: 'none',\n\n        /**\n         * Disables the default callout shown when you touch and hold a touch target.\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\n         * a callout containing information about the link. This property allows you to disable that callout.\n         * @type {String}\n         * @default 'none'\n         */\n        touchCallout: 'none',\n\n        /**\n         * Specifies whether zooming is enabled. Used by IE10>\n         * @type {String}\n         * @default 'none'\n         */\n        contentZooming: 'none',\n\n        /**\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\n         * @type {String}\n         * @default 'none'\n         */\n        userDrag: 'none',\n\n        /**\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\n         * clickable element in iOS. This property obeys the alpha value, if specified.\n         * @type {String}\n         * @default 'rgba(0,0,0,0)'\n         */\n        tapHighlightColor: 'rgba(0,0,0,0)'\n    }\n};\n\nvar STOP = 1;\nvar FORCED_STOP = 2;\n\n/**\n * Manager\n * @param {HTMLElement} element\n * @param {Object} [options]\n * @constructor\n */\nfunction Manager(element, options) {\n    this.options = assign({}, Hammer.defaults, options || {});\n\n    this.options.inputTarget = this.options.inputTarget || element;\n\n    this.handlers = {};\n    this.session = {};\n    this.recognizers = [];\n    this.oldCssProps = {};\n\n    this.element = element;\n    this.input = createInputInstance(this);\n    this.touchAction = new TouchAction(this, this.options.touchAction);\n\n    toggleCssProps(this, true);\n\n    each(this.options.recognizers, function(item) {\n        var recognizer = this.add(new (item[0])(item[1]));\n        item[2] && recognizer.recognizeWith(item[2]);\n        item[3] && recognizer.requireFailure(item[3]);\n    }, this);\n}\n\nManager.prototype = {\n    /**\n     * set options\n     * @param {Object} options\n     * @returns {Manager}\n     */\n    set: function(options) {\n        assign(this.options, options);\n\n        // Options that need a little more setup\n        if (options.touchAction) {\n            this.touchAction.update();\n        }\n        if (options.inputTarget) {\n            // Clean up existing event listeners and reinitialize\n            this.input.destroy();\n            this.input.target = options.inputTarget;\n            this.input.init();\n        }\n        return this;\n    },\n\n    /**\n     * stop recognizing for this session.\n     * This session will be discarded, when a new [input]start event is fired.\n     * When forced, the recognizer cycle is stopped immediately.\n     * @param {Boolean} [force]\n     */\n    stop: function(force) {\n        this.session.stopped = force ? FORCED_STOP : STOP;\n    },\n\n    /**\n     * run the recognizers!\n     * called by the inputHandler function on every movement of the pointers (touches)\n     * it walks through all the recognizers and tries to detect the gesture that is being made\n     * @param {Object} inputData\n     */\n    recognize: function(inputData) {\n        var session = this.session;\n        if (session.stopped) {\n            return;\n        }\n\n        // run the touch-action polyfill\n        this.touchAction.preventDefaults(inputData);\n\n        var recognizer;\n        var recognizers = this.recognizers;\n\n        // this holds the recognizer that is being recognized.\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\n        // if no recognizer is detecting a thing, it is set to `null`\n        var curRecognizer = session.curRecognizer;\n\n        // reset when the last recognizer is recognized\n        // or when we're in a new session\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\n            curRecognizer = session.curRecognizer = null;\n        }\n\n        var i = 0;\n        while (i < recognizers.length) {\n            recognizer = recognizers[i];\n\n            // find out if we are allowed try to recognize the input for this one.\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\n            //      that is being recognized.\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\n            if (session.stopped !== FORCED_STOP && ( // 1\n                    !curRecognizer || recognizer == curRecognizer || // 2\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\n                recognizer.recognize(inputData);\n            } else {\n                recognizer.reset();\n            }\n\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\n            // current active recognizer. but only if we don't already have an active recognizer\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\n                curRecognizer = session.curRecognizer = recognizer;\n            }\n            i++;\n        }\n    },\n\n    /**\n     * get a recognizer by its event name.\n     * @param {Recognizer|String} recognizer\n     * @returns {Recognizer|Null}\n     */\n    get: function(recognizer) {\n        if (recognizer instanceof Recognizer) {\n            return recognizer;\n        }\n\n        var recognizers = this.recognizers;\n        for (var i = 0; i < recognizers.length; i++) {\n            if (recognizers[i].options.event == recognizer) {\n                return recognizers[i];\n            }\n        }\n        return null;\n    },\n\n    /**\n     * add a recognizer to the manager\n     * existing recognizers with the same event name will be removed\n     * @param {Recognizer} recognizer\n     * @returns {Recognizer|Manager}\n     */\n    add: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'add', this)) {\n            return this;\n        }\n\n        // remove existing\n        var existing = this.get(recognizer.options.event);\n        if (existing) {\n            this.remove(existing);\n        }\n\n        this.recognizers.push(recognizer);\n        recognizer.manager = this;\n\n        this.touchAction.update();\n        return recognizer;\n    },\n\n    /**\n     * remove a recognizer by name or instance\n     * @param {Recognizer|String} recognizer\n     * @returns {Manager}\n     */\n    remove: function(recognizer) {\n        if (invokeArrayArg(recognizer, 'remove', this)) {\n            return this;\n        }\n\n        recognizer = this.get(recognizer);\n\n        // let's make sure this recognizer exists\n        if (recognizer) {\n            var recognizers = this.recognizers;\n            var index = inArray(recognizers, recognizer);\n\n            if (index !== -1) {\n                recognizers.splice(index, 1);\n                this.touchAction.update();\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * bind event\n     * @param {String} events\n     * @param {Function} handler\n     * @returns {EventEmitter} this\n     */\n    on: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n        if (handler === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            handlers[event] = handlers[event] || [];\n            handlers[event].push(handler);\n        });\n        return this;\n    },\n\n    /**\n     * unbind event, leave emit blank to remove all handlers\n     * @param {String} events\n     * @param {Function} [handler]\n     * @returns {EventEmitter} this\n     */\n    off: function(events, handler) {\n        if (events === undefined) {\n            return;\n        }\n\n        var handlers = this.handlers;\n        each(splitStr(events), function(event) {\n            if (!handler) {\n                delete handlers[event];\n            } else {\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\n            }\n        });\n        return this;\n    },\n\n    /**\n     * emit event to the listeners\n     * @param {String} event\n     * @param {Object} data\n     */\n    emit: function(event, data) {\n        // we also want to trigger dom events\n        if (this.options.domEvents) {\n            triggerDomEvent(event, data);\n        }\n\n        // no handlers, so skip it all\n        var handlers = this.handlers[event] && this.handlers[event].slice();\n        if (!handlers || !handlers.length) {\n            return;\n        }\n\n        data.type = event;\n        data.preventDefault = function() {\n            data.srcEvent.preventDefault();\n        };\n\n        var i = 0;\n        while (i < handlers.length) {\n            handlers[i](data);\n            i++;\n        }\n    },\n\n    /**\n     * destroy the manager and unbinds all events\n     * it doesn't unbind dom events, that is the user own responsibility\n     */\n    destroy: function() {\n        this.element && toggleCssProps(this, false);\n\n        this.handlers = {};\n        this.session = {};\n        this.input.destroy();\n        this.element = null;\n    }\n};\n\n/**\n * add/remove the css properties as defined in manager.options.cssProps\n * @param {Manager} manager\n * @param {Boolean} add\n */\nfunction toggleCssProps(manager, add) {\n    var element = manager.element;\n    if (!element.style) {\n        return;\n    }\n    var prop;\n    each(manager.options.cssProps, function(value, name) {\n        prop = prefixed(element.style, name);\n        if (add) {\n            manager.oldCssProps[prop] = element.style[prop];\n            element.style[prop] = value;\n        } else {\n            element.style[prop] = manager.oldCssProps[prop] || '';\n        }\n    });\n    if (!add) {\n        manager.oldCssProps = {};\n    }\n}\n\n/**\n * trigger dom event\n * @param {String} event\n * @param {Object} data\n */\nfunction triggerDomEvent(event, data) {\n    var gestureEvent = document.createEvent('Event');\n    gestureEvent.initEvent(event, true, true);\n    gestureEvent.gesture = data;\n    data.target.dispatchEvent(gestureEvent);\n}\n\nassign(Hammer, {\n    INPUT_START: INPUT_START,\n    INPUT_MOVE: INPUT_MOVE,\n    INPUT_END: INPUT_END,\n    INPUT_CANCEL: INPUT_CANCEL,\n\n    STATE_POSSIBLE: STATE_POSSIBLE,\n    STATE_BEGAN: STATE_BEGAN,\n    STATE_CHANGED: STATE_CHANGED,\n    STATE_ENDED: STATE_ENDED,\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\n    STATE_CANCELLED: STATE_CANCELLED,\n    STATE_FAILED: STATE_FAILED,\n\n    DIRECTION_NONE: DIRECTION_NONE,\n    DIRECTION_LEFT: DIRECTION_LEFT,\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\n    DIRECTION_UP: DIRECTION_UP,\n    DIRECTION_DOWN: DIRECTION_DOWN,\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\n    DIRECTION_ALL: DIRECTION_ALL,\n\n    Manager: Manager,\n    Input: Input,\n    TouchAction: TouchAction,\n\n    TouchInput: TouchInput,\n    MouseInput: MouseInput,\n    PointerEventInput: PointerEventInput,\n    TouchMouseInput: TouchMouseInput,\n    SingleTouchInput: SingleTouchInput,\n\n    Recognizer: Recognizer,\n    AttrRecognizer: AttrRecognizer,\n    Tap: TapRecognizer,\n    Pan: PanRecognizer,\n    Swipe: SwipeRecognizer,\n    Pinch: PinchRecognizer,\n    Rotate: RotateRecognizer,\n    Press: PressRecognizer,\n\n    on: addEventListeners,\n    off: removeEventListeners,\n    each: each,\n    merge: merge,\n    extend: extend,\n    assign: assign,\n    inherit: inherit,\n    bindFn: bindFn,\n    prefixed: prefixed\n});\n\n// this prevents errors when Hammer is loaded in the presence of an AMD\n//  style loader but by script tag, not by the loader.\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\nfreeGlobal.Hammer = Hammer;\n\nif (typeof define === 'function' && define.amd) {\n    define(function() {\n        return Hammer;\n    });\n} else if (typeof module != 'undefined' && module.exports) {\n    module.exports = Hammer;\n} else {\n    window[exportName] = Hammer;\n}\n\n})(window, document, 'Hammer');\n","import { Interpolater } from \"./mod/Interpolater.js\";\nimport { MapView } from \"./MapView.js\";\nimport { RasterProj } from './RasterProj.js';\nimport { Handlers } from './Handlers.js';\nimport 'hammerjs';\n\nlet Main = function () {\n  let mapbox_access_token = import.meta.env.VITE_MAPBOX_KEY;\n  let google_access_token = import.meta.env.VITE_GOOGLE_KEY;\n  this.interpolateTimeSpan = 1e3;\n  this.gl = null;\n  this.canvas = null;\n  this.mapView = null;\n  this.requestId = null;\n  this.prevTime = null;\n  this.prevScale = null;\n  this.viewStatus = {\n    drag: false,\n    dragPrevPos: null, // canvas x y from upper left corner\n    pinchPrevScale: null,\n    zoomScale: 3e+2, // zoomMin >= zoomScale >= zoomMax\n    targetLambdaPhi: null,\n    interpolater: null,\n    currTileLevel: null,\n  };\n  this.layerSelect = document.querySelector('#layer');\n  this.selectedLayer = this.layerSelect.value;\n  this.googleSessions = [];\n\n  var locations = [ // lat, log * 0.0174533\n    [-1.29174307860817, 0.7104078658215001], // Fraunces Tavern NYC -74.0113949 40.703355\n    [-1.34406026074966, 0.6787546684457174], // DC capitol -77.009003 38.889931\n    [-1.24019010226, 0.73929973401], // Beantown  -71.0576282 42.3587364\n    [-1.40412724747, 0.43790456061],   // Key Largo -80.4505307 25.0900724\n    [-0.00142463433, 0.89850833693], // London  -0.0816255 51.4807135\n    [0.0, 0.0], // null island \n    [-0.785017, 1.15794], //greenland white\n    [-2.066469, 0.591122], //venice beach la ca -118.4754411 33.9862641\n    [-1.4407952048317003, 0.6212504054863001], // hub of universe\n  ];\n  // Center of map: lam0 longitude, phi0 latitude in radians -82.551449,35.595011\n  var locat = 0;\n  [this.viewStatus.lam0, this.viewStatus.phi0] = locations[locat];\n\n  this.zoomMin = 10.0;\n  this.zoomMax = 3e+6;\n  this.maxTileLevel = 22; // tile levels 0 to maxTileLevel\n  this.ringRadius = 0.000001; // radius of flat center disk in radians // 0.00001\n\n  this.rasterProj = null;\n  this.debug = false; // \"local\", \"red\", false\n  this.animationFramesInit = 80; // number of frames to animate before stopping\n  this.animationFrames = this.animationFramesInit;\n\n  document.addEventListener('DOMContentLoaded', async () => {\n    this.getQueryParams(); // check for url params\n    this.canvas = document.querySelector('#webglCanvas');\n    this.resizeCanvas(this.canvas);\n\n    this.rasterProj = new RasterProj();\n    this.rasterProj.setScale(this.viewStatus.zoomScale);\n    await this.startup(this.rasterProj); // sets up this.canvas, webgl, and hammer, and calls init\n    this.animation(); // starts animation\n  });\n\n  window.addEventListener('resize', () => {\n    this.resizeCanvas(this.canvas);\n    this.mapView.resizeCanvas(this.canvas);\n    this.rasterProj.clear(this.canvas);\n  });\n\n  this.animation = () => {\n    if (!this.mapView) return;\n    let getNewTiles = false;\n    let currTime = new Date().getTime();\n    this.setTileLevel();\n\n    let currPos;\n    if (this.viewStatus.interpolater != null) { // Interpolater is running\n      currPos = this.viewStatus.interpolater.getPos(currTime);\n      this.mapView.setProjCenter(currPos.lp.lambda, currPos.lp.phi);\n      if (this.viewStatus.interpolater.isFinished()) { // Interpolater finished\n        this.viewStatus.interpolater = null;\n        getNewTiles = true;\n      };\n    } else if (this.viewStatus.targetLambdaPhi != null) { // new lambda phi requested, start up interpolater\n      let currLambdaPhi = this.mapView.getProjCenter();\n      let targLambdaPhi = this.viewStatus.targetLambdaPhi;\n      this.viewStatus.interpolater = Interpolater.create(\n        currLambdaPhi,\n        targLambdaPhi,\n        [0, 0],\n        [0, 0],\n        this.interpolateTimeSpan\n      );\n      this.viewStatus.targetLambdaPhi = null;\n    }\n    // zoom in/out\n    if (this.prevScale != this.viewStatus.zoomScale) {\n      this.rasterProj.setScale(this.viewStatus.zoomScale);\n      this.rasterProj.setFlatRatio(this.ringRadius);\n      this.prevScale = this.viewStatus.zoomScale;\n      getNewTiles = true;\n    }\n    this.mapView.render(getNewTiles);\n    this.animationFrames--;\n    // console.log(\"Animation frames left: \" + this.animationFrames);\n    if (this.animationFrames > 0) {\n      this.requestId = requestAnimationFrame(this.animation);\n    } else {\n      // console.log(\"Animation finished.\");\n      this.animationFrames = this.animationFramesInit; // reset for next time\n      this.mapView.render(true);\n      this.setQueryParams();\n    }\n  };\n\n  this.startup = async (rasterProj) => {\n    this.gl = this.canvas.getContext(\"webgl2\");\n    if (!this.gl) {\n      return void alert(\"Failed to setup WebGL.\");\n    }\n\n    this.canvas.addEventListener(\"webglcontextlost\", this.handleContextLost.bind(this), false);\n    this.canvas.addEventListener(\"webglcontextrestored\", this.handleContextRestored.bind(this), false);\n    this.layerSelect.addEventListener('change', this.handleLayerChange.bind(this), false);\n\n    let mc = new Hammer.Manager(this.canvas, {\n      recognizers: [\n        [Hammer.Pinch, { enable: true, }],\n        [Hammer.Pan, { enable: true, }],\n        [Hammer.Tap, { enable: true, taps: 2, }],\n      ]\n    });\n    mc.on(\"pinch\", this.handlePinch.bind(this));\n    mc.on(\"pan\", this.handlePan.bind(this));\n    mc.on(\"panstart\", this.handlePanStart.bind(this));\n    mc.on(\"panend pancancel\", this.handlePanEnd.bind(this));\n    mc.on(\"tap\", this.handleDoubleTap.bind(this));\n\n    window.WheelEvent && document.addEventListener(\"wheel\", this.handleWheel.bind(this), false);\n\n    document.addEventListener('keydown', this.handleKeydown.bind(this));\n\n    this.googleSessions = await this.getSessions();\n    await this.init(rasterProj);\n  };\n\n  this.init = async (rasterProj) => {\n    let canvasInfo = this.canvas.getBoundingClientRect(); //read-only left, top, right, bottom, x, y, width, height properties of this.canvas\n    let canvasSize = {\n      width: canvasInfo.width,\n      height: canvasInfo.height,\n    };\n    let tile_opts = {\n      canvasSize: canvasSize,\n    };\n    let cache_opts = {\n      num: 100,\n      crossOrigin: false,\n      debug: this.debug,\n    };\n\n    rasterProj.init(this.gl);\n    this.mapView = new MapView(this.gl, rasterProj, canvasSize, tile_opts, cache_opts);\n    this.mapView.setProjCenter(this.viewStatus.lam0, this.viewStatus.phi0);\n\n    await this.setLayer();\n\n    this.setTileLevel();\n    this.mapView.requestImagesIfNecessary();\n  };\n  \n  this.resizeCanvas = (canvas) => {\n    let width = canvas.clientWidth,\n      height = canvas.clientHeight;\n    (canvas.width == width && canvas.height == height) ||\n      ((canvas.width = width), (canvas.height = height));\n    cancelAnimationFrame(this.requestId);\n    this.requestId = requestAnimationFrame(this.animation);\n    // console.log(\"Canvas resized to: \" + width + \" x \" + height);\n  };\n\n  this.setTileLevel = () => {\n    this.viewStatus.currTileLevel = Math.round(Math.log10(this.viewStatus.zoomScale) * 3.0);// Math.floor(this.maxTileLevel * this.viewStatus.zoomScale / this.zoomMax);\n    this.viewStatus.currTileLevel = Math.max(Math.min(this.viewStatus.currTileLevel, this.maxTileLevel), 0);\n    // console.log(\"TileLvl: \" + this.viewStatus.currTileLevel,\" + ZoomScl: \" + this.viewStatus.zoomScale);\n    this.mapView.setTileLevel(this.viewStatus.currTileLevel);\n  }\n\n  // Set variables from query parameters in the URL\n  // e.g. http://localhost:1234/?zoom=1000&lon=-74.0113949&lat=40.703355\n  this.getQueryParams = () => {\n    let params = new URLSearchParams(window.location.search);\n    let zoomScale = params.get(\"zoom\");\n    if (zoomScale) {\n      zoomScale = parseFloat(zoomScale);\n      if (!isNaN(zoomScale)) {\n        this.viewStatus.zoomScale = Math.min(Math.max(this.zoomMin, zoomScale), this.zoomMax);\n      }\n    }\n    let latitude = params.get(\"lat\");\n    let longitude = params.get(\"lon\");\n    if (latitude && longitude) {\n      latitude = parseFloat(latitude);\n      longitude = parseFloat(longitude);\n      if (!isNaN(latitude) && !isNaN(longitude)) {\n        this.viewStatus.lam0 = longitude * 0.0174533; //degrees to radians\n        this.viewStatus.phi0 = latitude * 0.0174533; //degrees to radians\n      }\n    }\n    let local = params.get(\"local\");\n    if (local == \"\") {\n      this.debug = \"local\";\n    }\n    let red = params.get(\"red\");\n    if (red == \"\") {\n      this.debug = \"red\";\n    }\n  };\n\n  this.getSessions = async () => { // Get Google Maps Tile API sessions for satellite, roadmap, terrain\n    const language = navigator.language || \"en-US\";\n    const locale = new Intl.Locale(language);\n    const region = locale.region || \"US\";\n    let google_body = {\n      \"language\": language,\n      \"region\": region,\n    };\n\n    google_body.layerTypes = [\"layerRoadmap\"];\n    google_body.styles = [ // only used for roadmap\n      {\n        \"featureType\": \"all\",\n        \"elementType\": \"labels.text\",\n        \"stylers\": [ { \"visibility\": \"off\" } ]\n      },\n      {\n        \"featureType\": \"road\",\n        \"elementType\": \"labels.text\",\n        \"stylers\": [ { \"visibility\": \"on\" } ]\n      }\n    ];\n    let mapTypes = [\"satellite\", \"roadmap\"/*, \"terrain\"*/];\n    let sessionKeys = [];\n    for (let type of mapTypes) {\n      google_body.mapType = type;\n      // fetch session for each type\n      const google_api_session = await fetch(`https://tile.googleapis.com/v1/createSession?key=${google_access_token}`, {\n        method: \"POST\",\n        body: JSON.stringify(google_body),\n        headers: {\n          \"Content-Type\": \"application/json\",\n        }\n      })\n        .then(response => response.text())\n        .catch(error => {\n          console.error('Error fetching Google Maps Tile Session:', error);\n        });\n      const google_api_session_json = JSON.parse(google_api_session);\n      sessionKeys.push(google_api_session_json.session);\n    };\n    return (sessionKeys);\n  };\n\n  this.setLayer = async () => { // which map layer to use\n    let sessionKey = null;\n    let layerSelect = document.querySelector('.attribution');\n    if (this.selectedLayer === \"mapbox_satellite\") {\n      layerSelect.innerHTML = `<span style=\"max-width: 50%\">© <a href=\"https://www.mapbox.com/about/maps\">Mapbox</a> \n        © <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>\n        © <a href=\"https://www.maxar.com/\">Maxar</a><br>\n        <strong><a href=\"https://apps.mapbox.com/feedback/\" target=\"_blank\">Improve this map</a></strong></span>`;\n      this.mapView.setCityFontColor(\"white\");\n      this.mapView.getURL = function (z, x, y) { //Add custom function to MapView\n        return `https://api.mapbox.com/v4/mapbox.satellite/${z}/${x}/${y}.png?access_token=${mapbox_access_token}`;\n      }\n    } else if (this.selectedLayer.slice(0, 6) === \"google\") {\n      layerSelect.innerHTML = `Map data @2025 Google`;\n      if (this.selectedLayer === \"google_satellite\") {\n        this.mapView.setCityFontColor(\"white\");\n        sessionKey = this.googleSessions[0];\n      } else if (this.selectedLayer === \"google_roadmap\") {\n        this.mapView.setCityFontColor(\"black\");\n        sessionKey = this.googleSessions[1];\n      }\n\n      this.mapView.getURL = function (z, x, y) { //Add custom function to MapView\n        return `https://tile.googleapis.com/v1/2dtiles/${z}/${x}/${y}?session=${sessionKey}&key=${google_access_token}`;\n      }\n    }\n  };\n\n  this.setQueryParams = () => {\n    let params = new URLSearchParams(window.location.search);\n    params.set(\"zoom\", this.viewStatus.zoomScale.toFixed(2)); // zoomScale\n    params.set(\"lon\", (this.viewStatus.lam0 * 180 / Math.PI).toFixed(4)); // radians to degrees\n    params.set(\"lat\", (this.viewStatus.phi0 * 180 / Math.PI).toFixed(4)); // radians to degrees\n    window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);\n  }\n\n  // Assign handler methods to this instance\n  Object.assign(this, Handlers);\n};\n\nnew Main();\n\nexport { Main };\n"],"names":["ProjMath","x","min","max","yRange","xRange","xmin","xmax","ymin","ymax","t1","t2","vec3d","r","lam","phi","pt1","pt2","lam1","lam2","MapMathUtils","a","b","c","d","lambda","cosphi","from3dVec","to3dVec","intrpRatio","e","f","g","h","Interpolater","currLP","targLP","iniViewPos","finViewPos","timeSpan","currTime","tm","deltaTime","currVec3d","currViewPos","TileManager","tile_opts","showCities","canvasSize","lam0","phi0","level","sinPhi0","pixelX","pixelY","tileX","tileY","quadkey","i","digit","mask","quadkeyToTileXY","y","z","tile","baseX","baseY","baseWidth","baseHeight","tileWidth","tileHeight","x1","y2","x2","y1","tileList","N","NE","E","SE","S","SW","W","NW","tiles","maxZ","currTile","tileInfos","NSWEtiles","quadrant","levelOneTiles","currTileLevel","getUrl","prevTile","currTileQuadkey","nextAdjacentTiles","LRUCache","capacity","key","val","value","ImageCache","cache_opts","url","info","promise","resolve","reject","image","cache","debug","redImage","tex","canvas","ctx","blob","MapView","gl","imgProj","self","img","color","canvX","canvY","scaleX_","scaleY_","viewPos","getNewTiles","centerQuadkey","api_key","params","response","data","error","cityList","projection","rect","city","worddiv","children","placedRects","padding","child","cRect","w","candidate","tileArray","count","targetTextures","texCoords","ShaderProgram","vertShaderStr","fragShaderStr","vertexShader","fragmentShader","prog","type","shaderSrc","shader","numberOfItems","viewRect","alpha","lineColor","zoomScale","ringRadius","flatRatio","offset","texture","region","phi1","phi2","Projection","opt_divn","rho","theta","fisheyeR","wm","sin_phi","cos_phi","sin_lam","cos_lam","sin_c","k","rh2","c_rh","cos_c","sinPhi","RasterProj","textureInfos","Handlers","event","canv_xy","left","top","deltaPanRate","deltaX","deltaY","curr_lam_phi","newLam0","newPhi0","lam_phi","window","document","exportName","undefined","VENDOR_PREFIXES","TEST_ELEMENT","TYPE_FUNCTION","round","abs","now","setTimeoutContext","fn","timeout","context","bindFn","invokeArrayArg","arg","each","obj","iterator","deprecate","method","name","message","deprecationMessage","stack","log","assign","target","output","index","source","nextKey","extend","dest","src","merge","keys","inherit","base","properties","baseP","childP","boolOrFn","args","ifUndefined","val1","val2","addEventListeners","types","handler","splitStr","removeEventListeners","hasParent","node","parent","inStr","str","find","inArray","findByKey","toArray","uniqueArray","sort","results","values","prefixed","property","prefix","prop","camelProp","_uniqueId","uniqueId","getWindowForElement","element","doc","MOBILE_REGEX","SUPPORT_TOUCH","SUPPORT_POINTER_EVENTS","SUPPORT_ONLY_TOUCH","INPUT_TYPE_TOUCH","INPUT_TYPE_PEN","INPUT_TYPE_MOUSE","INPUT_TYPE_KINECT","COMPUTE_INTERVAL","INPUT_START","INPUT_MOVE","INPUT_END","INPUT_CANCEL","DIRECTION_NONE","DIRECTION_LEFT","DIRECTION_RIGHT","DIRECTION_UP","DIRECTION_DOWN","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","DIRECTION_ALL","PROPS_XY","PROPS_CLIENT_XY","Input","manager","callback","ev","createInputInstance","Type","inputClass","PointerEventInput","TouchInput","TouchMouseInput","MouseInput","inputHandler","eventType","input","pointersLen","changedPointersLen","isFirst","isFinal","computeInputData","session","pointers","pointersLength","simpleCloneInputData","firstInput","firstMultiple","offsetCenter","center","getCenter","getAngle","getDistance","computeDeltaXY","getDirection","overallVelocity","getVelocity","getScale","getRotation","computeIntervalInputData","prevDelta","prevInput","last","velocity","velocityX","velocityY","direction","v","p1","p2","props","start","end","MOUSE_INPUT_MAP","MOUSE_ELEMENT_EVENTS","MOUSE_WINDOW_EVENTS","POINTER_INPUT_MAP","IE10_POINTER_TYPE_ENUM","POINTER_ELEMENT_EVENTS","POINTER_WINDOW_EVENTS","store","removePointer","eventTypeNormalized","pointerType","isTouch","storeIndex","SINGLE_TOUCH_INPUT_MAP","SINGLE_TOUCH_TARGET_EVENTS","SINGLE_TOUCH_WINDOW_EVENTS","SingleTouchInput","touches","normalizeSingleTouches","all","changed","TOUCH_INPUT_MAP","TOUCH_TARGET_EVENTS","getTouches","allTouches","targetIds","targetTouches","changedTouches","changedTargetTouches","touch","DEDUP_TIMEOUT","DEDUP_DISTANCE","inputEvent","inputData","isMouse","recordTouches","isSyntheticEvent","eventData","setLastTouch","lastTouch","lts","removeLastTouch","t","dx","dy","PREFIXED_TOUCH_ACTION","NATIVE_TOUCH_ACTION","TOUCH_ACTION_COMPUTE","TOUCH_ACTION_AUTO","TOUCH_ACTION_MANIPULATION","TOUCH_ACTION_NONE","TOUCH_ACTION_PAN_X","TOUCH_ACTION_PAN_Y","TOUCH_ACTION_MAP","getTouchActionProps","TouchAction","actions","recognizer","cleanTouchActions","srcEvent","hasNone","hasPanY","hasPanX","isTapPointer","isTapMovement","isTapTouchTime","touchMap","cssSupports","STATE_POSSIBLE","STATE_BEGAN","STATE_CHANGED","STATE_ENDED","STATE_RECOGNIZED","STATE_CANCELLED","STATE_FAILED","Recognizer","options","otherRecognizer","simultaneous","getRecognizerByNameIfManager","requireFail","state","emit","stateStr","inputDataClone","directionStr","AttrRecognizer","optionPointers","isRecognized","isValid","PanRecognizer","hasMoved","distance","PinchRecognizer","inOut","PressRecognizer","validPointers","validMovement","validTime","RotateRecognizer","SwipeRecognizer","TapRecognizer","validTouchTime","validInterval","validMultiTap","tapCount","Hammer","Manager","STOP","FORCED_STOP","toggleCssProps","item","force","recognizers","curRecognizer","existing","events","handlers","triggerDomEvent","add","gestureEvent","freeGlobal","module","Main","mapbox_access_token","google_access_token","locations","locat","currPos","currLambdaPhi","targLambdaPhi","rasterProj","mc","canvasInfo","width","height","latitude","longitude","language","google_body","mapTypes","sessionKeys","google_api_session","google_api_session_json","sessionKey","layerSelect"],"mappings":"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","x_google_ignoreList":[9]}