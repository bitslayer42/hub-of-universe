(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const u of h.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(r){if(r.ep)return;r.ep=!0;const h=o(r);fetch(r.href,h)}})();const dt={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),info:console.info.bind(console),debug:console.debug.bind(console)},ut=[];let ft=null;const si=100,ni=50;function mt(i,n){const o=[],l=[],r=n.map(h=>{if(h===void 0)return"undefined";if(typeof h=="string")return h;if(h instanceof Error||typeof h.stack=="string"){let u=h.toString();if(h.stack){let f=h.stack.toString();f.startsWith(u)&&(f=f.slice(u.length).trimStart()),f&&o.push(f)}return u}if(typeof h=="object"&&h!==null){try{l.push(JSON.parse(JSON.stringify(h)))}catch{l.push(String(h))}return"[extra#"+l.length+"]"}return String(h)}).join(" ");return{level:i,message:r,timestamp:new Date,url:window.location.href,userAgent:navigator.userAgent,stacks:o,extra:l}}async function ri(i){try{await fetch("/api/debug/client-logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:i})})}catch{}}function Nt(){if(ut.length===0)return;const i=[...ut];ut.length=0,ri(i),ft&&(clearTimeout(ft),ft=null)}function gt(i){if(ut.push(i),ut.length>=ni){Nt();return}ft||(ft=setTimeout(Nt,si))}console.log=function(...i){dt.log(...i);const n=mt("log",i);gt(n)};console.warn=function(...i){dt.warn(...i);const n=mt("warn",i);gt(n)};console.error=function(...i){dt.error(...i);const n=mt("error",i);gt(n)};console.info=function(...i){dt.info(...i);const n=mt("info",i);gt(n)};console.debug=function(...i){dt.debug(...i);const n=mt("debug",i);gt(n)};window.addEventListener("beforeunload",Nt);setInterval(Nt,1e4);let T=function(){};T.EPSILON=1e-7;T.SQRT_2=Math.sqrt(2);T.PI_SQ=Math.PI*Math.PI;T.HALF_PI=Math.PI/2;T.clamp=function(i,n,o){return Math.max(n,Math.min(o,i))};T.atan2Range=function(i,n){console.assert(i.min<=i.max),console.assert(n.min<=n.max);let o=n.min,l=n.max,r=i.min,h=i.max;if(0<=r)return 0<o?{min:Math.atan2(r,l),max:Math.atan2(h,o)}:l<0?{min:Math.atan2(h,l),max:Math.atan2(r,o)}:{min:Math.atan2(r,l),max:Math.atan2(r,o)};if(h<0)return 0<o?{min:Math.atan2(r,o),max:Math.atan2(h,l)}:l<0?{min:Math.atan2(h,o),max:Math.atan2(r,l)}:{min:Math.atan2(h,o),max:Math.atan2(h,l)};if(0<o)return{min:Math.atan2(r,o),max:Math.atan2(h,o)};if(l<0){let u=Math.atan2(h,l),f=Math.atan2(r,l);return Math.PI<=u?{min:u-2*Math.PI,max:f}:{min:u,max:f+2*Math.PI}}return{min:-Math.PI,max:Math.PI}};T.toLambdaPhi=function(i){let n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),o=Math.atan2(i[1],i[0]),l=Math.atan2(i[2],n);return{lambda:o,phi:l}};T.normalizeLambda=function(i){return-Math.PI<=i&&i<Math.PI?i:i-2*Math.PI*Math.floor((i+Math.PI)/(2*Math.PI))};T.neighborPoint=function(i,n){if(T.EPSILON<=Math.abs(i.phi-n.phi))return!1;let o=T.normalizeLambda(i.lambda),l=T.normalizeLambda(n.lambda);return Math.abs(o-l)<T.EPSILON};T.sphericalDistance=function(i,n){return Math.acos(Math.sin(i.phi)*Math.sin(n.phi)+Math.cos(i.phi)*Math.cos(n.phi)*Math.cos(T.normalizeLambda(n.lambda-i.lambda)))};let Q=function(){};Q.smoothstep=function(i,n,o){let l=T.clamp((o-i)/(n-i),0,1);return l*l*(3-2*l)};Q.smootherstep=function(i,n,o){let l=T.clamp((o-i)/(n-i),0,1);return l*l*l*(l*(6*l-15)+10)};Q.toUnitVector3d=function(i,n){let o=Math.cos(n);return[Math.cos(i)*o,Math.sin(i)*o,Math.sin(n)]};Q.slerp=function(i,n,o){let l=T.clamp(i[0]*n[0]+i[1]*n[1]+i[2]*n[2],-1,1);if(1-T.EPSILON<l)return[(i[0]+n[0])/2,(i[1]+n[1])/2,(i[2]+n[2])/2];l<-(1-T.EPSILON);let r=Math.acos(l),h=Math.sin(r),u=Math.sin((1-o)*r)/h,f=Math.sin(o*r)/h;return[u*i[0]+f*n[0],u*i[1]+f*n[1],u*i[2]+f*n[2]]};let pt=function(i,n,o,l,r){this.v1=Q.toUnitVector3d(i.lambda,i.phi),this.v2=Q.toUnitVector3d(n.lambda,n.phi),this.iniViewPos=o,this.finViewPos=l,this.timeSpan=r,this.startTime=null,this.finished=!1};pt.create=function(i,n,o,l,r){return T.neighborPoint(i,n)?null:(Math.PI-T.EPSILON<Math.abs(n.phi-i.phi)&&(i={lambda:i.lambda,phi:i.phi+1e-4*(0<i.phi?-1:1)}),new pt(i,n,o,l,r))};pt.prototype.getPos=function(i){let n=0;if(this.startTime==null)this.startTime=i;else{let u=i-this.startTime;n=T.clamp(u/this.timeSpan,0,1),this.startTime+this.timeSpan<i&&(this.finished=!0)}let o=Q.smootherstep(0,1,n),l=Q.slerp(this.v1,this.v2,o),r=T.toLambdaPhi(l),h=[this.iniViewPos[0]*(1-o)+this.finViewPos[0]*o,this.iniViewPos[1]*(1-o)+this.finViewPos[1]*o];return{lp:r,viewPos:h}};pt.prototype.isFinished=function(){return this.finished};let k=function(i,n){this.showCities=n,this.tileSize=256,this.centerQuadkey=null};k.prototype.resizeCanvas=function(i){};k.prototype.getCenterTileInfo=function(i,n,o){let l=Math.sin(n),r=(i+Math.PI)/(2*Math.PI)*this.tileSize*Math.pow(2,o),h=(.5-Math.log((1+l)/(1-l))/(4*Math.PI))*this.tileSize*Math.pow(2,o),u=Math.floor(r/this.tileSize),f=Math.floor(h/this.tileSize);this.centerQuadkey=this.tileXYToQuadkey(u,f,o)};k.prototype.tileXYToQuadkey=function(i,n,o){let l="";for(let r=o;r>0;r--){let h=0;const u=1<<r-1;(i&u)!==0&&(h|=1),(n&u)!==0&&(h|=2),l+=h.toString()}return l};function ai(i){let n=0,o=0;const l=i.length;for(let r=l;r>0;r--){const h=1<<r-1,u=parseInt(i.charAt(l-r));u&1&&(n|=h),u&2&&(o|=h)}return{x:n,y:o,z:l}}k.prototype.getRectFromXYZ=function(i){let n=-Math.PI,o=Math.PI/2,l=Math.PI*2,r=Math.PI,h=l/Math.pow(2,i.xyz.z),u=r/Math.pow(2,i.xyz.z),f=n+i.xyz.x*h,m=o-i.xyz.y*u,d=n+(i.xyz.x+1)*h,y=o-(i.xyz.y+1)*u;return[f,y,d,m]};k.prototype.getNSWEtiles=function(i,n=[N,S,W,E,NE,NW,SE,SW]){let o=0,l=1,r=2,h=3,u=4,f=5,m=6,d=7,y=[],{x:g,y:_,z:P}=i.xyz,A=Math.pow(2,P)-1;return n.length===0||(n.includes(o)&&_>0&&y.push({xyz:{x:g,y:_-1,z:P}}),n.includes(u)&&_<A&&y.push({xyz:{x:g,y:_+1,z:P}}),n.includes(m)&&y.push({xyz:{x:g==0?A:g-1,y:_,z:P}}),n.includes(r)&&y.push({xyz:{x:g==A?0:g+1,y:_,z:P}}),n.includes(l)&&_>0&&y.push({xyz:{x:g==A?0:g+1,y:_-1,z:P}}),n.includes(d)&&_>0&&y.push({xyz:{x:g==0?A:g-1,y:_-1,z:P}}),n.includes(h)&&_<A&&y.push({xyz:{x:g==A?0:g+1,y:_+1,z:P}}),n.includes(f)&&_<A&&y.push({xyz:{x:g==0?A:g-1,y:_+1,z:P}})),y};k.prototype.getAdjacentTiles=function(i){let n=[],o=[],l=0,r=1,h=2,u=3,f=4,m=5,d=6,y=7,g=i.quadkey.slice(-1);return g==="0"?o=this.getNSWEtiles(i,[l,d,y]):g==="1"?o=this.getNSWEtiles(i,[l,h,r]):g==="2"?o=this.getNSWEtiles(i,[f,d,m]):g==="3"&&(o=this.getNSWEtiles(i,[f,h,u])),n.push(...o),n};k.prototype.pushLevelOneTiles=function(i){let n=[{xyz:{x:0,y:0,z:1},quadkey:"0"},{xyz:{x:1,y:0,z:1},quadkey:"1"},{xyz:{x:0,y:1,z:1},quadkey:"2"},{xyz:{x:1,y:1,z:1},quadkey:"3"}];i.push(...n)};k.prototype.getTileInfos=function(i,n,o,l){let r=[],h=null;this.getCenterTileInfo(i,n,o),this.showCities(this.centerQuadkey);for(let u=o;u>=2;u--){let f;h?f=h.quadkey.slice(0,-1):f=this.centerQuadkey;let d={xyz:ai(f),quadkey:f};r.push(d);let y=this.getAdjacentTiles(d);r.push(...y),h=d}this.pushLevelOneTiles(r);for(const u of r)u.rect=this.getRectFromXYZ(u),u.url=l(u.xyz.z,u.xyz.x,u.xyz.y);return r.reverse()};class ye{constructor(n){this.cache=new Map,this.capacity=n}get(n){if(!this.cache.has(n))return!1;let o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.delete(n),this.cache.size===this.capacity?(this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)):this.cache.set(n,o)}}let vt=function(i){this.num=32,this.crossOrigin=null,this.loading={},this.ongoingImageLoads=[],this.debug=!1,typeof i<"u"&&("num"in i&&(this.num=i.num),"crossOrigin"in i&&(this.crossOrigin=i.crossOrigin),"debug"in i&&(this.debug=i.debug)),this.createTexture=null,this.textures=new ye(this.num)};vt.prototype.loadImage_=function(i,n){const{promise:o,resolve:l,reject:r}=Promise.withResolvers();this.loading[i]=!0;let h=new Image;this.crossOrigin!=null&&(h.crossOrigin=this.crossOrigin);let u=this,f=this.debug,m;h.onload=async function(){if(u.ongoingImageLoads.splice(u.ongoingImageLoads.indexOf(h),1),u.createTexture==null)return;let d=u.createTexture(h);if(d&&u.textures.put(i,[d,n]),delete u.loading.url,f=="red"){let y=new OffscreenCanvas(256,256),g=y.getContext("2d");g.drawImage(h,0,0),g.strokeStyle="red",g.lineWidth=5,g.strokeRect(0,0,h.width,h.height);const _=await y.convertToBlob({type:"image/png"});m=new Image,m.src=URL.createObjectURL(_),l(m)}},f=="red"&&o.then(d=>{h.src=d.src}),this.ongoingImageLoads.push(h),f=="local"?h.src=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAACVBMVEX/AAAAAADAwMALHWY1AAAAqUlEQVR4nO3QwQnDABADQX/Sl5vwIwWkJdfrIiQwEXPcWzB7HK/f54ruLAzc31/wjYGBBggICAgIxYG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARAQEBASEIiEeiBsMRERAQEBAKBLigbjBQEQEBAQEhCIhHogbDEREQEBAQCgS4oG4wUBEBAQEBIQiIR6IGwxEREBAQEAoEuKBuMFARASEDcL/3wP26M0z+9z7bgAAAABJRU5ErkJggg==",import.meta.url):h.src=i};vt.prototype.loadImageIfAbsent=function(i,n){return this.textures.get(i)||i in this.loading?!1:(this.loadImage_(i,n),!0)};vt.prototype.getTexture=function(i){return this.textures.get(i)};vt.prototype.clearOngoingImageLoads=function(){for(let i=0;i<this.ongoingImageLoads.length;i++)this.ongoingImageLoads[i].onload=void 0;this.ongoingImageLoads=[]};let w=function(i,n,o,l,r){this.gl=i,this.rasterProj=n,this.canvasSize=o,this.tileManager=new k(l,this.showCities.bind(this)),this.prevTileInfos_=null,this.prevWindow_=null,this.imageCache=new vt(r);let h=this;this.imageCache.createTexture=function(u){return h.createTexture(u)},this.tileInfos=null,this.getURL=null,this.calculateLevel=null,this.currTileLevel=0,this.lam0=0,this.phi0=0,this.cityList=[],this.cityDiv=document.getElementById("citydiv"),this.cityCache=new ye(1e3),this.cityFontColor="black"};w.prototype.clearTileInfoCache_=function(){this.prevWindow_=null,this.prevTileInfos_=null};w.prototype.setProjCenter=function(i,n){this.lam0=i,this.phi0=n,this.clearTileInfoCache_(),this.rasterProj.setProjCenter(i,n)};w.prototype.getProjCenter=function(){return this.rasterProj.projection.getProjCenter()};w.prototype.resizeCanvas=function(i){this.canvasSize.width=i.width,this.canvasSize.height=i.height,this.tileManager.resizeCanvas(this.canvasSize)};w.prototype.setTileLevel=function(i){this.currTileLevel=i};w.prototype.setCityFontColor=function(i){this.cityFontColor=i};w.prototype.getViewPointFromWindow=function(i,n){let o=Math.PI*2/this.canvasSize.width,l=Math.PI*2/-this.canvasSize.height,r=-Math.PI+i*o,h=-Math.PI+(n-this.canvasSize.height)*l;return[r,h]};w.prototype.getLambdaPhiPointFromWindow=function(i,n){let o=this.getViewPointFromWindow(i,n);return this.rasterProj.projection.inverse(o[0],o[1])};w.prototype.resetImages=function(){this.imageCache.clearOngoingImageLoads()};w.prototype.requestImagesIfNecessary=function(){return this.getURL==null?-1:(this.getTileInfos_(),this.requestImages_(this.tileInfos))};w.prototype.render=function(i){this.getURL!=null&&(i&&(this.getTileInfos_(),this.requestImages_(this.tileInfos)),this.render_(this.tileInfos))};w.prototype.createTexture=function(i){let n=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this.gl.bindTexture(this.gl.TEXTURE_2D,null),n};w.prototype.showCities=async function(i){if(this.cityList=this.cityCache.get(i),this.cityList){this.placeCities_(this.cityList,this.rasterProj.projection);return}this.requestCities_(i)};w.prototype.requestCities_=function(i){let n="5ca4d8ad6ae4f1a1c44cdbdf40dcc987";const o=new URLSearchParams;o.append("quadkey",i),o.append("apikey",n),fetch(`https://api.hubofuniverse.com/cities?${o}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(l=>l.json()).then(l=>{this.cityList=l||[],this.cityCache.put(i,this.cityList),this.placeCities_(this.cityList,this.rasterProj.projection)}).catch(l=>{console.error("Error fetching cities:",l),this.cityList=[]})};w.prototype.placeCities_=function(i,n){this.cityDiv.innerHTML="";const o=this.cityDiv.getBoundingClientRect();this.cityList=i||[];for(let u of this.cityList){let{x:f,y:m}=n.forward(u.longitude*Math.PI/180,u.latitude*Math.PI/180);f=(f/(2*Math.PI)+.5)*o.width,m=(-m/(2*Math.PI)+.5)*o.height;const d=document.createElement("div");d.classList.add("word"),d.classList.add(this.cityFontColor),d.style.left=`${f}px`,d.style.top=`${m}px`,d.textContent=u.name,this.cityDiv.appendChild(d)}const l=Array.from(this.cityDiv.children),r=[],h=0;l.forEach(u=>{const f=u.getBoundingClientRect(),m=parseInt(u.style.left),d=parseInt(u.style.top),y=parseInt(f.width),g=parseInt(f.height),_={left:m-y/2-h,top:d-g/2-h,right:m+y/2+h,bottom:d+g/2+h};r.some(A=>!(_.right<A.left||_.left>A.right||_.bottom<A.top||_.top>A.bottom))?u.style.display="none":r.push({name:u.textContent,left:_.left,top:_.top,right:_.right,bottom:_.bottom})})};w.prototype.getTileInfos_=function(){let i=this.tileManager.getTileInfos(this.lam0,this.phi0,this.currTileLevel,this.getURL);this.tileInfos=i};w.prototype.requestImages_=function(){let i=0;for(let n=0;n<this.tileInfos.length;++n)this.imageCache.loadImageIfAbsent(this.tileInfos[n].url,this.tileInfos[n].rect)&&++i;return i};w.prototype.render_=function(){this.rasterProj.clear(this.canvasSize);let i=[];for(let o=0;o<this.tileInfos.length;++o){let l=this.tileInfos[o],r=this.imageCache.getTexture(l.url);r&&i.push(r)}let n=new Float32Array([0,0,0,1,1,0,1,1]);this.rasterProj.prepareRender(n,[-Math.PI,-Math.PI,Math.PI,Math.PI]),0<i.length&&this.rasterProj.renderTextures(i),this.placeCities_(this.cityList,this.rasterProj.projection)};let x=function(i){this.gl_=i,this.vbo_=null,this.program_=null,this.locTexture_=null,this.locAlpha_=null,this.locProjCenter_=null,this.locViewXY1_=null,this.locViewXY2_=null,this.locDataCoord1_=null,this.locDataCoord2_=null,this.locFixedTextureSize_=null,this.locRenderColor_=null,this.locRenderType_=null,this.locUnifScale_=null,this.locRingRadius_=null,this.locFlatRatio_=null,this.locTranslateY_=null};x.DIMENSION=2;x.UNIT_RECT_TRIANGLE_STRIP=new Float32Array([-1,-1,-1,1,1,-1,1,1]);x.RENDER_TYPE_TEXTURE=0;x.RENDER_TYPE_POINT_TEXTURE=1;x.RENDER_TYPE_POLYLINE=2;x.prototype.init=function(i,n){let o=this.loadShader_(this.gl_.VERTEX_SHADER,i),l=this.loadShader_(this.gl_.FRAGMENT_SHADER,n),r=this.gl_.createProgram();if(this.gl_.attachShader(r,o),this.gl_.attachShader(r,l),this.gl_.bindAttribLocation(r,0,"aPosition"),this.gl_.bindAttribLocation(r,1,"aTexCoord"),this.gl_.linkProgram(r),!this.gl_.getProgramParameter(r,this.gl_.LINK_STATUS)&&!this.gl_.isContextLost()){let u=this.gl_.getProgramInfoLog(r);return alert(`Error linking program:
`+u),this.gl_.deleteProgram(r),!1}return this.program_=r,this.locTexture_=this.gl_.getUniformLocation(this.program_,"uTexture"),this.locAlpha_=this.gl_.getUniformLocation(this.program_,"uAlpha"),this.locProjCenter_=this.gl_.getUniformLocation(this.program_,"uProjCenter"),this.locViewXY1_=this.gl_.getUniformLocation(this.program_,"uViewXY1"),this.locViewXY2_=this.gl_.getUniformLocation(this.program_,"uViewXY2"),this.locDataCoord1_=this.gl_.getUniformLocation(this.program_,"uDataCoord1"),this.locDataCoord2_=this.gl_.getUniformLocation(this.program_,"uDataCoord2"),this.locFixedTextureSize_=this.gl_.getUniformLocation(this.program_,"uFixedTextureSize"),this.locRenderColor_=this.gl_.getUniformLocation(this.program_,"uRenderColor"),this.locRenderType_=this.gl_.getUniformLocation(this.program_,"uRenderType"),this.locUnifScale_=this.gl_.getUniformLocation(this.program_,"uScale"),this.locRingRadius_=this.gl_.getUniformLocation(this.program_,"uRingRadius"),this.locFlatRatio_=this.gl_.getUniformLocation(this.program_,"uFlatRatio"),this.gl_.blendFunc(this.gl_.SRC_ALPHA,this.gl_.ONE_MINUS_SRC_ALPHA),!0};x.prototype.initAdditionalParams=function(){this.locTranslateY_=this.gl_.getUniformLocation(this.program_,"uTranslateY")};x.prototype.loadShader_=function(i,n){let o=this.gl_.createShader(i);if(this.gl_.shaderSource(o,n),this.gl_.compileShader(o),!this.gl_.getShaderParameter(o,this.gl_.COMPILE_STATUS)&&!this.gl_.isContextLost()){let l=this.gl_.getShaderInfoLog(o);return alert(`Error compiling shader:
`+l),this.gl_.deleteShader(o),null}return o};x.prototype.setClearColor=function(i){this.gl_.clearColor(i.r,i.g,i.b,i.a),this.gl_.enable(this.gl_.BLEND)};x.prototype.clear=function(i){this.gl_.clear(this.gl_.COLOR_BUFFER_BIT),this.gl_.viewport(0,0,i.width,i.height)};x.prototype.initVBO=function(i){this.vbo_=this.gl_.createBuffer(),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.vbo_),this.gl_.bufferData(this.gl_.ARRAY_BUFFER,i*4*2,this.gl_.DYNAMIC_DRAW)};x.prototype.setRenderType=function(i){this.gl_.uniform1i(this.locRenderType_,i)};x.prototype.prepareRender=function(i,n,o,l,r,h,u,f,m){this.gl_.useProgram(this.program_),this.gl_.uniform1f(this.locAlpha_,r),this.gl_.uniform4f(this.locRenderColor_,h.r,h.g,h.b,h.a),this.gl_.uniform2f(this.locProjCenter_,o,l),this.gl_.uniform2f(this.locViewXY1_,i[0],i[1]),this.gl_.uniform2f(this.locViewXY2_,i[2],i[3]),this.gl_.uniform1i(this.locTexture_,0),this.gl_.uniform1f(this.locUnifScale_,u),this.gl_.uniform1f(this.locRingRadius_,f),this.gl_.uniform1f(this.locFlatRatio_,m),this.locTranslateY_!=null&&this.gl_.uniform1f(this.locTranslateY_,0);let d=x.UNIT_RECT_TRIANGLE_STRIP.byteLength;this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,0,x.UNIT_RECT_TRIANGLE_STRIP),this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,d,n),this.gl_.enableVertexAttribArray(0),this.gl_.vertexAttribPointer(0,x.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,0),this.gl_.enableVertexAttribArray(1),this.gl_.vertexAttribPointer(1,x.DIMENSION,this.gl_.FLOAT,this.gl_.FALSE,0,d)};x.prototype.renderTexture=function(i,n){let o=n[0],l=n[1],r=n[2],h=n[3];this.gl_.bindTexture(this.gl_.TEXTURE_2D,i),this.gl_.uniform2f(this.locDataCoord1_,o,l),this.gl_.uniform2f(this.locDataCoord2_,r,h),this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP,0,4)};let Z=function(i,n,o,l){this.lam0=i,this.phi0=n,this.divN_=typeof l<"u"?l:180,this.sin_phi0_=Math.sin(n),this.cos_phi0_=Math.cos(n),this.zoomScale=o};Z.prototype.getProjCenter=function(){return{lambda:this.lam0,phi:this.phi0}};Z.prototype.fwd_fisheye=function(i,n){[i,n]=[i/Math.PI,n/Math.PI];let o=Math.sqrt(i*i+n*n),l=Math.atan2(n,i),r=Math.log(1+this.zoomScale*o)/Math.log(1+this.zoomScale);return[Math.cos(l)*r*Math.PI,Math.sin(l)*r*Math.PI]};Z.prototype.forward=function(i,n){let o={lam:i,phi:n},l=Math.sin(o.phi),r=Math.cos(o.phi),h=Math.sin(o.lam-this.lam0),u=Math.cos(o.lam-this.lam0),f=Math.acos(this.sin_phi0_*l+this.cos_phi0_*r*u);if(Math.abs(f)<T.EPSILON)return{x:0,y:0};let m=Math.sin(f);if(Math.abs(m)<T.EPSILON)return null;let d=f/m,y=d*r*h,g=d*(this.cos_phi0_*l-this.sin_phi0_*r*u);return[y,g]=this.fwd_fisheye(y,g),{x:y,y:g}};Z.prototype.inv_fisheye=function(i,n){[i,n]=[i/Math.PI,n/Math.PI];let o=Math.sqrt(i*i+n*n),l=Math.atan2(n,i),r=(Math.exp(o*Math.log(1+this.zoomScale))-1)/this.zoomScale;return[Math.cos(l)*r*Math.PI,Math.sin(l)*r*Math.PI]};Z.prototype.inverse=function(i,n){[i,n]=this.inv_fisheye(i,n);let o=i*i+n*n;if(T.PI_SQ<o)return null;let l=Math.sqrt(o);if(l<T.EPSILON)return{lambda:this.lam0,phi:this.phi0};let r=l,h=Math.sin(r),u=Math.cos(r),f=u*this.sin_phi0_+n*h*this.cos_phi0_/l,m=Math.asin(T.clamp(f,-1,1)),d;return T.HALF_PI-T.EPSILON<this.phi0?d=Math.atan2(i,-n)+this.lam0:this.phi0<-(T.HALF_PI-T.EPSILON)?d=Math.atan2(i,n)+this.lam0:d=Math.atan2(i*h,l*u*this.cos_phi0_-n*this.sin_phi0_*h)+this.lam0,(d<-Math.PI||Math.PI<=d)&&(d-=2*Math.PI*Math.floor((d+Math.PI)/(2*Math.PI))),{lambda:d,phi:m}};Z.prototype.setScale=function(i){this.zoomScale=i};const z=function(){this.shader_=null,this.backColor_={r:0,g:0,b:0,a:1},this.graticuleColor_={r:.88,g:.88,b:.88,a:1},this.alpha_=1,this.projection=new Z(0,0,.01),this.numberOfPoints=64,this.zoomScale=.01,this.ringRadius=null,this.flatRatio=null};z.prototype.init=function(i){if(this.shader_=new x(i),!this.shader_.init(z.VERTEX_SHADER_STR,z.FRAGMENT_SHADER_STR))return!1;let o=8+this.numberOfPoints;return this.shader_.initVBO(o),this.shader_.setClearColor(this.backColor_),!0};z.prototype.setAlpha=function(i){this.alpha_=i};z.prototype.setProjCenter=function(i,n){this.projection=new Z(i,n,this.zoomScale)};z.prototype.clear=function(i){this.shader_.clear(i)};z.prototype.prepareRender=function(i,n){this.shader_.prepareRender(n,i,this.projection.lam0,this.projection.phi0,this.alpha_,this.graticuleColor_,this.zoomScale,this.ringRadius,this.flatRatio)};z.prototype.renderTextures=function(i){for(let n=0;n<i.length;++n){this.shader_.setRenderType(x.RENDER_TYPE_TEXTURE);let o=i[n][0],l=i[n][1];this.shader_.renderTexture(o,l)}};z.prototype.setScale=function(i){this.zoomScale=i,this.projection.setScale(i)};z.prototype.setFlatRatio=function(i){this.ringRadius=i;let n=this.projection.lam0,o=this.projection.phi0+i,{x:l,y:r}=this.projection.forward(n,o);this.flatRatio=r/i};z.VERTEX_SHADER_STR=`#version 300 es
  precision highp float;
  in vec2 aPosition;
  in vec2 aTexCoord;
  out vec2 vTexCoord;

  void main() {
    gl_Position = vec4(aPosition.x, aPosition.y, 1.0, 1.0);
    vTexCoord = aTexCoord;
  }
`;z.FRAGMENT_SHADER_STR=`#version 300 es

  precision highp float;
  uniform sampler2D uTexture;
  in vec2 vTexCoord;
  uniform lowp int uRenderType;
  uniform vec2 uProjCenter; // lam0, phi0
  uniform vec2 uViewXY1;    // -PI,-PI
  uniform vec2 uViewXY2;    // +PI,+PI
  uniform vec2 uDataCoord1; // lam1, phi1: top left corner of current texture: radians
  uniform vec2 uDataCoord2; // lam2, phi2: bot right corner of current texture: radians
  uniform vec2 uFixedTextureSize;    //  アイコンサイズ（画面比） Icon size (screen ratio)
  uniform vec4 uRenderColor;
  uniform float uAlpha;
  uniform float uScale;       //  スケール zoom in zoomScale
  uniform float uRingRadius;  // radius of flat center disk in radians
  uniform float uFlatRatio;   // ratio of projectedFlatRadius / flatRadius  

  // const float flatradius = 0.0001;

  // float flatratio = 0.0002; // ratio of

  const float pi = 3.14159265;
  const float blurRatio = 0.015; // planet haze
  const float xyRadius = pi;
  const float atanSinhPi = 1.48442222; // atan(sinh(pi)) = max phi for web merc
  out vec4 fragColor;

  vec2 inner_flat(vec2 center, vec2 xy) {
    // Inside the ring - draw flat
    // Convert screen coordinates to web mercator coordinates
    // Scale by uFlatRatio to match the projection scale at the ring boundary
    float xflat = (xy.x / uFlatRatio) + center.x;
    float yflat = asinh(tan((xy.y / uFlatRatio) + center.y)) * 0.5;
    return vec2(xflat, yflat);
  }

  vec2 outer_projected(vec2 center, vec2 xy_fe, float rho) {
        // Inverse of azimuthal equidistant projection
    float sinPhi0 = sin(center.y);
    float cosPhi0 = cos(center.y);
    float phi = asin( clamp( cos(rho) * sinPhi0 + xy_fe.y * sin(rho) * cosPhi0 / rho, -1.0, 1.0 ) );
    float lambda = mod( center.x + atan( xy_fe.x * sin(rho), rho * cosPhi0 * cos(rho) - xy_fe.y * sinPhi0 * sin(rho) ) + pi, 2.0 * pi ) - pi;

    // Adj phi for web mercator
    if (abs(phi) < atanSinhPi) { // not for poles
      phi = asinh(tan(phi)) * 0.5;
    }
    return vec2(lambda, phi);
  }

  vec2 proj_inverse(vec2 center, vec2 xy) {
    float epsilon = 0.0001; // uRingRadius / 2.0; //0.00001
    // Fisheye effect
    vec2 xy_1 = xy / pi; // circle radius 1.0
    float rho_fe = length(xy_1);
    float theta = atan(xy.y, xy.x);
    float fisheyeR = (exp(rho_fe * log(1.0 + uScale)) - 1.0) / uScale;    
    vec2 xy_fe = vec2(cos(theta) * fisheyeR * pi, sin(theta) * fisheyeR * pi);
    
    float rho = length(xy_fe);

    if (rho > uRingRadius + epsilon || abs(center.y) >= atanSinhPi) { // outside ring: projected
      return outer_projected(center, xy_fe, rho);
    } else if (rho <= uRingRadius) {                                  // inside ring: flat
      return inner_flat(center, xy);
    } else {                                                // Smooth transition at the boundary
      // return vec2( -0.785017, 1.15794); // debug with white ring
      float t = (rho - uRingRadius) / epsilon;
      vec2 flatCoords = inner_flat(center, xy);
      vec2 projectedCoords = outer_projected(center, xy_fe, rho);
      return mix( // Interpolate
        flatCoords,
        projectedCoords,
        smoothstep(0.0, 1.0, t)
      );
    }
  }

  float inner_xy(vec2 xy) { // returns zero outside of circle
    return 1.0 - smoothstep( (1.0 - blurRatio) * xyRadius, (1.0 + blurRatio) * xyRadius, length(xy) );
  }

  void main() {
  // Map the texture point vTexCoord ([0,0] - [1,1]) to a point on the XY plane
    vec2 xy = mix(uViewXY1, uViewXY2, vTexCoord); // lerp from -PI,-PI to +PI,+PI, inverse so rationalizes it
    // if ( uRenderType == 0 ) {    //  Texture (map) RENDER_TYPE_TEXTURE

      vec2 lp = proj_inverse(uProjCenter, xy);

      vec2 ts = (lp - uDataCoord1) / (uDataCoord2 - uDataCoord1);
      float inXY = inner_xy(xy);
      vec2 inData = step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts); // cut off outside of texture
      vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y * inXY;
      OutputColor.a *= clamp(uAlpha, 0.0, 1.0);
      fragColor = OutputColor;
    // }
  //  else if ( uRenderType == 1 ) {  //  PointTexture (icon)

  // //   XY平面上の点を画像上の点[0,0]-[1,1]にマッピングする 
  // //.  Map a point on the XY plane to a point [0, 0] - [1, 1] on the image
  //     vec2 fixedTextureSizeXY = uFixedTextureSize * (uViewXY2 - uViewXY1);
  //     vec2 r1 = vec2(uDataCoord1.x - 0.5 * fixedTextureSizeXY.x, uDataCoord1.x - 0.5 * fixedTextureSizeXY.y);
  //     vec2 ts = (xy - r1) / fixedTextureSizeXY;
  //     vec2 inData = (step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts));
  //     vec4 OutputColor = texture(uTexture, ts) * inData.x * inData.y;
  //     fragColor = OutputColor;

  // } 
  // else if ( uRenderType == 2 ) {  //  Polyline (Graticules)
  
  //       fragColor = uRenderColor;
  
      // }
    }

`;const oi={checkAndGetGesturePos(i){let n=this.canvas.getBoundingClientRect(),o=i.center.x-n.left,l=i.center.y-n.top;return o<0||l<0||n.width<o||n.height<l?null:[o,l]},handleLayerChange:async function(i){this.selectedLayer=i.target.value,await this.setLayer(),await this.init(this.rasterProj),this.animation()},handleKeydown(i){switch(i.key){case"=":case"+":this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1;break;case"-":case"_":this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1;break}this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},handleWheel(i){i.deltaY<0?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.1:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.1,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},handlePinch(i){i.scale>1?this.viewStatus.zoomScale=this.viewStatus.zoomScale*1.05:this.viewStatus.zoomScale=this.viewStatus.zoomScale/1.05,this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,this.viewStatus.zoomScale),this.zoomMax),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation),this.setQueryParams()},getPanRate(i){return i<1?100:i<10?300:i<100?500:i<1e3?1e3:i<1e4?1e4:i<1e5?5e4:i},handlePan(i){if(this.viewStatus.drag){let n=this.checkAndGetGesturePos(i);if(n!=null){if(this.viewStatus.dragPrevPos){i.preventDefault();let o=this.getPanRate(this.viewStatus.zoomScale),l=(n[0]-this.viewStatus.dragPrevPos[0])/o,r=(n[1]-this.viewStatus.dragPrevPos[1])/o,h=this.mapView.getProjCenter(),u=h.lambda-l,f=Math.max(Math.min(h.phi+r,Math.PI/2),-Math.PI/2);this.mapView.setProjCenter(u,f)}this.viewStatus.dragPrevPos=n}}},handlePanStart(i){this.viewStatus.drag=!0;let n=this.checkAndGetGesturePos(i);n&&(i.preventDefault(),this.viewStatus.dragPrevPos=n,this.requestId=requestAnimationFrame(this.animation))},handlePanEnd(i){this.viewStatus.drag=!1,this.viewStatus.dragPrevPos=null,this.mapView.render(!0)},handleDoubleTap(i){let n=this.checkAndGetGesturePos(i);if(n){i.preventDefault();let o=this.mapView.getLambdaPhiPointFromWindow(n[0],n[1]);this.viewStatus.lam0=o.lambda,this.viewStatus.phi0=o.phi,this.viewStatus.targetLambdaPhi=o,this.requestId=requestAnimationFrame(this.animation)}},handleContextLost(i){i.preventDefault(),cancelAnimationFrame(this.requestId),this.mapView.resetImages()},handleContextRestored(i){this.init(this.rasterProj),this.requestId=requestAnimationFrame(this.animation)}};var Bt={exports:{}};var Te;function hi(){return Te||(Te=1,function(i){(function(n,o,l,r){var h=["","webkit","Moz","MS","ms","o"],u=o.createElement("div"),f="function",m=Math.round,d=Math.abs,y=Date.now;function g(t,e,s){return setTimeout(Ot(t,s),e)}function _(t,e,s){return Array.isArray(t)?(P(t,s[e],s),!0):!1}function P(t,e,s){var a;if(t)if(t.forEach)t.forEach(e,s);else if(t.length!==r)for(a=0;a<t.length;)e.call(s,t[a],a,t),a++;else for(a in t)t.hasOwnProperty(a)&&e.call(s,t[a],a,t)}function A(t,e,s){var a="DEPRECATED METHOD: "+e+`
`+s+` AT 
`;return function(){var c=new Error("get-stack-trace"),p=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",v=n.console&&(n.console.warn||n.console.log);return v&&v.call(n.console,a,p),t.apply(this,arguments)}}var Y;typeof Object.assign!="function"?Y=function(e){if(e===r||e===null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(e),a=1;a<arguments.length;a++){var c=arguments[a];if(c!==r&&c!==null)for(var p in c)c.hasOwnProperty(p)&&(s[p]=c[p])}return s}:Y=Object.assign;var Gt=A(function(e,s,a){for(var c=Object.keys(s),p=0;p<c.length;)(!a||a&&e[c[p]]===r)&&(e[c[p]]=s[c[p]]),p++;return e},"extend","Use `assign`."),Ee=A(function(e,s){return Gt(e,s,!0)},"merge","Use `assign`.");function O(t,e,s){var a=e.prototype,c;c=t.prototype=Object.create(a),c.constructor=t,c._super=a,s&&Y(c,s)}function Ot(t,e){return function(){return t.apply(e,arguments)}}function zt(t,e){return typeof t==f?t.apply(e&&e[0]||r,e):t}function Qt(t,e){return t===r?e:t}function _t(t,e,s){P(yt(e),function(a){t.addEventListener(a,s,!1)})}function Tt(t,e,s){P(yt(e),function(a){t.removeEventListener(a,s,!1)})}function Zt(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function J(t,e){return t.indexOf(e)>-1}function yt(t){return t.trim().split(/\s+/g)}function et(t,e,s){if(t.indexOf&&!s)return t.indexOf(e);for(var a=0;a<t.length;){if(s&&t[a][s]==e||!s&&t[a]===e)return a;a++}return-1}function Et(t){return Array.prototype.slice.call(t,0)}function Jt(t,e,s){for(var a=[],c=[],p=0;p<t.length;){var v=t[p][e];et(c,v)<0&&a.push(t[p]),c[p]=v,p++}return a=a.sort(function(C,b){return C[e]>b[e]}),a}function St(t,e){for(var s,a,c=e[0].toUpperCase()+e.slice(1),p=0;p<h.length;){if(s=h[p],a=s?s+c:e,a in t)return a;p++}return r}var Se=1;function Pe(){return Se++}function Kt(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}var Ie=/mobile|tablet|ip(ad|hone|od)|android/i,$t="ontouchstart"in n,xe=St(n,"PointerEvent")!==r,we=$t&&Ie.test(navigator.userAgent),st="touch",Me="pen",Dt="mouse",Ae="kinect",Ce=25,R=1,K=2,I=4,L=8,Pt=1,nt=2,rt=4,at=8,ot=16,X=nt|rt,$=at|ot,te=X|$,ee=["x","y"],It=["clientX","clientY"];function D(t,e){var s=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(a){zt(t.options.enable,[t])&&s.handler(a)},this.init()}D.prototype={handler:function(){},init:function(){this.evEl&&_t(this.element,this.evEl,this.domHandler),this.evTarget&&_t(this.target,this.evTarget,this.domHandler),this.evWin&&_t(Kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Tt(this.element,this.evEl,this.domHandler),this.evTarget&&Tt(this.target,this.evTarget,this.domHandler),this.evWin&&Tt(Kt(this.element),this.evWin,this.domHandler)}};function Re(t){var e,s=t.options.inputClass;return s?e=s:xe?e=Ft:we?e=Mt:$t?e=Yt:e=wt,new e(t,be)}function be(t,e,s){var a=s.pointers.length,c=s.changedPointers.length,p=e&R&&a-c===0,v=e&(I|L)&&a-c===0;s.isFirst=!!p,s.isFinal=!!v,p&&(t.session={}),s.eventType=e,Le(t,s),t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}function Le(t,e){var s=t.session,a=e.pointers,c=a.length;s.firstInput||(s.firstInput=ie(e)),c>1&&!s.firstMultiple?s.firstMultiple=ie(e):c===1&&(s.firstMultiple=!1);var p=s.firstInput,v=s.firstMultiple,M=v?v.center:p.center,C=e.center=se(a);e.timeStamp=y(),e.deltaTime=e.timeStamp-p.timeStamp,e.angle=Ut(M,C),e.distance=xt(M,C),Ne(s,e),e.offsetDirection=re(e.deltaX,e.deltaY);var b=ne(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=b.x,e.overallVelocityY=b.y,e.overallVelocity=d(b.x)>d(b.y)?b.x:b.y,e.scale=v?De(v.pointers,a):1,e.rotation=v?ze(v.pointers,a):0,e.maxPointers=s.prevInput?e.pointers.length>s.prevInput.maxPointers?e.pointers.length:s.prevInput.maxPointers:e.pointers.length,Oe(s,e);var q=t.element;Zt(e.srcEvent.target,q)&&(q=e.srcEvent.target),e.target=q}function Ne(t,e){var s=e.center,a=t.offsetDelta||{},c=t.prevDelta||{},p=t.prevInput||{};(e.eventType===R||p.eventType===I)&&(c=t.prevDelta={x:p.deltaX||0,y:p.deltaY||0},a=t.offsetDelta={x:s.x,y:s.y}),e.deltaX=c.x+(s.x-a.x),e.deltaY=c.y+(s.y-a.y)}function Oe(t,e){var s=t.lastInterval||e,a=e.timeStamp-s.timeStamp,c,p,v,M;if(e.eventType!=L&&(a>Ce||s.velocity===r)){var C=e.deltaX-s.deltaX,b=e.deltaY-s.deltaY,q=ne(a,C,b);p=q.x,v=q.y,c=d(q.x)>d(q.y)?q.x:q.y,M=re(C,b),t.lastInterval=e}else c=s.velocity,p=s.velocityX,v=s.velocityY,M=s.direction;e.velocity=c,e.velocityX=p,e.velocityY=v,e.direction=M}function ie(t){for(var e=[],s=0;s<t.pointers.length;)e[s]={clientX:m(t.pointers[s].clientX),clientY:m(t.pointers[s].clientY)},s++;return{timeStamp:y(),pointers:e,center:se(e),deltaX:t.deltaX,deltaY:t.deltaY}}function se(t){var e=t.length;if(e===1)return{x:m(t[0].clientX),y:m(t[0].clientY)};for(var s=0,a=0,c=0;c<e;)s+=t[c].clientX,a+=t[c].clientY,c++;return{x:m(s/e),y:m(a/e)}}function ne(t,e,s){return{x:e/t||0,y:s/t||0}}function re(t,e){return t===e?Pt:d(t)>=d(e)?t<0?nt:rt:e<0?at:ot}function xt(t,e,s){s||(s=ee);var a=e[s[0]]-t[s[0]],c=e[s[1]]-t[s[1]];return Math.sqrt(a*a+c*c)}function Ut(t,e,s){s||(s=ee);var a=e[s[0]]-t[s[0]],c=e[s[1]]-t[s[1]];return Math.atan2(c,a)*180/Math.PI}function ze(t,e){return Ut(e[1],e[0],It)+Ut(t[1],t[0],It)}function De(t,e){return xt(e[0],e[1],It)/xt(t[0],t[1],It)}var Ue={mousedown:R,mousemove:K,mouseup:I},Fe="mousedown",Ye="mousemove mouseup";function wt(){this.evEl=Fe,this.evWin=Ye,this.pressed=!1,D.apply(this,arguments)}O(wt,D,{handler:function(e){var s=Ue[e.type];s&R&&e.button===0&&(this.pressed=!0),s&K&&e.which!==1&&(s=I),this.pressed&&(s&I&&(this.pressed=!1),this.callback(this.manager,s,{pointers:[e],changedPointers:[e],pointerType:Dt,srcEvent:e}))}});var Xe={pointerdown:R,pointermove:K,pointerup:I,pointercancel:L,pointerout:L},je={2:st,3:Me,4:Dt,5:Ae},ae="pointerdown",oe="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(ae="MSPointerDown",oe="MSPointerMove MSPointerUp MSPointerCancel");function Ft(){this.evEl=ae,this.evWin=oe,D.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}O(Ft,D,{handler:function(e){var s=this.store,a=!1,c=e.type.toLowerCase().replace("ms",""),p=Xe[c],v=je[e.pointerType]||e.pointerType,M=v==st,C=et(s,e.pointerId,"pointerId");p&R&&(e.button===0||M)?C<0&&(s.push(e),C=s.length-1):p&(I|L)&&(a=!0),!(C<0)&&(s[C]=e,this.callback(this.manager,p,{pointers:s,changedPointers:[e],pointerType:v,srcEvent:e}),a&&s.splice(C,1))}});var qe={touchstart:R,touchmove:K,touchend:I,touchcancel:L},Ve="touchstart",He="touchstart touchmove touchend touchcancel";function he(){this.evTarget=Ve,this.evWin=He,this.started=!1,D.apply(this,arguments)}O(he,D,{handler:function(e){var s=qe[e.type];if(s===R&&(this.started=!0),!!this.started){var a=We.call(this,e,s);s&(I|L)&&a[0].length-a[1].length===0&&(this.started=!1),this.callback(this.manager,s,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}}});function We(t,e){var s=Et(t.touches),a=Et(t.changedTouches);return e&(I|L)&&(s=Jt(s.concat(a),"identifier")),[s,a]}var ke={touchstart:R,touchmove:K,touchend:I,touchcancel:L},Be="touchstart touchmove touchend touchcancel";function Mt(){this.evTarget=Be,this.targetIds={},D.apply(this,arguments)}O(Mt,D,{handler:function(e){var s=ke[e.type],a=Ge.call(this,e,s);a&&this.callback(this.manager,s,{pointers:a[0],changedPointers:a[1],pointerType:st,srcEvent:e})}});function Ge(t,e){var s=Et(t.touches),a=this.targetIds;if(e&(R|K)&&s.length===1)return a[s[0].identifier]=!0,[s,s];var c,p,v=Et(t.changedTouches),M=[],C=this.target;if(p=s.filter(function(b){return Zt(b.target,C)}),e===R)for(c=0;c<p.length;)a[p[c].identifier]=!0,c++;for(c=0;c<v.length;)a[v[c].identifier]&&M.push(v[c]),e&(I|L)&&delete a[v[c].identifier],c++;if(M.length)return[Jt(p.concat(M),"identifier"),M]}var Qe=2500,le=25;function Yt(){D.apply(this,arguments);var t=Ot(this.handler,this);this.touch=new Mt(this.manager,t),this.mouse=new wt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}O(Yt,D,{handler:function(e,s,a){var c=a.pointerType==st,p=a.pointerType==Dt;if(!(p&&a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents)){if(c)Ze.call(this,s,a);else if(p&&Je.call(this,a))return;this.callback(e,s,a)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ze(t,e){t&R?(this.primaryTouch=e.changedPointers[0].identifier,ce.call(this,e)):t&(I|L)&&ce.call(this,e)}function ce(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var s={x:e.clientX,y:e.clientY};this.lastTouches.push(s);var a=this.lastTouches,c=function(){var p=a.indexOf(s);p>-1&&a.splice(p,1)};setTimeout(c,Qe)}}function Je(t){for(var e=t.srcEvent.clientX,s=t.srcEvent.clientY,a=0;a<this.lastTouches.length;a++){var c=this.lastTouches[a],p=Math.abs(e-c.x),v=Math.abs(s-c.y);if(p<=le&&v<=le)return!0}return!1}var ue=St(u.style,"touchAction"),fe=ue!==r,pe="compute",de="auto",Xt="manipulation",tt="none",ht="pan-x",lt="pan-y",At=$e();function jt(t,e){this.manager=t,this.set(e)}jt.prototype={set:function(t){t==pe&&(t=this.compute()),fe&&this.manager.element.style&&At[t]&&(this.manager.element.style[ue]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return P(this.manager.recognizers,function(e){zt(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Ke(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,s=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var a=this.actions,c=J(a,tt)&&!At[tt],p=J(a,lt)&&!At[lt],v=J(a,ht)&&!At[ht];if(c){var M=t.pointers.length===1,C=t.distance<2,b=t.deltaTime<250;if(M&&C&&b)return}if(!(v&&p)&&(c||p&&s&X||v&&s&$))return this.preventSrc(e)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function Ke(t){if(J(t,tt))return tt;var e=J(t,ht),s=J(t,lt);return e&&s?tt:e||s?e?ht:lt:J(t,Xt)?Xt:de}function $e(){if(!fe)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(s){t[s]=e?n.CSS.supports("touch-action",s):!0}),t}var Ct=1,U=2,it=4,B=8,V=B,ct=16,j=32;function H(t){this.options=Y({},this.defaults,t||{}),this.id=Pe(),this.manager=null,this.options.enable=Qt(this.options.enable,!0),this.state=Ct,this.simultaneous={},this.requireFail=[]}H.prototype={defaults:{},set:function(t){return Y(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(_(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=Rt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return _(t,"dropRecognizeWith",this)?this:(t=Rt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(_(t,"requireFailure",this))return this;var e=this.requireFail;return t=Rt(t,this),et(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(_(t,"dropRequireFailure",this))return this;t=Rt(t,this);var e=et(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,s=this.state;function a(c){e.manager.emit(c,t)}s<B&&a(e.options.event+me(s)),a(e.options.event),t.additionalEvent&&a(t.additionalEvent),s>=B&&a(e.options.event+me(s))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=j},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(j|Ct)))return!1;t++}return!0},recognize:function(t){var e=Y({},t);if(!zt(this.options.enable,[this,e])){this.reset(),this.state=j;return}this.state&(V|ct|j)&&(this.state=Ct),this.state=this.process(e),this.state&(U|it|B|ct)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}};function me(t){return t&ct?"cancel":t&B?"end":t&it?"move":t&U?"start":""}function ge(t){return t==ot?"down":t==at?"up":t==nt?"left":t==rt?"right":""}function Rt(t,e){var s=e.manager;return s?s.get(t):t}function F(){H.apply(this,arguments)}O(F,H,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return e===0||t.pointers.length===e},process:function(t){var e=this.state,s=t.eventType,a=e&(U|it),c=this.attrTest(t);return a&&(s&L||!c)?e|ct:a||c?s&I?e|B:e&U?e|it:U:j}});function bt(){F.apply(this,arguments),this.pX=null,this.pY=null}O(bt,F,{defaults:{event:"pan",threshold:10,pointers:1,direction:te},getTouchAction:function(){var t=this.options.direction,e=[];return t&X&&e.push(lt),t&$&&e.push(ht),e},directionTest:function(t){var e=this.options,s=!0,a=t.distance,c=t.direction,p=t.deltaX,v=t.deltaY;return c&e.direction||(e.direction&X?(c=p===0?Pt:p<0?nt:rt,s=p!=this.pX,a=Math.abs(t.deltaX)):(c=v===0?Pt:v<0?at:ot,s=v!=this.pY,a=Math.abs(t.deltaY))),t.direction=c,s&&a>e.threshold&&c&e.direction},attrTest:function(t){return F.prototype.attrTest.call(this,t)&&(this.state&U||!(this.state&U)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=ge(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}});function qt(){F.apply(this,arguments)}O(qt,F,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&U)},emit:function(t){if(t.scale!==1){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}});function Vt(){H.apply(this,arguments),this._timer=null,this._input=null}O(Vt,H,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[de]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,a=t.distance<e.threshold,c=t.deltaTime>e.time;if(this._input=t,!a||!s||t.eventType&(I|L)&&!c)this.reset();else if(t.eventType&R)this.reset(),this._timer=g(function(){this.state=V,this.tryEmit()},e.time,this);else if(t.eventType&I)return V;return j},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===V&&(t&&t.eventType&I?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=y(),this.manager.emit(this.options.event,this._input)))}});function Ht(){F.apply(this,arguments)}O(Ht,F,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&U)}});function Wt(){F.apply(this,arguments)}O(Wt,F,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:X|$,pointers:1},getTouchAction:function(){return bt.prototype.getTouchAction.call(this)},attrTest:function(t){var e=this.options.direction,s;return e&(X|$)?s=t.overallVelocity:e&X?s=t.overallVelocityX:e&$&&(s=t.overallVelocityY),this._super.attrTest.call(this,t)&&e&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(s)>this.options.velocity&&t.eventType&I},emit:function(t){var e=ge(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}});function Lt(){H.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}O(Lt,H,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Xt]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,a=t.distance<e.threshold,c=t.deltaTime<e.time;if(this.reset(),t.eventType&R&&this.count===0)return this.failTimeout();if(a&&c&&s){if(t.eventType!=I)return this.failTimeout();var p=this.pTime?t.timeStamp-this.pTime<e.interval:!0,v=!this.pCenter||xt(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!v||!p?this.count=1:this.count+=1,this._input=t;var M=this.count%e.taps;if(M===0)return this.hasRequireFailures()?(this._timer=g(function(){this.state=V,this.tryEmit()},e.interval,this),U):V}return j},failTimeout:function(){return this._timer=g(function(){this.state=j},this.options.interval,this),j},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==V&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function G(t,e){return e=e||{},e.recognizers=Qt(e.recognizers,G.defaults.preset),new kt(t,e)}G.VERSION="2.0.7",G.defaults={domEvents:!1,touchAction:pe,enable:!0,inputTarget:null,inputClass:null,preset:[[Ht,{enable:!1}],[qt,{enable:!1},["rotate"]],[Wt,{direction:X}],[bt,{direction:X},["swipe"]],[Lt],[Lt,{event:"doubletap",taps:2},["tap"]],[Vt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ti=1,ve=2;function kt(t,e){this.options=Y({},G.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=Re(this),this.touchAction=new jt(this,this.options.touchAction),_e(this,!0),P(this.options.recognizers,function(s){var a=this.add(new s[0](s[1]));s[2]&&a.recognizeWith(s[2]),s[3]&&a.requireFailure(s[3])},this)}kt.prototype={set:function(t){return Y(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ve:ti},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var s,a=this.recognizers,c=e.curRecognizer;(!c||c&&c.state&V)&&(c=e.curRecognizer=null);for(var p=0;p<a.length;)s=a[p],e.stopped!==ve&&(!c||s==c||s.canRecognizeWith(c))?s.recognize(t):s.reset(),!c&&s.state&(U|it|B)&&(c=e.curRecognizer=s),p++}},get:function(t){if(t instanceof H)return t;for(var e=this.recognizers,s=0;s<e.length;s++)if(e[s].options.event==t)return e[s];return null},add:function(t){if(_(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(_(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,s=et(e,t);s!==-1&&(e.splice(s,1),this.touchAction.update())}return this},on:function(t,e){if(t!==r&&e!==r){var s=this.handlers;return P(yt(t),function(a){s[a]=s[a]||[],s[a].push(e)}),this}},off:function(t,e){if(t!==r){var s=this.handlers;return P(yt(t),function(a){e?s[a]&&s[a].splice(et(s[a],e),1):delete s[a]}),this}},emit:function(t,e){this.options.domEvents&&ei(t,e);var s=this.handlers[t]&&this.handlers[t].slice();if(!(!s||!s.length)){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var a=0;a<s.length;)s[a](e),a++}},destroy:function(){this.element&&_e(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function _e(t,e){var s=t.element;if(s.style){var a;P(t.options.cssProps,function(c,p){a=St(s.style,p),e?(t.oldCssProps[a]=s.style[a],s.style[a]=c):s.style[a]=t.oldCssProps[a]||""}),e||(t.oldCssProps={})}}function ei(t,e){var s=o.createEvent("Event");s.initEvent(t,!0,!0),s.gesture=e,e.target.dispatchEvent(s)}Y(G,{INPUT_START:R,INPUT_MOVE:K,INPUT_END:I,INPUT_CANCEL:L,STATE_POSSIBLE:Ct,STATE_BEGAN:U,STATE_CHANGED:it,STATE_ENDED:B,STATE_RECOGNIZED:V,STATE_CANCELLED:ct,STATE_FAILED:j,DIRECTION_NONE:Pt,DIRECTION_LEFT:nt,DIRECTION_RIGHT:rt,DIRECTION_UP:at,DIRECTION_DOWN:ot,DIRECTION_HORIZONTAL:X,DIRECTION_VERTICAL:$,DIRECTION_ALL:te,Manager:kt,Input:D,TouchAction:jt,TouchInput:Mt,MouseInput:wt,PointerEventInput:Ft,TouchMouseInput:Yt,SingleTouchInput:he,Recognizer:H,AttrRecognizer:F,Tap:Lt,Pan:bt,Swipe:Wt,Pinch:qt,Rotate:Ht,Press:Vt,on:_t,off:Tt,each:P,merge:Ee,extend:Gt,assign:Y,inherit:O,bindFn:Ot,prefixed:St});var ii=typeof n<"u"?n:typeof self<"u"?self:{};ii.Hammer=G,i.exports?i.exports=G:n[l]=G})(window,document,"Hammer")}(Bt)),Bt.exports}hi();let li=function(){let i="pk.eyJ1IjoiYml0c2xheWVyNDIiLCJhIjoiY21iNmp2dTdiMDBnYjJqcGxobWR4NWlrbyJ9.V6LS515oNG3QiZcDI_US5A",n="AIzaSyCZvGe7TAvVnbeH4V9DHrBQsfo6zodIM0c";this.interpolateTimeSpan=1e3,this.gl=null,this.canvas=null,this.mapView=null,this.requestId=null,this.prevTime=null,this.prevScale=null,this.viewStatus={drag:!1,dragPrevPos:null,pinchPrevScale:null,zoomScale:300,targetLambdaPhi:null,interpolater:null,currTileLevel:null},this.layerSelect=document.querySelector("#layer"),this.selectedLayer=this.layerSelect.value,this.googleSessions=[];var o=[[-1.29174307860817,.7104078658215001],[-1.34406026074966,.6787546684457174],[-1.24019010226,.73929973401],[-1.40412724747,.43790456061],[-.00142463433,.89850833693],[0,0],[-.785017,1.15794],[-2.066469,.591122],[-1.4407952048317003,.6212504054863001]],l=0;[this.viewStatus.lam0,this.viewStatus.phi0]=o[l],this.zoomMin=10,this.zoomMax=3e6,this.maxTileLevel=22,this.ringRadius=1e-6,this.rasterProj=null,this.debug=!1,this.animationFramesInit=80,this.animationFrames=this.animationFramesInit,document.addEventListener("DOMContentLoaded",async()=>{this.getQueryParams(),this.canvas=document.querySelector("#webglCanvas"),this.resizeCanvas(this.canvas),this.rasterProj=new z,this.rasterProj.setScale(this.viewStatus.zoomScale),await this.startup(this.rasterProj),this.animation()}),window.addEventListener("resize",()=>{this.resizeCanvas(this.canvas),this.mapView.resizeCanvas(this.canvas),this.rasterProj.clear(this.canvas)}),this.animation=()=>{if(!this.mapView)return;let r=!1,h=new Date().getTime();this.setTileLevel();let u;if(this.viewStatus.interpolater!=null)u=this.viewStatus.interpolater.getPos(h),this.mapView.setProjCenter(u.lp.lambda,u.lp.phi),this.viewStatus.interpolater.isFinished()&&(this.viewStatus.interpolater=null,r=!0);else if(this.viewStatus.targetLambdaPhi!=null){let f=this.mapView.getProjCenter(),m=this.viewStatus.targetLambdaPhi;this.viewStatus.interpolater=pt.create(f,m,[0,0],[0,0],this.interpolateTimeSpan),this.viewStatus.targetLambdaPhi=null}this.prevScale!=this.viewStatus.zoomScale&&(this.rasterProj.setScale(this.viewStatus.zoomScale),this.rasterProj.setFlatRatio(this.ringRadius),this.prevScale=this.viewStatus.zoomScale,r=!0),this.mapView.render(r),this.animationFrames--,this.animationFrames>0?this.requestId=requestAnimationFrame(this.animation):(this.animationFrames=this.animationFramesInit,this.mapView.render(!0),this.setQueryParams())},this.startup=async r=>{if(this.gl=this.canvas.getContext("webgl2"),!this.gl)return void alert("Failed to setup WebGL.");this.canvas.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.layerSelect.addEventListener("change",this.handleLayerChange.bind(this),!1);let h=new Hammer.Manager(this.canvas,{recognizers:[[Hammer.Pinch,{enable:!0}],[Hammer.Pan,{enable:!0}],[Hammer.Tap,{enable:!0,taps:2}]]});h.on("pinch",this.handlePinch.bind(this)),h.on("pan",this.handlePan.bind(this)),h.on("panstart",this.handlePanStart.bind(this)),h.on("panend pancancel",this.handlePanEnd.bind(this)),h.on("tap",this.handleDoubleTap.bind(this)),window.WheelEvent&&document.addEventListener("wheel",this.handleWheel.bind(this),!1),document.addEventListener("keydown",this.handleKeydown.bind(this)),this.googleSessions=await this.getSessions(),await this.init(r)},this.init=async r=>{let h=this.canvas.getBoundingClientRect(),u={width:h.width,height:h.height},f={},m={num:100,crossOrigin:!1,debug:this.debug};r.init(this.gl),this.mapView=new w(this.gl,r,u,f,m),this.mapView.setProjCenter(this.viewStatus.lam0,this.viewStatus.phi0),await this.setLayer(),this.setTileLevel(),this.mapView.requestImagesIfNecessary()},this.resizeCanvas=r=>{let h=r.clientWidth,u=r.clientHeight;r.width==h&&r.height==u||(r.width=h,r.height=u),cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(this.animation)},this.setTileLevel=()=>{this.viewStatus.currTileLevel=Math.round(Math.log10(this.viewStatus.zoomScale)*3),this.viewStatus.currTileLevel=Math.max(Math.min(this.viewStatus.currTileLevel,this.maxTileLevel),0),this.mapView.setTileLevel(this.viewStatus.currTileLevel)},this.getQueryParams=()=>{let r=new URLSearchParams(window.location.search),h=r.get("zoom");h&&(h=parseFloat(h),isNaN(h)||(this.viewStatus.zoomScale=Math.min(Math.max(this.zoomMin,h),this.zoomMax)));let u=r.get("lat"),f=r.get("lon");u&&f&&(u=parseFloat(u),f=parseFloat(f),!isNaN(u)&&!isNaN(f)&&(this.viewStatus.lam0=f*.0174533,this.viewStatus.phi0=u*.0174533)),r.get("local")==""&&(this.debug="local"),r.get("red")==""&&(this.debug="red")},this.getSessions=async()=>{const r=navigator.language||"en-US",u=new Intl.Locale(r).region||"US";let f={language:r,region:u};f.layerTypes=["layerRoadmap"],f.styles=[{featureType:"all",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{visibility:"on"}]}];let m=["satellite","roadmap"],d=[];for(let y of m){f.mapType=y;const g=await fetch(`https://tile.googleapis.com/v1/createSession?key=${n}`,{method:"POST",body:JSON.stringify(f),headers:{"Content-Type":"application/json"}}).then(P=>P.text()).catch(P=>{console.error("Error fetching Google Maps Tile Session:",P)}),_=JSON.parse(g);d.push(_.session)}return d},this.setLayer=async()=>{let r=null,h=document.querySelector(".attribution");this.selectedLayer==="mapbox_satellite"?(h.innerHTML=`<span style="max-width: 50%">© <a href="https://www.mapbox.com/about/maps">Mapbox</a> 
        © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>
        © <a href="https://www.maxar.com/">Maxar</a><br>
        <strong><a href="https://apps.mapbox.com/feedback/" target="_blank">Improve this map</a></strong></span>`,this.mapView.setCityFontColor("white"),this.mapView.getURL=function(u,f,m){return`https://api.mapbox.com/v4/mapbox.satellite/${u}/${f}/${m}.png?access_token=${i}`}):this.selectedLayer.slice(0,6)==="google"&&(h.innerHTML="Map data @2025 Google",this.selectedLayer==="google_satellite"?(this.mapView.setCityFontColor("white"),r=this.googleSessions[0]):this.selectedLayer==="google_roadmap"&&(this.mapView.setCityFontColor("black"),r=this.googleSessions[1]),this.mapView.getURL=function(u,f,m){return`https://tile.googleapis.com/v1/2dtiles/${u}/${f}/${m}?session=${r}&key=${n}`})},this.setQueryParams=()=>{let r=new URLSearchParams(window.location.search);r.set("zoom",this.viewStatus.zoomScale.toFixed(2)),r.set("lon",(this.viewStatus.lam0*180/Math.PI).toFixed(4)),r.set("lat",(this.viewStatus.phi0*180/Math.PI).toFixed(4)),window.history.replaceState({},"",`${window.location.pathname}?${r.toString()}`)},Object.assign(this,oi)};new li;
//# sourceMappingURL=index-CB9H1gmZ.js.map
