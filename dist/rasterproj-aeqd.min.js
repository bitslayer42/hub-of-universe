/*!
 * Raster Map Projection v0.0.3  2016-07-08
 *   https://github.com/tomosn/raster-map-projection
 * Copyright (C) 2016 T.Seno
 * All rights reserved. 
 * @license GPL v3 License (http://www.gnu.org/licenses/gpl.html)
 */
"use strict";var CoordTransform=function(a,b){this.src_x1_=a[0],this.src_y1_=a[1],this.src_x2_=a[2],this.src_y2_=a[3],this.src_width_=a[2]-a[0],this.src_height_=a[3]-a[1],this.dst_x1_=b[0],this.dst_y1_=b[1],this.dst_x2_=b[2],this.dst_y2_=b[3],this.dst_width_=b[2]-b[0],this.dst_height_=b[3]-b[1]};CoordTransform.prototype.forwardPoint=function(a){var b=this.dst_x1_+(a[0]-this.src_x1_)*this.dst_width_/this.src_width_,c=this.dst_y1_+(a[1]-this.src_y1_)*this.dst_height_/this.src_height_;return[b,c]},CoordTransform.prototype.forwardRect=function(a){var b=this.forwardPoint([a[0],a[1]]),c=this.forwardPoint([a[2],a[3]]);return[b[0],b[1],c[0],c[1]]};var ProjMath=function(){};ProjMath.EPSILON=1e-7,ProjMath.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))},ProjMath.atan2Range=function(a,b){var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=b[0]<=b[1]?b[0]:b[1],f=b[0]<=b[1]?b[1]:b[0];if(e>=0)return c>0?[Math.atan2(e,d),Math.atan2(f,c)]:0>d?[Math.atan2(f,d),Math.atan2(e,c)]:[Math.atan2(e,d),Math.atan2(e,c)];if(0>f)return c>0?[Math.atan2(e,c),Math.atan2(f,d)]:0>d?[Math.atan2(f,c),Math.atan2(e,d)]:[Math.atan2(f,c),Math.atan2(f,d)];if(c>0)return[Math.atan2(e,c),Math.atan2(f,c)];if(0>d){var g=Math.atan2(f,d),h=Math.atan2(e,d);return Math.PI<=g?[g-2*Math.PI,h]:[g,h+2*Math.PI]}return[-Math.PI,Math.PI]},ProjMath.toLambdaPhi=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]),c=Math.atan2(a[1],a[0]),d=Math.atan2(a[2],b);return{lambda:c,phi:d}},ProjMath.normalizeLambda=function(a){return-Math.PI<=a&&a<Math.PI?a:a-2*Math.PI*Math.floor((a+Math.PI)/(2*Math.PI))},ProjMath.neighborPoint=function(a,b){if(ProjMath.EPSILON<=Math.abs(a.phi-b.phi))return!1;var c=ProjMath.normalizeLambda(a.lambda),d=ProjMath.normalizeLambda(b.lambda);return Math.abs(c-d)<ProjMath.EPSILON};var ProjDiscreteMath=function(a){this.divN_=a,this.unit_=Math.PI/a};ProjDiscreteMath.prototype.PI_SQ=Math.PI*Math.PI,ProjDiscreteMath.prototype.HALF_PI=Math.PI/2,ProjDiscreteMath.prototype.EPSILON=1e-7,ProjDiscreteMath.prototype.toDiscrete=function(a){var b=Math.floor(a/this.unit_);return b},ProjDiscreteMath.prototype.cosR_lower=function(a,b){var c=a>=0?(a+1)*this.unit_:-a*this.unit_,d=Math.sqrt(c*c+b*b);return d<=Math.PI?Math.cos(d):-1},ProjDiscreteMath.prototype.cosR_upper=function(a,b){var c=a>=0?a*this.unit_:(-a-1)*this.unit_,d=Math.sqrt(c*c+b*b);return d<=Math.PI?Math.cos(d):-1},ProjDiscreteMath.prototype.sinR_lower=function(a,b){var c=a*this.unit_,d=(a+1)*this.unit_,e=Math.sqrt(c*c+b*b),f=Math.sqrt(d*d+b*b);if(Math.PI<=e||Math.PI<=f)return 0;if(e<=this.HALF_PI&&f<=this.HALF_PI){var g=Math.min(e,f);return Math.sin(g)}if(this.HALF_PI<=e&&this.HALF_PI<=f){var h=Math.max(e,f);return Math.sin(h)}var i=Math.sin(e),j=Math.sin(f);return j>i?i:j},ProjDiscreteMath.prototype.sinR_upper=function(a,b){var c=a*this.unit_,d=(a+1)*this.unit_,e=Math.sqrt(c*c+b*b),f=Math.sqrt(d*d+b*b);if(Math.PI<=e&&Math.PI<=f)return 0;if(e<=this.HALF_PI&&f<=this.HALF_PI){var g=Math.max(e,f);return Math.sin(g)}if(this.HALF_PI<=e&&this.HALF_PI<=f){var h=Math.min(e,f);return Math.sin(h)}return 1},ProjDiscreteMath.prototype.R_cotR_lower=function(a,b){var c=a>=0?(a+1)*this.unit_:-a*this.unit_,d=Math.sqrt(c*c+b*b);return d<this.EPSILON?1:d<Math.PI?d/Math.tan(d):-(1/0)},ProjDiscreteMath.prototype.R_cotR_upper=function(a,b){var c=a>=0?a*this.unit_:(-a-1)*this.unit_,d=Math.sqrt(c*c+b*b);return d<this.EPSILON?1:d<Math.PI?d/Math.tan(d):-(1/0)},ProjDiscreteMath.prototype.sinR_divR_lower=function(a,b){var c=a>=0?(a+1)*this.unit_:-a*this.unit_,d=Math.sqrt(c*c+b*b);return d<this.EPSILON?1:d<Math.PI?Math.sin(d)/d:0},ProjDiscreteMath.prototype.sinR_divR_upper=function(a,b){var c=a>=0?a*this.unit_:(-a-1)*this.unit_,d=Math.sqrt(c*c+b*b);return d<this.EPSILON?1:d<Math.PI?Math.sin(d)/d:0},ProjDiscreteMath.prototype.X_lower=function(a){return a*this.unit_},ProjDiscreteMath.prototype.X_upper=function(a){return(a+1)*this.unit_};var ProjAEQD=function(a,b,c){this.lam0=a,this.phi0=b,this.divN_="undefined"!=typeof c?c:180,this.dMath_=new ProjDiscreteMath(this.divN_),this.sin_phi0_=Math.sin(b),this.cos_phi0_=Math.cos(b)};ProjAEQD.prototype.getProjCenter=function(){return{lambda:this.lam0,phi:this.phi0}},ProjAEQD.prototype.forward=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=Math.sin(a-this.lam0),f=Math.cos(a-this.lam0),g=Math.acos(this.sin_phi0_*c+this.cos_phi0_*d*f);if(Math.abs(g)<ProjMath.EPSILON)return{x:0,y:0};var h=Math.sin(g);if(Math.abs(h)<ProjMath.EPSILON)return null;var i=g/h,j=i*d*e,k=i*(this.cos_phi0_*c-this.sin_phi0_*d*f);return{x:j,y:k}},ProjAEQD.prototype.inverse=function(a,b){var c=a*a+b*b;if(this.dMath_.PI_SQ<c)return null;var d=Math.sqrt(c);if(d<ProjMath.EPSILON)return{lambda:this.lam0,phi:this.phi0};var e,f=Math.sin(d),g=Math.cos(d),h=g*this.sin_phi0_+b*f*this.cos_phi0_/d,i=Math.asin(ProjMath.clamp(h,-1,1));return e=this.dMath_.HALF_PI-ProjMath.EPSILON<this.phi0?Math.atan2(a,-b):this.phi0<-(this.dMath_.HALF_PI-ProjMath.EPSILON)?Math.atan2(a,b):Math.atan2(a*f,d*g*this.cos_phi0_-b*this.sin_phi0_*f),{lambda:e+this.lam0,phi:i}},ProjAEQD.prototype.inverseBoundingBox=function(a,b,c,d){var e=c>=a?a:c,f=c>=a?c:a,g=d>=b?b:d,h=d>=b?d:b;if(0>=e&&f>=0){var i=this.dMath_.HALF_PI-this.phi0,j=-(this.dMath_.HALF_PI-ProjMath.EPSILON)<this.phi0&&i>=g&&h>=i,k=-this.dMath_.HALF_PI-this.phi0,l=this.phi0<this.dMath_.HALF_PI-ProjMath.EPSILON&&k>=g&&h>=k;if(j&&l)return{lambda:[-Math.PI,+Math.PI],phi:[-Math.PI/2,+Math.PI/2]};if(j||l){var m=this.inversePhiRange_([e,f],[g,h]);return j?{lambda:[-Math.PI,+Math.PI],phi:[m[0],Math.PI/2]}:{lambda:[-Math.PI,+Math.PI],phi:[-Math.PI/2,m[1]]}}if(k>h||g>i){var n=this.inverseLambdaRangeAtY_([e,-ProjMath.EPSILON],[g,h]),o=this.inverseLambdaRangeAtX_([g,h],[e]),p=this.inverseLambdaRangeAtY_([ProjMath.EPSILON,f],[g,h]),q=this.inverseLambdaRangeAtX_([g,h],[f]),r=this.mergeRange_(n,o),s=this.mergeRange_(p,q),t=[s[0],r[1]+2*Math.PI],u=this.inversePhiRange_([e,f],[g,h]);return t=this.normalizeLambdaRange_(t),{lambda:t,phi:u}}}var v=this.inversePhiRange_([e,f],[g,h]),w=this.inverseLambdaRange_([e,f],[g,h]);return w=this.normalizeLambdaRange_(w),{lambda:w,phi:v}},ProjAEQD.prototype.mergeRange_=function(a,b){var c=null;return null==a?c=b:null!=b&&(c=a,b[0]<c[0]&&(c[0]=b[0]),c[1]<b[1]&&(c[1]=b[1])),c},ProjAEQD.prototype.normalizeLambdaRange_=function(a){var b=a[0];if(-Math.PI<=b&&b<Math.PI)return a;var c=2*Math.PI*Math.floor((b+Math.PI)/(2*Math.PI));return[a[0]-c,a[1]-c]},ProjAEQD.prototype.inverseLambdaRange_=function(a,b){var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=b[0]<=b[1]?b[0]:b[1],f=b[0]<=b[1]?b[1]:b[0],g=this.inverseLambdaRangeAtY_([c,d],[e,f]),h=this.inverseLambdaRangeAtX_([e,f],[c,d]),i=this.mergeRange_(h,g);return i},ProjAEQD.prototype.inverseLambdaRangeAtY_=function(a,b){for(var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=null,f=this.dMath_.toDiscrete(c),g=this.dMath_.toDiscrete(d),h=b.length,i=f;g>=i;++i)for(var j=0;h>j;++j){var k=this.inverseLambdaAtY_(i,b[j]);e=this.mergeRange_(e,k)}return e},ProjAEQD.prototype.inverseLambdaRangeAtX_=function(a,b){for(var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=null,f=this.dMath_.toDiscrete(c),g=this.dMath_.toDiscrete(d),h=b.length,i=f;g>=i;++i)for(var j=0;h>j;++j){var k=this.inverseLambdaAtX_(i,b[j]);e=this.mergeRange_(e,k)}return e},ProjAEQD.prototype.inversePhiRange_=function(a,b){var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=b[0]<=b[1]?b[0]:b[1],f=b[0]<=b[1]?b[1]:b[0],g=this.inversePhiRangeAtY_([c,d],[e,f]),h=this.inversePhiRangeAtX_([e,f],[c,d]),i=this.mergeRange_(h,g);return i},ProjAEQD.prototype.inversePhiRangeAtY_=function(a,b){for(var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=null,f=this.dMath_.toDiscrete(c),g=this.dMath_.toDiscrete(d),h=b.length,i=f;g>=i;++i)for(var j=0;h>j;++j){var k=this.inversePhiAtY_(i,b[j]);e=this.mergeRange_(e,k)}return e},ProjAEQD.prototype.inversePhiRangeAtX_=function(a,b){for(var c=a[0]<=a[1]?a[0]:a[1],d=a[0]<=a[1]?a[1]:a[0],e=null,f=this.dMath_.toDiscrete(c),g=this.dMath_.toDiscrete(d),h=b.length,i=f;g>=i;++i)for(var j=0;h>j;++j){var k=this.inversePhiAtX_(i,b[j]);e=this.mergeRange_(e,k)}return e},ProjAEQD.prototype.inverseLambdaAtX_=function(a,b){if(this.dMath_.HALF_PI-ProjMath.EPSILON<Math.abs(this.phi0)){var c=0<this.phi0?-1:1,d=c*this.dMath_.X_lower(a,b),e=c*this.dMath_.X_upper(a,b),f=e>=d?e:d,g=e>=d?d:e,h=ProjMath.atan2Range([g,f],[b,b]);return[h[0]+this.lam0,h[1]+this.lam0]}var i=this.cos_phi0_*this.dMath_.R_cotR_lower(a,b),j=this.cos_phi0_*this.dMath_.R_cotR_upper(a,b),k=j>=i?j:i,l=j>=i?i:j,m=-this.sin_phi0_*this.dMath_.X_lower(a),n=-this.sin_phi0_*this.dMath_.X_upper(a),o=n>=m?n:m,p=n>=m?m:n,q=k+o,r=l+p,s=ProjMath.atan2Range([r,q],[b,b]);return[s[0]+this.lam0,s[1]+this.lam0]},ProjAEQD.prototype.inverseLambdaAtY_=function(a,b){var c=this.cos_phi0_*this.dMath_.R_cotR_lower(a,b)-this.sin_phi0_*b,d=this.cos_phi0_*this.dMath_.R_cotR_upper(a,b)-this.sin_phi0_*b,e=c>=d?c:d,f=c>=d?d:c,g=this.dMath_.X_lower(a),h=this.dMath_.X_upper(a),i=ProjMath.atan2Range([f,e],[g,h]);return[i[0]+this.lam0,i[1]+this.lam0]},ProjAEQD.prototype.inversePhiAtY_=function(a,b){var c=this.dMath_.cosR_lower(a,b)*this.sin_phi0_,d=this.dMath_.cosR_upper(a,b)*this.sin_phi0_,e=d>=c?d:c,f=d>=c?c:d,g=b*this.dMath_.sinR_divR_lower(a,b)*this.cos_phi0_,h=b*this.dMath_.sinR_divR_upper(a,b)*this.cos_phi0_,i=h>=g?h:g,j=h>=g?g:h,k=ProjMath.clamp(e+i,-1,1),l=ProjMath.clamp(f+j,-1,1);return[Math.asin(l),Math.asin(k)]},ProjAEQD.prototype.inversePhiAtX_=function(a,b){var c=this.dMath_.cosR_lower(a,b)*this.sin_phi0_,d=this.dMath_.cosR_upper(a,b)*this.sin_phi0_,e=d>=c?d:c,f=d>=c?c:d,g=Math.abs(this.dMath_.X_lower(a)),h=Math.abs(this.dMath_.X_upper(a)),i=h>=g?h:g,j=h>=g?g:h,k=Math.abs(this.cos_phi0_),l=i*this.dMath_.sinR_divR_upper(a,b)*k,m=j*this.dMath_.sinR_divR_lower(a,b)*k,n=0<=a*this.cos_phi0_?1:-1,o=n>0?+l:-m,p=n>0?+m:-l,q=ProjMath.clamp(e+o,-1,1),r=ProjMath.clamp(f+p,-1,1);return[Math.asin(r),Math.asin(q)]};var RasterProjAEQD=function(a,b,c){this.gl_=a,this.canvasWidth=b,this.canvasHeight=c,this.program_=null,this.locTexture_=null,this.locAlpha_=null,this.locProjCenter_=null,this.locViewXY1_=null,this.locViewXY2_=null,this.locDataLambdaPhi1_=null,this.locDataLambdaPhi2_=null,this.vbo_=null,this.backColor_={r:0,g:0,b:0},this.zoomInLimit=Math.PI/20,this.zoomOutLimit=20*Math.PI,this.viewWindowRect_=[-Math.PI,-Math.PI,+Math.PI,+Math.PI],this.alpha_=1,this.center_=[0,0]};RasterProjAEQD.prototype.setCanvasSize=function(a,b){this.canvasWidth=a,this.canvasHeight=b},RasterProjAEQD.prototype.setViewWindow=function(a,b,c,d){this.viewWindowRect_=[a,b,c,d]},RasterProjAEQD.prototype.getViewWindow=function(){return this.viewWindowRect_.slice(0)},RasterProjAEQD.prototype.setViewWindowCenter=function(a,b){var c=(this.viewWindowRect_[2]-this.viewWindowRect_[0])/2,d=(this.viewWindowRect_[3]-this.viewWindowRect_[1])/2;this.viewWindowRect_=[a-c,b-d,a+c,b+d]},RasterProjAEQD.prototype.getViewWindowCenter=function(){var a=(this.viewWindowRect_[2]+this.viewWindowRect_[0])/2,b=(this.viewWindowRect_[3]+this.viewWindowRect_[1])/2;return[a,b]},RasterProjAEQD.prototype.moveWindow=function(a,b){var c=-a*(this.viewWindowRect_[2]-this.viewWindowRect_[0])/this.canvasWidth,d=b*(this.viewWindowRect_[3]-this.viewWindowRect_[1])/this.canvasHeight,e=this.viewWindowRect_[0]+c,f=this.viewWindowRect_[1]+d,g=this.viewWindowRect_[2]+c,h=this.viewWindowRect_[3]+d;this.viewWindowRect_=[e,f,g,h]},RasterProjAEQD.prototype.zoomWindow=function(a){var b=(this.canvasHeight-a)/this.canvasHeight,c=b*(this.viewWindowRect_[2]-this.viewWindowRect_[0])/2,d=b*(this.viewWindowRect_[3]-this.viewWindowRect_[1])/2,e=(this.viewWindowRect_[2]+this.viewWindowRect_[0])/2,f=(this.viewWindowRect_[3]+this.viewWindowRect_[1])/2;null!=this.zoomInLimit&&(c<this.zoomInLimit||d<this.zoomInLimit)||null!=this.zoomOutLimit&&(this.zoomOutLimit<c||this.zoomOutLimit<d)||(this.viewWindowRect_=[e-c,f-d,e+c,f+d])},RasterProjAEQD.prototype.getViewPointFromWindow=function(a,b){var c=new CoordTransform([0,this.canvasHeight,this.canvasWidth,0],this.viewWindowRect_);return c.forwardPoint([a,b])},RasterProjAEQD.prototype.setAlpha=function(a){this.alpha_=a},RasterProjAEQD.prototype.setProjCenter=function(a,b){this.center_=[a,b]},RasterProjAEQD.prototype.initShader=function(){var a=this.loadShader_(this.gl_.VERTEX_SHADER,RasterProjAEQD.VERTEX_SHADER_STR),b=this.loadShader_(this.gl_.FRAGMENT_SHADER,RasterProjAEQD.FRAGMENT_SHADER_STR),c=this.gl_.createProgram();this.gl_.attachShader(c,a),this.gl_.attachShader(c,b),this.gl_.bindAttribLocation(c,0,"aPosition"),this.gl_.bindAttribLocation(c,1,"aTexCoord"),this.gl_.linkProgram(c);var d=this.gl_.getProgramParameter(c,this.gl_.LINK_STATUS);if(!d&&!this.gl_.isContextLost()){var e=this.gl_.getProgramInfoLog(c);return alert("Error linking program:\n"+e),void this.gl_.deleteProgram(c)}this.program_=c,this.locTexture_=this.gl_.getUniformLocation(this.program_,"uTexture"),this.locAlpha_=this.gl_.getUniformLocation(this.program_,"uAlpha"),this.locProjCenter_=this.gl_.getUniformLocation(this.program_,"uProjCenter"),this.locViewXY1_=this.gl_.getUniformLocation(this.program_,"uViewXY1"),this.locViewXY2_=this.gl_.getUniformLocation(this.program_,"uViewXY2"),this.locDataLambdaPhi1_=this.gl_.getUniformLocation(this.program_,"uDataLambdaPhi1"),this.locDataLambdaPhi2_=this.gl_.getUniformLocation(this.program_,"uDataLambdaPhi2"),this.vbo_=this.gl_.createBuffer(),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.vbo_),this.gl_.clearColor(this.backColor_.r,this.backColor_.g,this.backColor_.b,1),this.gl_.enable(this.gl_.BLEND)},RasterProjAEQD.prototype.clear=function(){this.gl_.clear(this.gl_.COLOR_BUFFER_BIT),this.gl_.viewport(0,0,this.canvasWidth,this.canvasHeight)},RasterProjAEQD.prototype.renderTextures=function(a){var b=this.center_[0],c=this.center_[1],d=.5,e=.5;this.canvasHeight<this.canvasWidth?e=.5*this.canvasHeight/this.canvasWidth:this.canvasWidth<this.canvasHeight&&(d=.5*this.canvasWidth/this.canvasHeight);var f=new Float32Array([.5-d,.5-e,.5-d,.5+e,.5+d,.5-e,.5+d,.5+e]),g=new Float32Array([-1,-1,-1,1,1,-1,1,1]);this.gl_.useProgram(this.program_),this.gl_.bindBuffer(this.gl_.ARRAY_BUFFER,this.vbo_);var h=g.byteLength;this.gl_.bufferData(this.gl_.ARRAY_BUFFER,h+f.byteLength,this.gl_.STATIC_DRAW),this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,0,g),this.gl_.bufferSubData(this.gl_.ARRAY_BUFFER,h,f);var i=2;this.gl_.enableVertexAttribArray(0),this.gl_.vertexAttribPointer(0,i,this.gl_.FLOAT,this.gl_.FALSE,0,0),this.gl_.enableVertexAttribArray(1),this.gl_.vertexAttribPointer(1,i,this.gl_.FLOAT,this.gl_.FALSE,0,h),this.gl_.blendFunc(this.gl_.SRC_ALPHA,this.gl_.ONE),this.gl_.uniform1f(this.locAlpha_,this.alpha_),this.gl_.uniform2f(this.locProjCenter_,b,c),this.gl_.uniform2f(this.locViewXY1_,this.viewWindowRect_[0],this.viewWindowRect_[1]),this.gl_.uniform2f(this.locViewXY2_,this.viewWindowRect_[2],this.viewWindowRect_[3]),this.gl_.uniform1i(this.locTexture_,0);for(var j=0;j<a.length;++j){var k=a[j][0],l=a[j][1],m=l[0],n=l[1],o=l[2],p=l[3];this.gl_.bindTexture(this.gl_.TEXTURE_2D,k),this.gl_.uniform2f(this.locDataLambdaPhi1_,m,n),this.gl_.uniform2f(this.locDataLambdaPhi2_,o,p),this.gl_.drawArrays(this.gl_.TRIANGLE_STRIP,0,4)}},RasterProjAEQD.prototype.loadShader_=function(a,b){var c=this.gl_.createShader(a);if(this.gl_.shaderSource(c,b),this.gl_.compileShader(c),!this.gl_.getShaderParameter(c,this.gl_.COMPILE_STATUS)&&!this.gl_.isContextLost()){var d=this.gl_.getShaderInfoLog(c);return alert("Error compiling shader:\n"+d),this.gl_.deleteShader(c),null}return c},RasterProjAEQD.VERTEX_SHADER_STR=["precision highp float;","attribute vec3 aPosition;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main()","{","  gl_Position = vec4(aPosition.x, aPosition.y, aPosition.z, 1.0);","  vTexCoord = aTexCoord;","}"].join("\n"),RasterProjAEQD.FRAGMENT_SHADER_STR=["precision highp float;","uniform sampler2D uTexture;","varying vec2 vTexCoord;","uniform vec2 uProjCenter;","uniform vec2 uViewXY1;","uniform vec2 uViewXY2;","uniform vec2 uDataLambdaPhi1;","uniform vec2 uDataLambdaPhi2;","uniform float uAlpha;","const float pi = 3.14159265;","const float epsilon = 0.00000001;","const float blurRatio = 0.015;","vec2 proj_invserse(vec2 center, vec2 xy)","{","  float sinPhi0 = sin(center.y);","  float cosPhi0 = cos(center.y);","  float c_rh = length(xy);","  if ( c_rh < epsilon ) {","    return center;","  }","  if ( c_rh - epsilon > pi ) {","    c_rh = pi;","  }","  float cos_c = cos(c_rh);","  float sin_c = sin(c_rh);","  float phi = asin( clamp( cos_c * sinPhi0 + xy.y * sin_c * cosPhi0 / c_rh, -1.0, 1.0 ) );","  float lam = mod( center.x + atan( xy.x * sin_c, c_rh * cosPhi0 * cos_c - xy.y * sinPhi0 * sin_c ) + pi, 2.0 * pi ) - pi;","  return vec2(lam, phi);","}","float inner_xy(vec2 xy)","{","  return 1.0 - smoothstep( (1.0 - blurRatio) * pi, (1.0 + blurRatio) * pi, length(xy) );","}","void main()","{","  vec2 xy = mix(uViewXY1, uViewXY2, vTexCoord);","  vec2 lp = proj_invserse(uProjCenter, xy);","  vec2 lp1 = vec2(uDataLambdaPhi1.x, uDataLambdaPhi2.y);","  vec2 lp2 = vec2(uDataLambdaPhi2.x, uDataLambdaPhi1.y);","  vec2 ts = (lp - lp1) / (lp2 - lp1);","  float inXY = inner_xy(xy);","  vec2 inData = step(vec2(0.0, 0.0), ts) - step(vec2(1.0, 1.0), ts);","  vec4 OutputColor = texture2D(uTexture, ts) * inData.x * inData.y * inXY;","  OutputColor.a *= clamp(uAlpha, 0.0, 1.0);","  gl_FragColor = OutputColor;","}"].join("\n"),"undefined"!=typeof module&&module.exports&&(module.exports=RasterProjAEQD,module.exports.ProjMath=ProjMath,module.exports.ProjDiscreteMath=ProjDiscreteMath,module.exports.ProjAEQD=ProjAEQD);